{"version":3,"sources":["../node_modules/@arcgis/core/layers/MapImageLayer.js","../node_modules/@arcgis/core/layers/support/ExportImageParameters.js","../node_modules/@arcgis/core/geometry/support/scaleUtils.js"],"names":["U","f","w","x","S","R","I","g","j","v","d","M","O","h","constructor","e","super","this","alwaysRefetch","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","labelsVisible","isReference","operationalLayerType","sourceJSON","sublayers","type","url","normalizeCtorArgs","r","load","t","signal","addResolvingPromise","loadFromPortal","supportedTypes","then","_fetchService","m","readImageFormat","supportedImageFormatTypes","indexOf","writeSublayers","s","loaded","i","slice","reverse","flatten","toArray","o","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","l","origin","createSublayersForOrigin","q","a","p","writeSublayerStructure","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","createExportImageParameters","pixelRatio","version","clone","shiftCentralMeridian","N","layer","scale","L","extent","width","toJSON","destroy","rotation","spatialReference","wkid","JSON","stringify","n","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","timestamp","query","_ts","customParameters","parsedUrl","path","Date","now","dynamicLayers","u","data","catch","c","error","loadAll","y","allSublayers","read","ssl","replace","prototype","json","origins","service","source","Boolean","enabled","overridePolicy","ignoreOrigin","P","readOnly","value","b","E","definitionExpression","labelingInfo","opacity","minScale","maxScale","renderer","arguments","_scale","view","hasDynamicLayers","visibleSublayers","toExportImageJSON","serviceSublayers","_get","_set","handles","remove","add","on","notifyChange","propertyName","join","reduce","layerDefs","unshift","format","transparent","dependsOn","Number"],"mappings":"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","file":"static/js/26.6a9c07fa.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import\"../core/Logger.js\";import{Integer as t}from\"../core/accessorSupport/ensureType.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import{reader as i}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as o}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import p from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import{nameToId as l}from\"../core/accessorSupport/PropertyOrigin.js\";import\"../portal/support/resourceExtension.js\";import{resolve as m,reject as n,isAbortError as c}from\"../core/promiseUtils.js\";import u from\"../request.js\";import{loadAll as y}from\"../core/loadAll.js\";import h from\"./Layer.js\";import{MultiOriginJSONMixin as d}from\"../core/MultiOriginJSONSupport.js\";import{ArcGISService as g}from\"./mixins/ArcGISService.js\";import{BlendLayer as f}from\"./mixins/BlendLayer.js\";import{url as b}from\"./support/commonProperties.js\";import{OperationalLayer as j}from\"./mixins/OperationalLayer.js\";import{PortalLayer as v}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as S}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as x}from\"./mixins/ScaleRangeLayer.js\";import{TemporalLayer as w}from\"./mixins/TemporalLayer.js\";import{HandleOwnerMixin as O}from\"../core/HandleOwner.js\";import{getScale as L}from\"../geometry/support/scaleUtils.js\";import{ArcGISMapService as I}from\"./mixins/ArcGISMapService.js\";import{CustomParametersMixin as M}from\"./mixins/CustomParametersMixin.js\";import P from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as q}from\"./support/sublayerUtils.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{ExportImageParameters as N}from\"./support/ExportImageParameters.js\";let U=class extends(f(w(x(S(R(I(g(j(v(d(M(O(h))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),m(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const i=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let o=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=l(s.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;o=q(i,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");o=q(i,e.sublayers,l(e.origin))}}const a=[],p={writeSublayerStructure:o,...s};let m=o;i.forEach((e=>{const r=e.write({},p);a.push(r),m=m||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),m&&(r.visibleLayers=i.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,s){const i=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const o=new N({layer:this,scale:L({extent:e,width:r})*i}),a=o.toJSON();o.destroy();const p=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},l=e&&e.spatialReference,m=l.wkid||JSON.stringify(l.toJSON());a.dpi*=i;const n={};if(null==s?void 0:s.timeExtent){const{start:e,end:r}=s.timeExtent.toJSON();n.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(n.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:m,imageSR:m,size:r+\",\"+t,...a,...p,...n}}async fetchImage(e,r,t,s){const i={responseType:\"image\"};s&&s.timestamp&&(i.query={...i.query,_ts:s.timestamp}),s&&s.signal&&(i.signal=s.signal),this.customParameters&&Object.keys(this.customParameters).length&&(i.query={...this.customParameters,...i.query});const o=this.parsedUrl.path+\"/export\",a={...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null};if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return n(new p(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a}));i.query?i.query={...a,...i.query}:i.query=a;return u(o,i).then((e=>e.data)).catch((e=>{if(c(e))throw e;throw new p(\"mapimagelayer:image-fetch-error\",\"Unable to load image: \"+o,{error:e})}))}loadAll(){return y(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:r,ssl:t}=await u(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters},signal:e});t&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r,this.read(r,{origin:\"service\",url:this.parsedUrl})}};e([s()],U.prototype,\"alwaysRefetch\",void 0),e([s()],U.prototype,\"dpi\",void 0),e([s()],U.prototype,\"gdbVersion\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([s()],U.prototype,\"imageFormat\",void 0),e([i(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([s({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([s({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([s()],U.prototype,\"imageTransparency\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([s({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([s({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([s()],U.prototype,\"sourceJSON\",void 0),e([s({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([a(\"sublayers\",{layers:{type:[P]},visibleLayers:{type:[t]}})],U.prototype,\"writeSublayers\",null),e([s({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([s({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([s(b)],U.prototype,\"url\",void 0),U=e([o(\"esri.layers.MapImageLayer\")],U);var E=U;export default E;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import i from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{HandleOwnerMixin as t}from\"../../core/HandleOwner.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import n from\"../../views/View.js\";const o={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends(t(i)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(o[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,s)=>(e[s.id]=s.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange(\"scale\"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const s=e.layer;return s&&(s.dpi,s.imageFormat,s.imageTransparency,s.gdbVersion),(this._get(\"version\")||0)+1}set version(e){this._set(\"version\",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const s=this.layer.sublayers,r=s=>{const i=this.scale,a=0===i,t=0===s.minScale||i<=s.minScale,l=0===s.maxScale||i>=s.maxScale;s.visible&&(a||t&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};s&&s.forEach(r);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some(((s,r)=>e[r]!==s))?e:i}toJSON(){const e=this.layer;let s={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?s.dynamicLayers=this.dynamicLayers:s={...s,layers:this.layers,layerDefs:this.layerDefs},s}};e([s({readOnly:!0,dependsOn:[\"hasDynamicLayers\",\"visibleSublayers\"]})],y.prototype,\"dynamicLayers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\",\"layer.serviceSublayers\",\"layer.capabilities\"]})],y.prototype,\"hasDynamicLayers\",null),e([s()],y.prototype,\"layer\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layerDefs\",null),e([s({type:Number,dependsOn:[\"view.scale\"]})],y.prototype,\"scale\",null),e([s(a)],y.prototype,\"timeExtent\",void 0),e([s({dependsOn:[\"layers\",\"layerDefs\",\"dynamicLayers\",\"layer.dpi\",\"layer.imageFormat\",\"layer.imageTransparency\",\"layer.gdbVersion\",\"timeExtent\"]})],y.prototype,\"version\",null),e([s({type:n})],y.prototype,\"view\",void 0),e([s({readOnly:!0,dependsOn:[\"layer.sublayers\",\"scale\"]})],y.prototype,\"visibleSublayers\",null),y=e([r(\"esri.layers.mixins.ExportImageParameters\")],y);export{y as ExportImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{getMetersPerUnitForSR as t,inchesPerMeter as n}from\"../../core/unitUtils.js\";function e(e,r){const i=r||e.extent,o=e.width,c=t(i&&i.spatialReference);return i&&o?i.width/o*c*n*96:0}function r(e,r){return e/(t(r)*n*96)}function i(e,r){return e*(t(r)*n*96)}function o(t,n){const e=t.extent,i=t.width,o=r(n,e.spatialReference);return e.clone().expand(o*i/e.width)}export{o as getExtentForScale,r as getResolutionForScale,e as getScale,i as getScaleForResolution};\n"],"sourceRoot":""}