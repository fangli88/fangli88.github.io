{"version":3,"sources":["../node_modules/@arcgis/core/layers/graphics/sources/FeatureLayerSource.js"],"names":["F","Set","b","p","constructor","super","arguments","this","type","load","e","t","s","signal","addResolvingPromise","_fetchService","l","capabilities","query","supportsFormatPBF","parsedUrl","r","dynamicDataSource","gdbVersion","a","spatialReference","o","layer","u","f","url","path","format","sourceSpatialReference","addAttachment","then","attributes","objectIdField","_getLayerRequestOptions","_getFormDataForAttachment","h","body","_createFeatureEditResult","data","addAttachmentResult","catch","_createAttachmentErrorResult","updateAttachment","attachmentId","updateAttachmentResult","addFeatures","map","_serializeFeature","updateFeatures","_getFeatureIds","deleteFeatures","m","n","deleteAttachments","addAttachments","push","_serializeAttachment","updateAttachments","i","length","adds","updates","deletes","method","JSON","stringify","join","rollbackOnFailure","rollbackOnFailureEnabled","useGlobalIds","globalIdUsed","attachments","d","_createEditsResult","attachmentIds","deleteAttachmentResults","queryAttachments","get","objectIds","parentObjectId","attachmentInfos","y","queryTask","executeAttachmentQuery","queryFeatures","execute","queryFeaturesJSON","executeJSON","queryObjectIds","executeForIds","queryFeatureCount","executeForCount","queryExtent","executeForExtent","queryRelatedFeatures","executeRelationshipQuery","queryRelatedFeaturesCount","executeRelationshipQueryForCount","sourceJSON","returnAdvancedSymbols","has","geometry","toJSON","feature","attachment","globalId","name","contentType","uploadId","parentGlobalId","globalIdField","async","c","FileReader","readAsDataURL","onload","result","onerror","mediaType","File","_getIdsFromFeatureIdentifier","_getIdsFromFeatures","objectId","addFeatureResults","addResults","updateFeatureResults","updateResults","deleteFeatureResults","deleteResults","addAttachmentResults","updateAttachmentResults","success","error","code","description","details","messages","message","httpStatus","messageCode","FormData","elements","set","append","source","responseType","prototype","constructOnly","readOnly","dependsOn","g"],"mappings":"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","file":"static/js/149.f73be65d.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/has.js\";import{fixJson as r}from\"../../../core/lang.js\";import{isSome as s,isNone as a}from\"../../../core/maybe.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as u}from\"../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../core/Error.js\";import{dataComponents as i}from\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{resolve as l,all as d,create as c}from\"../../../core/promiseUtils.js\";import h from\"../../../request.js\";import p from\"../../../core/Loadable.js\";import{unapplyEditsZUnitScaling as m}from\"../../../tasks/operations/zscale.js\";import{processAttachmentQueryResult as y}from\"../../../tasks/operations/queryAttachments.js\";import f from\"../../../tasks/QueryTask.js\";const F=new Set([\"Feature Layer\",\"Table\"]);let b=class extends p{constructor(){super(...arguments),this.type=\"feature-layer\"}load(e){const t=s(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(t)),l(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:r,dynamicDataSource:s,gdbVersion:a,spatialReference:o}=this.layer,u=t(\"featurelayer-pbf\")&&e?\"pbf\":\"json\";return new f({url:r.path,format:u,dynamicDataSource:s,gdbVersion:a,sourceSpatialReference:o})}addAttachment(e,t){return this.load().then((()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+r+\"/addAttachment\",a=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,a.query);return h(s,{body:o}).then((e=>this._createFeatureEditResult(e.data.addAttachmentResult))).catch((e=>{throw this._createAttachmentErrorResult(r,e)}))}))}updateAttachment(e,t,r){return this.load().then((()=>{const s=e.attributes[this.layer.objectIdField],a=this.layer.parsedUrl.path+\"/\"+s+\"/updateAttachment\",o=this._getLayerRequestOptions({query:{attachmentId:t}}),u=this._getFormDataForAttachment(r,o.query);return h(a,{body:u}).then((e=>this._createFeatureEditResult(e.data.updateAttachmentResult))).catch((e=>{throw this._createAttachmentErrorResult(s,e)}))}))}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),a=this._getFeatureIds(e.deleteFeatures);m(r,s,this.layer.spatialReference);const o=[],u=[],n=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)u.push(await this._serializeAttachment(t));const i=o.length||u.length||n.length?{adds:o,updates:u,deletes:n}:null,l=this._getLayerRequestOptions({method:\"post\",query:{adds:r.length?JSON.stringify(r):null,updates:s.length?JSON.stringify(s):null,deletes:a.length?a.join(\",\"):null,gdbVersion:null==t?void 0:t.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,attachments:i&&JSON.stringify(i)}}),d=await h(this.layer.parsedUrl.path+\"/applyEdits\",l);return this._createEditsResult(d)}deleteAttachments(e,t){return this.load().then((()=>{const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+\"/\"+r+\"/deleteAttachments\";return h(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(\",\")},method:\"post\"})).then((e=>e.data.deleteAttachmentResults.map(this._createFeatureEditResult))).catch((e=>{throw this._createAttachmentErrorResult(r,e)}))}))}queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;return this.load().then((()=>{const r=this._getLayerRequestOptions(t);if(!this.layer.get(\"capabilities.operations.supportsQueryAttachments\")){const{objectIds:t}=e,a=[];for(const e of t){const t=s+\"/\"+e+\"/attachments\";a.push(h(t,r))}return d(a).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>y(e,s)))}return this.queryTask.executeAttachmentQuery(e,r)}))}queryFeatures(e,t){return this.load().then((()=>this.queryTask.execute(e,t)))}queryFeaturesJSON(e,t){return this.load().then((()=>this.queryTask.executeJSON(e,t)))}queryObjectIds(e,t){return this.load().then((()=>this.queryTask.executeForIds(e,t)))}queryFeatureCount(e,t){return this.load().then((()=>this.queryTask.executeForCount(e,t)))}queryExtent(e,t){return this.load().then((()=>this.queryTask.executeForExtent(e,t)))}queryRelatedFeatures(e,t){return this.load().then((()=>this.queryTask.executeRelationshipQuery(e,t)))}queryRelatedFeaturesCount(e,t){return this.load().then((()=>this.queryTask.executeRelationshipQueryForCount(e,t)))}async _fetchService(e){const r=this.layer.sourceJSON;if(r)this.sourceJSON=r;else{const{data:r}=await h(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:t(\"featurelayer-advanced-symbols\")?{returnAdvancedSymbols:!0}:{},signal:e}));this.sourceJSON=r}const s=this.sourceJSON.type;if(!F.has(s))throw new n(\"feature-layer-source:unsupported-type\",`Source type \"${s}\" is not supported`)}_serializeFeature(e){const{geometry:t,attributes:r}=e;return a(t)?{attributes:r}:\"mesh\"===t.type||\"extent\"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:a,contentType:o,data:u,uploadId:n}=r,l={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(l.parentGlobalId=\"attributes\"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),n)l.uploadId=n;else if(u){const e=await async function(e){if(\"string\"==typeof e){return i(e)||{data:e}}return c(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t(i(s.result)),s.onerror=e=>r(e)}))}(u);l.contentType=e.mediaType,l.data=e.data,u instanceof File&&(l.name=u.name)}return a&&(l.name=a),o&&(l.contentType=o),l}_getFeatureIds(e){const t=e[0];return t?\"objectId\"in t?this._getIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_getIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_createEditsResult(e){const t=e.data,r=e.data&&e.data.attachments;return{addFeatureResults:t.addResults?t.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:t.updateResults?t.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:t.deleteResults?t.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:r&&r.addResults?r.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:r&&r.updateResults?r.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:r&&r.deleteResults?r.deleteResults.map(this._createFeatureEditResult,this):[]}}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new n(\"feature-layer-source:edit-failure\",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new n(\"feature-layer-source:attachment-failure\",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:s,dynamicDataSource:a}=this.layer;return{...e,query:r({gdbVersion:s,layer:a?JSON.stringify({source:a}):void 0,...t.query,f:\"json\",...null==e?void 0:e.query}),responseType:\"json\"}}};e([o()],b.prototype,\"type\",void 0),e([o({constructOnly:!0})],b.prototype,\"layer\",void 0),e([o({readOnly:!0,dependsOn:[\"layer.parsedUrl\",\"layer.gdbVersion\",\"layer.dynamicDataSource\"]})],b.prototype,\"queryTask\",null),b=e([u(\"esri.layers.graphics.sources.FeatureLayerSource\")],b);var g=b;export default g;\n"],"sourceRoot":""}