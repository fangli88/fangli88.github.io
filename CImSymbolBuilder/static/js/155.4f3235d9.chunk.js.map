{"version":3,"sources":["../node_modules/@arcgis/core/views/2d/engine/webgl/effects/post-processing/Bloom.js"],"names":["i","s","r","o","n","constructor","this","_intensityFBO","_compositeFBO","_mipsFBOs","Array","_nMips","_kernelSizeArray","_size","_programDesc","luminosityHighPass","vsPath","fsPath","attributes","a_position","gaussianBlur","composite","blit","dispose","_quad","t","horizontal","vertical","draw","a","context","l","state","h","painter","u","pixelRatio","p","size","m","materialManager","d","c","gl","_","g","Math","round","f","strength","b","radius","F","threshold","B","e","_createOrResizeResources","setStencilTestEnabled","setBlendingEnabled","setBlendFunction","setStencilWriteMask","O","bind","bindFramebuffer","T","getProgram","bindProgram","bindTexture","colorTexture","setUniform1i","setUniform3fv","setUniform1f","x","setViewport","setClearColor","clear","COLOR_BUFFER_BIT","w","name","value","setUniform2fv","M","setUniform1fv","v","unbind","resize","colorTarget","depthStencilTarget","width","height","target","pixelFormat","internalFormat","dataType","wrapMode","samplingMode","flipped"],"mappings":"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","file":"static/js/155.4f3235d9.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../../../../../core/has.js\";import\"../../../../../../core/mathUtils.js\";import\"../../../../../../chunks/builtins.js\";import t from\"../../../../../webgl/FramebufferObject.js\";import\"../../../../../webgl/RenderingContext.js\";import e from\"../../VertexStream.js\";const i=[1,0],s=[0,1],r=[1,.8,.6,.4,.2],o=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class n{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/luminosityHighPass\",attributes:{a_position:0}},gaussianBlur:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/gaussianBlur\",attributes:{a_position:0}},composite:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/bloom/composite\",attributes:{a_position:0}},blit:{vsPath:\"post-processing/pp\",fsPath:\"post-processing/blit\",attributes:{a_position:0}}}}dispose(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,n,a){const{context:l,state:h,painter:u,pixelRatio:p}=t,{size:m}=h,{materialManager:d}=u,c=l.gl,_=this._programDesc,g=Math.round(p*m[0]),f=Math.round(p*m[1]),{strength:b,radius:F,threshold:B}=a;this._quad||(this._quad=new e(l,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t),l.setStencilTestEnabled(!1),l.setBlendingEnabled(!0),l.setBlendFunction(1,771),l.setStencilWriteMask(0);const O=this._quad;O.bind(),l.bindFramebuffer(this._intensityFBO);const T=d.getProgram(t,_.luminosityHighPass);l.bindProgram(T),l.bindTexture(n.colorTexture,0),T.setUniform1i(\"u_texture\",0),T.setUniform3fv(\"u_defaultColor\",[0,0,0]),T.setUniform1f(\"u_defaultOpacity\",0),T.setUniform1f(\"u_luminosityThreshold\",B),T.setUniform1f(\"u_smoothWidth\",.01);const x=[Math.round(g/2),Math.round(f/2)];l.setViewport(0,0,x[0],x[1]),l.setClearColor(0,0,0,0),l.clear(c.COLOR_BUFFER_BIT),O.draw(),l.setBlendingEnabled(!1);let w=this._intensityFBO.colorTexture;for(let e=0;e<this._nMips;e++){const r=d.getProgram(t,_.gaussianBlur,[{name:\"radius\",value:this._kernelSizeArray[e]}]);l.bindProgram(r),l.bindTexture(w,e+1),r.setUniform1i(\"u_colorTexture\",e+1),r.setUniform2fv(\"u_texSize\",x),r.setUniform2fv(\"u_direction\",i),l.setViewport(0,0,x[0],x[1]);const o=this._mipsFBOs[e];l.bindFramebuffer(o.horizontal),O.draw(),w=o.horizontal.colorTexture,l.bindFramebuffer(o.vertical),l.bindTexture(w,e+1),r.setUniform2fv(\"u_direction\",s),O.draw(),w=o.vertical.colorTexture,x[0]=Math.round(x[0]/2),x[1]=Math.round(x[1]/2)}l.setViewport(0,0,g,f);const M=d.getProgram(t,_.composite,[{name:\"nummips\",value:5}]);l.bindFramebuffer(this._compositeFBO),l.bindProgram(M),M.setUniform1f(\"u_bloomStrength\",b),M.setUniform1f(\"u_bloomRadius\",F),M.setUniform1fv(\"u_bloomFactors\",r),M.setUniform3fv(\"u_bloomTintColors\",o),l.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),M.setUniform1i(\"u_blurTexture1\",1),l.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),M.setUniform1i(\"u_blurTexture2\",2),l.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),M.setUniform1i(\"u_blurTexture3\",3),l.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),M.setUniform1i(\"u_blurTexture4\",4),l.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),M.setUniform1i(\"u_blurTexture5\",5),O.draw(),l.bindFramebuffer(n),l.setBlendingEnabled(!0);const v=d.getProgram(t,_.blit);l.bindProgram(v),l.bindTexture(this._compositeFBO.colorTexture,6),v.setUniform1i(\"u_texture\",6),l.setBlendFunction(1,1),O.draw(),O.unbind(),l.setBlendFunction(1,771),l.setStencilTestEnabled(!0)}_createOrResizeResources(e){const{context:i,state:s,pixelRatio:r}=e,{size:o}=s,n=Math.round(r*o[0]),a=Math.round(r*o[1]);if(this._compositeFBO&&this._size[0]===n&&this._size[1]===a)return;this._size[0]=n,this._size[1]=a;const l=[Math.round(n/2),Math.round(a/2)];this._compositeFBO?this._compositeFBO.resize(n,a):this._compositeFBO=new t(i,{colorTarget:0,depthStencilTarget:0,width:n,height:a}),this._intensityFBO?this._intensityFBO.resize(l[0],l[1]):this._intensityFBO=new t(i,{colorTarget:0,depthStencilTarget:0,width:l[0],height:l[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:l[0],height:l[1]});for(let e=0;e<this._nMips;e++)this._mipsFBOs[e]?(this._mipsFBOs[e].horizontal.resize(l[0],l[1]),this._mipsFBOs[e].vertical.resize(l[0],l[1])):this._mipsFBOs[e]={horizontal:new t(i,{colorTarget:0,depthStencilTarget:0,width:l[0],height:l[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:l[0],height:l[1]}),vertical:new t(i,{colorTarget:0,depthStencilTarget:0,width:l[0],height:l[1]},{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:l[0],height:l[1]})},l[0]=Math.round(l[0]/2),l[1]=Math.round(l[1]/2)}}export{n as Bloom};\n"],"sourceRoot":""}