(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[43],{422:function(t,e,s){"use strict";s.d(e,"a",(function(){return p})),s.d(e,"b",(function(){return x})),s.d(e,"c",(function(){return _})),s.d(e,"d",(function(){return m})),s.d(e,"e",(function(){return h})),s.d(e,"f",(function(){return y})),s.d(e,"g",(function(){return a})),s.d(e,"h",(function(){return c}));var i=s(14),r=s(420),n=s(516);function o(t,e=!1){const s=r.e.SIZE_FIELD_STOPS|r.e.SIZE_MINMAX_VALUE|r.e.SIZE_SCALE_STOPS|r.e.SIZE_UNIT_VALUE,i=(t&(r.f.FIELD_TARGETS_OUTLINE|r.f.MINMAX_TARGETS_OUTLINE|r.f.SCALE_TARGETS_OUTLINE|r.f.UNIT_TARGETS_OUTLINE))>>>4;return e?s&i:s&~i}function a(t,e,s,i,n){switch(t){case r.d.FILL:return p.from(e,i);case r.d.LINE:return _.from(e,s);case r.d.MARKER:return m.from(e);case r.d.TEXT:return y.from(e);case r.d.LABEL:return x.from(e,n);default:throw new Error("Unable to createMaterialKey for unknown geometryType "+t)}}function c(t){switch(h.load(t).geometryType){case r.d.MARKER:return new m(t);case r.d.FILL:return new p(t);case r.d.LINE:return new _(t);case r.d.TEXT:return new y(t);case r.d.LABEL:return new x(t)}}class h{constructor(t){this._data=0,this._data=t}static load(t){const e=this.shared;return e.data=t,e}set data(t){this._data=t}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(t){this.setBits(t,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(t){this.setBit(20,t)}get sdf(){return!!this.bit(11)}set sdf(t){this.setBit(11,t)}get pattern(){return!!this.bit(12)}set pattern(t){this.setBit(12,t)}get textureBinding(){return this.bits(0,8)}set textureBinding(t){this.setBits(t,0,8)}get geometryTypeString(){switch(this.geometryType){case r.d.FILL:return"fill";case r.d.MARKER:return"marker";case r.d.LINE:return"line";case r.d.TEXT:return"text";case r.d.LABEL:return"label";default:throw new i.a("Unable to handle unknown geometryType: "+this.geometryType)}}setBit(t,e){const s=1<<t;e?this._data|=s:this._data&=~s}bit(t){return(this._data&1<<t)>>t}setBits(t,e,s){for(let i=e,r=0;i<s;i++,r++)this.setBit(i,0!=(t&1<<r))}bits(t,e){let s=0;for(let i=t,r=0;i<e;i++,r++)s|=this.bit(i)<<r;return s}hasVV(){return!1}setVV(t,e){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}}h.shared=new h(0);const l=t=>class extends t{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(t){this.setBit(16,t)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(t){this.setBit(17,t)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(t){this.setBit(18,t)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(t){this.setBit(19,t)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(t,e){super.setVV(t,e);const s=o(t,e)&t;this.vvSizeMinMaxValue=!!(s&r.e.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(s&r.e.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(s&r.e.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(s&r.e.SIZE_SCALE_STOPS)}},u=t=>class extends t{get vvRotation(){return 0!==this.bit(15)}set vvRotation(t){this.setBit(15,t)}hasVV(){return super.hasVV()||this.vvRotation}setVV(t,e){super.setVV(t,e),this.vvRotation=!e&&!!(t&r.e.ROTATION)}},d=t=>class extends t{get vvColor(){return 0!==this.bit(13)}set vvColor(t){this.setBit(13,t)}hasVV(){return super.hasVV()||this.vvColor}setVV(t,e){super.setVV(t,e),this.vvColor=!e&&!!(t&r.e.COLOR)}},f=t=>class extends t{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(t){this.setBit(14,t)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(t,e){super.setVV(t,e),this.vvOpacity=!e&&!!(t&r.e.OPACITY)}};class p extends(d(f(h))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.d.FILL,e?s.dotDensity=!0:s.setVV(t,!1),s.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity}}get dotDensity(){return!!this.bit(15)}set dotDensity(t){this.setBit(15,t)}}p.shared=new p(0);class m extends(d(f(u(l(h))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(0);return e.geometryType=r.d.MARKER,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0);class _ extends(d(f(l(h)))){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.d.LINE,s.setVV(t,e),s.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}_.shared=new _(0);class y extends(d(f(u(l(h))))){static load(t){const e=this.shared;return e.data=t,e}static from(t){const e=this.load(t);return e.geometryType=r.d.TEXT,e.setVV(t,!1),e.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class x extends(l(h)){static load(t){const e=this.shared;return e.data=t,e}static from(t,e){const s=this.load(0);return s.geometryType=r.d.LABEL,s.setVV(t,!1),s.mapAligned=!!Object(n.a)(e),s.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0)},432:function(t,e,s){"use strict";var i=s(6),r=s(21),n=s(420),o=s(319),a=s(46),c=s(277);class h{static executeEffects(t,e){const s=Object(a.c)(e);let i=new o.a(s);for(const r of t){const t=Object(c.a)(r);t&&(i=t.execute(i,r,1.3333333333333333))}return i}static next(t){const e=t.next();return Object(a.d)(e),e}}e.a=class{get needsPixelBuffer(){return!!this.effects||this.geometryType===n.d.MARKER||this.geometryType===n.d.TEXT||this.geometryType===n.d.LABEL}writeMesh(t,e,s,n,o){if(Object(i.g)(this.effects))return this.writeMeshWithGeometry(t,e,s,n,o);const a=h.executeEffects(this.effects,s.readLegacyGeometry());let c=h.next(a);for(;c;)this.writeMeshWithGeometry(t,e,s,Object(r.c)(c),o,c),c=h.next(a)}writeMeshWithGeometry(t,e,s,i,r,n){}bindFeature(t,e,s){}}},433:function(t,e,s){"use strict";function i(t,e){if(null!==e){t.push(e.length);for(const s of e)s.serialize(t);return t}t.push(0)}function r(t,e,s){const i=t.readInt32(),r=new Array(i);for(let n=0;n<r.length;n++)r[n]=e.deserialize(t,s);return r}s.d(e,"a",(function(){return r})),s.d(e,"b",(function(){return i}))},436:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));var i=s(14);function r(t,e){if(t&&"name"in t){const s=t;return e&&e.error(new i.a(s.name,s.message,s.details)),!1}return!0}},439:function(t,e,s){"use strict";var i=s(4),r=s(419),n=s(275),o=s(458),a=s(433);const c=i.a.getLogger("esri/views/2d/engine/webgl/collisions/Metric");class h{constructor(t,e,s,i,r){this.id=t,this.range=e,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=Object(n.b)(s,i),this.baseZoom=r}add(t,e,s){t.x=t.x+e,t.y=t.y+s,this.bounds?this.boxes?(this.boxes.push(t),this.bounds.extend(t)):(this.boxes=[this.bounds,t],this.bounds=this.bounds.clone(),this.bounds.extend(t)):this.bounds=t}computeIndex(){const t=this.anchor[0],e=this.anchor[1],s=Math.floor(t/r.d),i=Math.floor(e/r.d);this.xBucket=s,this.yBucket=i;const n=r.F/r.d;if(this.hasVV)return this.xOverflow=n,void(this.yOverflow=n);this.xOverflow=Math.min(n,Math.ceil(2*this.bounds.width/r.d)),this.yOverflow=Math.min(n,Math.ceil(2*this.bounds.height/r.d))}findCollisionDelta(t){const e=this.bounds.findCollisionDelta(t.bounds),s=this.boxes&&this.boxes.length,i=t.boxes&&t.boxes.length;return Math.abs(e)>r.f||!s&&!i?e:s&&i?this._boxesToBoxes(t):s?this._boxesToBox(t):this._boxToBoxes(t)}computeVVOffset(t,e){e||c.error("mapview-labeling","Unable to compute label offset. Expected an evaluator function but found "+e);let s=this.size;if(this.hasVV){const i=e(t);s=isNaN(i)||null==i||i===1/0?this.size:i}this._computeOffset(s)}setPlacementOffset(t,e,s,i,r){this.hasVV=t,this.size=e,this.placementPadding=Math.round(s),this.directionX=i,this.directionY=r}clone(){const t=new h(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return t.minZoom=this.minZoom,this.bounds&&(t.bounds=this.bounds.clone()),this.boxes&&(t.boxes=this.boxes.map(t=>t.clone())),t.xBucket=this.xBucket,t.yBucket=this.yBucket,t.xOverflow=this.xOverflow,t.yOverflow=this.yOverflow,t.hasVV=this.hasVV,t.size=this.size,t.directionX=this.directionX,t.directionY=this.directionY,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t}_boxToBoxes(t){let e=-1/0;for(const s of t.boxes){const t=this.bounds.findCollisionDelta(s);e=Math.max(t,e)}return e}_boxesToBox(t){let e=this.boxes[0].findCollisionDelta(t.bounds);for(let s=1;s<this.boxes.length;s++){const i=this.boxes[s].findCollisionDelta(t.bounds);e=Math.max(i,e)}return e}_boxesToBoxes(t){let e=-1/0;for(let s=0;s<this.boxes.length;s++){const i=this.boxes[s];for(const s of t.boxes){const t=i.findCollisionDelta(s);e=Math.max(t,e)}}return e}_computeOffset(t){this.offsetX=this.directionX*(t/2+this.placementPadding),this.offsetY=this.directionY*(t/2+this.placementPadding)}serialize(t){return t.push(this.id),this.bounds.serialize(t),t.push(this.range.from),t.push(this.range.count),t.push(this.anchor[0]),t.push(this.anchor[1]),t.push(this.baseZoom),t.push(this.hasVV?1:0),t.push(this.size),t.writeF32(this.directionX),t.writeF32(this.directionY),t.push(this.offsetX),t.push(this.offsetY),t.push(this.placementPadding),Object(a.b)(t,this.boxes),t}static deserialize(t){const e=t.readInt32(),s=o.a.deserialize(t),i={from:t.readInt32(),count:t.readInt32()},r=t.readInt32(),n=t.readInt32(),c=t.readInt32(),l=t.readInt32(),u=t.readInt32(),d=t.readF32(),f=t.readF32(),p=t.readInt32(),m=t.readInt32(),_=t.readInt32(),y=Object(a.a)(t,o.a),x=new h(e,i,r,n,c);return x.bounds=s,x.boxes=y,x.setPlacementOffset(!!l,u,_,d,f),x.offsetX=p,x.offsetY=m,x.computeIndex(),l||x._computeOffset(u),x}}e.a=h},440:function(t,e,s){"use strict";var i=s(421),r=class{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(t,e,s){for(const i in t)this.vertexData.set(i,t[i]);for(const i in this.vertexData)null===t[i]&&this.vertexData.delete(i);this.vertexCount=e,this.indexData=s}};class n{constructor(t,e,s,i=0,r=0){this.id=t,this.geometryType=e,this.materialKey=s,this.minZoom=i,this.maxZoom=r,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const t=new n(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}setMeshDataFromBuffers(t,e,s){const n=new r;for(const r in e){const s=e[r].stride,o=e[r].data,a=[],c=Object(i.o)(s);for(let e=0;e<s*t.vertexCount/c;++e)a[e]=o[e+s*t.vertexFrom/c];n.vertexData.set(r,a)}n.indexData.length=0;for(let i=0;i<t.indexCount;++i)n.indexData[i]=s[i+t.indexFrom]-t.vertexFrom;n.vertexCount=t.vertexCount,this.meshData=n}readMeshDataFromBuffers(t,e){this.meshData?this.meshData.clear():this.meshData=new r;for(const s in t){const e=t[s].stride,r=t[s].data,n=[],o=Object(i.o)(e);for(let t=0;t<e*this.vertexCount/o;++t)n[t]=r[t+e*this.vertexFrom/o];this.meshData.vertexData.set(s,n)}this.meshData.indexData.length=0;for(let s=0;s<this.indexCount;++s)this.meshData.indexData[s]=e[s+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(t,e,s,r){for(const n in e){const s=e[n].stride,r=this.meshData.vertexData.get(n),o=e[n].data,a=Object(i.o)(s);for(let e=0;e<s*this.meshData.vertexCount/a;++e)o[e+s*t/a]=r[e]}for(let i=0;i<this.meshData.indexData.length;++i)r[i+s]=this.meshData.indexData[i]+t;this.vertexFrom=t,this.vertexCount=this.meshData.vertexCount,this.indexFrom=s,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(t,e,s){let i=0,r=0;for(const n of t)n.writeMeshDataToBuffers(i,e,r,s),i+=n.vertexCount,r+=n.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(t){return t.push(this.geometryType),t.push(this.materialKey),t.push(this.vertexFrom),t.push(this.vertexCount),t.push(this.indexFrom),t.push(this.indexCount),t.push(this.minZoom),t.push(this.maxZoom),t}static deserialize(t,e){const s=t.readInt32(),i=t.readInt32(),r=new n(e.id,s,i);return r.vertexFrom=t.readInt32(),r.vertexCount=t.readInt32(),r.indexFrom=t.readInt32(),r.indexCount=t.readInt32(),r.minZoom=t.readInt32(),r.maxZoom=t.readInt32(),r}}e.a=n},441:function(t,e,s){"use strict";e.a=class{constructor(t,e){this._pos=0;const s=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(s),this._buffer=new t(this._array),this._ctor=t}get length(){return this._pos}_roundToNearest(t,e){const s=Math.round(t);return s+(e-s%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.5*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),s=new ArrayBuffer(e),i=new this._ctor(s);i.set(this._buffer,0),this._array=s,this._buffer=i}}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}getValue(t){return this._buffer[t]}incr(t){this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){const t=this._array,e=[];for(let s=0;s<t.byteLength/4;s++)e.push(t[s]);return e}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}},448:function(t,e,s){"use strict";s.d(e,"a",(function(){return l})),s.d(e,"b",(function(){return c})),s.d(e,"c",(function(){return h})),s.d(e,"d",(function(){return a}));Number.POSITIVE_INFINITY;const i=Math.PI,r=128/i,n=1/Math.LN2;function o(t,e){return(t%=e)>=0?t:t+e}function a(t){return o(t*r,256)}function c(t){return o(.7111111111111111*t,256)}function h(t){return Math.log(t)*n}function l(t,e,s){return t>=e&&t<=s||t>=s&&t<=e}},453:function(t,e,s){"use strict";var i=s(440),r=s(433),n=s(439);class o{constructor(t){this.insertAfter=null,this.id=t,this.displayRecords=[],this.metrics=[]}copy(){const t=new o(this.id);return t.set(this),t}clone(){const t=new o(this.id);return t.displayRecords=this.displayRecords.map(t=>t.clone()),t.metrics=this.metrics.map(t=>t.clone()),t.insertAfter=this.insertAfter,t}set(t){this.id=t.id,this.displayRecords=t.displayRecords,this.metrics=t.metrics,this.insertAfter=t.insertAfter}serialize(t){return t.push(this.id),Object(r.b)(t,this.metrics),Object(r.b)(t,this.displayRecords),t}static deserialize(t){const e=t.readInt32(),s=new o(e),a={id:e},c=Object(r.a)(t,n.a);return c.length&&(s.metrics=c),s.displayRecords=Object(r.a)(t,i.a,a),s}}e.a=o},459:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s(421);class r{constructor(t,e,s){this.data=t,this.stride=e,this.vertexCount=s}static decode(t){const e=Object(i.c)(t.data,t.stride),s=t.stride,n=t.vertexCount;return new r(e,s,n)}static fromVertexVector(t){const e=Object(i.c)(t.data.buffer(),t.stride),s=t.stride,n=t.vertexCount;return new r(e,s,n)}}class n{constructor(t,e,s){this.geometryType=t,this.indexBuffer=new Uint32Array(e),this.namedBuffers=s}static decode(t){const e=t.geometryType,s=t.indexBuffer,i={};for(const n in t.namedBuffers)i[n]=r.decode(t.namedBuffers[n]);return new n(e,s,i)}static fromVertexVectors(t){const e=t.geometryType,s=t.indexVector.buffer(),i={};for(const n in t.namedVectors)i[n]=r.fromVertexVector(t.namedVectors[n]);return new n(e,s,i)}}},460:function(t,e,s){"use strict";function i(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}s.d(e,"a",(function(){return i}))},461:function(t,e,s){"use strict";s.d(e,"a",(function(){return h}));var i=s(440),r=s(433),n=s(439),o=s(453),a=class{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}},c=s(441);class h{constructor(t,e){this.vertexVectorsMap=t,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0;const s=4*(4*e.features+1),i=4*(8*e.records+1),r=4*(20*e.metrics+1);this._bufDisplayObjects=new c.a(Uint32Array,s+4),this._bufDisplayRecords=new c.a(Uint32Array,i+4),this._bufMetrics=new c.a(Uint32Array,r+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}get vertexBuffersMap(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(let t=0;t<this.vertexVectorsMap.length;t++)this._vertexBuffersMap[t]=this.vertexVectorsMap[t].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}get(t){return this.vertexVectorsMap[t]}currentDisplayRecordCount(){return this._bufDisplayRecords[this._currentRecordOffset]}writeDisplayObject(t,e){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0}hasDisplayRecords(){return!(0===this._currentRecordOffset)}endDisplayObject(){this.hasDisplayRecords()||this._rollbackDisplayObject()}writeDisplayRecord(t,e,s,i,r,n,o=0,a=0){0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(o),this._bufDisplayRecords.push(a)}writeMetrics(t){0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),Object(r.b)(this._bufMetrics,t)}static deserializeDisplayObjects(t){const{bufDisplayObjects:e,bufMetrics:s,bufRecords:c}=t,h=new a(e),l=new a(c),u=new a(s),d=[];let f=h.readInt32();for(l.readInt32(),u.readInt32();f--;){const t=h.readInt32(),e=h.readInt32(),s=h.readInt32(),a=h.readInt32(),c=new o.a(t);0!==e&&(c.insertAfter=e),0!==s&&(c.displayRecords=Object(r.a)(l,i.a,{id:t})),0!==a&&(c.metrics=Object(r.a)(u,n.a)),d.push(c)}return d}encode(t,e){const s={};for(let i=0;i<this.vertexVectorsMap.length;i++){const t=this.vertexVectorsMap[i];s[i]={},t.transfer(s[i],e)}t.bufDisplayObjects=this._bufDisplayObjects.buffer(),t.bufRecords=this._bufDisplayRecords.buffer(),t.bufMetrics=this._bufMetrics.buffer(),e.push(t.bufDisplayObjects),e.push(t.bufMetrics),e.push(t.bufRecords),t.vertexBuffersMap=s,this.destroy()}destroy(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}_rollbackDisplayObject(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}},464:function(t,e,s){"use strict";var i=s(22),r=s(431),n=s(442),o=s(422),a=s(424),c=s(465),h=s(432);class l extends(Object(c.a)(h.a)){constructor(t,e,s,n,a,c,h,l,u,d,f,p,m,_,y,x,b,g=!1){super(),this._xOffset=Object(i.d)(p),this._yOffset=Object(i.d)(m),this._decoration=u||"none",this._color=n,this._haloColor=a,this._haloSize=Math.min(Math.floor(5*Object(i.d)(Object(i.f)(s))),127),this._size=Math.min(Math.round(Object(i.d)(e)),127);const O=Math.min(Math.round(Object(i.d)(e)),127);this._referenceSize=Math.round(Math.sqrt(256*O)),this._scale=this._size/24,this._angle=f,this._justify=Object(r.c)(c||"center"),this._xAlignD=Object(r.d)(c||"center"),this._yAlignD=Object(r.f)(h||"baseline"),this._baseline="baseline"===(h||"baseline"),this._bitset=(1===l?1:0)|(d?1:0)<<1;const v=o.e.load(t);v.sdf=!0,this._materialKey=v.data,this._lineWidth=Object(i.d)(_)||512,this._lineHeight=y||1,this._textPlacement=x,this.effects=b,this._isCIM=g}static fromText(t,e){const s=new l(t.materialKey,t.font.size,t.haloSize||0,t.color&&Object(a.d)(t.color)||0,t.haloColor&&Object(a.d)(t.haloColor)||0,t.horizontalAlignment,t.verticalAlignment,0,t.font.decoration,!1,t.angle||0,t.xoffset,t.yoffset,t.lineWidth,t.lineHeight,null,null,!1),[,i]=Object(n.a)(t.text);return s.bindTextInfo(e,i),s}static fromCIMText(t,e){const s=t.scaleFactor||1,i=new l(t.materialKey,t.size*t.sizeRatio*s,t.outlineSize*t.sizeRatio,Object(a.c)(t.color),Object(a.c)(t.outlineColor),t.horizontalAlignment,t.verticalAlignment,t.alignment,t.decoration,t.colorLocked,t.angle,t.offsetX*t.sizeRatio*s,t.offsetY*t.sizeRatio*s,512,1,t.markerPlacement,t.effects,!0),[,r]=Object(n.a)(t.text);return i.bindTextInfo(e,r),i}}e.a=l},465:function(t,e,s){"use strict";var i=s(6),r=s(22),n=s(425),o=s(419),a=s(423),c=s(466),h=s(420),l=s(422),u=s(467);e.a=t=>class extends t{constructor(...t){super(...t),this._isCIM=!1,this.geometryType=h.d.TEXT,this._aux=Object(a.b)(0,0,this._referenceSize,this._bitset)}bindTextInfo(t,e){t&&t.length?this._shapingInfo=Object(i.a)(t,t=>Object(c.a)(t,e,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:o.n*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):this._shapingInfo=null}writeMeshWithGeometry(t,e,s,r,o,a){if(Object(i.h)(this._textPlacement)){const i=null!=a?a:s.readLegacyGeometry();return this._writePlacedText(t,e,o,i)}const c=a?Object(n.p)(Object(n.d)(a),2):"esriGeometryPolygon"===r?s.readCentroid():s.readUnquantizedGeometry();if(c){if(c.isPoint){const[s,i]=c.coords;return this._writeGlyphs(t,e,o,{x:s,y:i})}c.forEachVertex((s,i)=>this._writeGlyphs(t,e,o,{x:s,y:i}))}}_writePlacedText(t,e,s,n){const o=this._shapingInfo;if(Object(i.g)(o))return;const c=l.e.load(this._materialKey),h=Object(i.n)(this._textPlacement),d=u.a.getPlacement(n,h,Object(r.d)(1));if(!d)return;let f,p,m=d.next();for(;null!=m;){p=Object(a.a)(Math.round(8*m.tx),Math.round(8*m.ty)),f=m.getAngle(),o.setRotation(f);for(const i of o.glyphs){c.textureBinding=i.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,o=this._writeIndices(e),a=this._writeVertex(e,s,p,i);t.writeDisplayRecord(this.geometryType,c.data,r,a,n,o)}o.setRotation(-f),m=d.next()}}_writeGlyphs(t,e,s,r){const n=this._shapingInfo;if(Object(i.g)(n))return;const o=l.e.load(this._materialKey),c=Object(a.a)(Math.round(8*r.x),Math.round(8*r.y));for(const i of n.glyphs){o.textureBinding=i.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,a=this._writeIndices(e),h=this._writeVertex(e,s,c,i);t.writeDisplayRecord(this.geometryType,o.data,r,h,n,a)}}_writeVertexCommon(t,e,s,i){const r=this._color,n=this._haloColor,o=Object(a.b)(0,0,this._referenceSize,this._bitset),c=Object(a.b)(0,0,this._size,this._haloSize);t.push(s),t.push(e),t.push(r),t.push(n),t.push(c),t.push(o)}_writeVertex(t,e,s,i){const r=t.get("geometry");return this._writeVertexCommon(r,e,s,i),r.push(i.offsets.upperLeft),r.push(i.texcoords.upperLeft),this._writeVertexCommon(r,e,s,i),r.push(i.offsets.upperRight),r.push(i.texcoords.upperRight),this._writeVertexCommon(r,e,s,i),r.push(i.offsets.lowerLeft),r.push(i.texcoords.lowerLeft),this._writeVertexCommon(r,e,s,i),r.push(i.offsets.lowerRight),r.push(i.texcoords.lowerRight),4}_writeIndices(t){const e=t.getVector("geometry").vertexCount,s=t.indexVector;return s.push(e+0),s.push(e+1),s.push(e+2),s.push(e+1),s.push(e+3),s.push(e+2),6}}},467:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var i=s(46),r=s(277);class n{static getPlacement(t,e,s){const n=Object(r.b)(e);if(!n)return null;const o=Object(i.c)(t);return n.execute(o,e,s)}}},468:function(t,e,s){"use strict";var i=s(6),r=s(22),n=s(419),o=s(301),a=s(275),c=s(423),h=s(422),l=s(424),u=s(432),d=s(469);class f extends(Object(d.a)(u.a)){constructor(t,e,s,i,r,l,u,d,f,p,m,_,y,x,b,g,O,v,M,j,w){super(),this.angle=i,this.height=u,this.width=l,this.xOffset=e*M,this.yOffset=s*M,this._markerPlacement=j,this.effects=w,this._anchorX=.5-(.5+g)*b.width/b.width,this._anchorY=.5-(.5+O)*b.height/b.height;const S=(1===x?1:0)|(m?1:0)<<1|(y?1:0)<<2|(_?1:0)<<3,T=b&&b.sdf,z=h.d.load(t);z.sdf=T,z.pattern=!0,z.textureBinding=b.textureBinding,this._materialKey=z.data,this._fillColor=r,this._outlineColor=f,this._sizeOutlineWidth=Object(c.b)(Math.round(Math.min(Math.sqrt(128*l),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*p),255)),Math.round(Math.min(Math.sqrt(128*d),255)));const L=b.rect.x+n.r,C=b.rect.y+n.r,I=L+b.width,V=C+b.height;this._texUpperLeft=Object(c.a)(L,C),this._texUpperRight=Object(c.a)(I,C),this._texBottomLeft=Object(c.a)(L,V),this._texBottomRight=Object(c.a)(I,V),l*=v,u*=v,l*=M,u*=M;const D=Math.round(Math.min(64*v,255));this._bitestAndDistRatio=Object(c.b)(0,0,S,D),this._computedWidth=l,this._computedHeight=u;const P=Object(a.a)(),R=Object(o.a)();this._applyTransformation(R,P)}static fromCIMMarker(t,e){const s=e&&e.width||1,n=e&&e.height||1,o=t.size,a=s/n*t.scaleX,c=t.scaleSymbolsProportionally&&t.frameHeight?o/t.frameHeight:1,h=Object(l.c)(t.color),u=Object(l.c)(t.outlineColor),d=Object(r.d)(o),p=d*a,m=Object(r.d)(t.offsetX||0),_=Object(r.d)(t.offsetY||0),y=Object(r.d)(t.outlineWidth||0)*c,x=t.alignment||0,b=Object(r.d)(t.referenceSize);let g=t.rotation||0;t.rotateClockwise||(g=-g);let O=0,v=0;const M=t.anchorPoint;return M&&(t.isAbsoluteAnchorPoint?o&&(O=-M.x/(o*a),v=M.y/o):(O=M.x,v=M.y)),new f(t.materialKey,m,_,g,h,p,d,b,u,y,t.colorLocked,t.scaleSymbolsProportionally,!1,x,e,O,v,t.sizeRatio,Object(i.o)(t.scaleFactor,1),t.markerPlacement,t.effects)}static fromPictureMarker(t,e){const s=Math.round(Object(r.d)(t.width)),i=Math.round(Object(r.d)(t.height)),o=n.q,a=Math.round(Object(r.d)(t.xoffset||0)),c=Math.round(Object(r.d)(t.yoffset||0));return new f(t.materialKey,a,c,t.angle,o,s,i,i,0,0,!1,!1,!1,0,e,0,0,1,1,null,null)}static fromSimpleMarker(t,e){const s=Object(l.d)(t.color),i=Math.round(Object(r.d)(t.size)),n=i,o=Math.round(Object(r.d)(t.xoffset||0)),a=Math.round(Object(r.d)(t.yoffset||0)),c=t.style,h=t.outline,u=0|(h&&h.color&&Object(l.d)(h.color)),d=0|(h&&h.width&&Math.round(Object(r.d)(h.width))),p=new f(t.materialKey,o,a,t.angle,s,i,n,n,u,d,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,e,0,0,126/64,1,null,null);return p.boundsType="esriSMSCircle"===c?"circle":"square",p}static fromLineSymbolMarker(t,e){const s=Object(l.d)(t.color),i=Math.round(Object(r.d)(6*t.lineWidth)),n=i,o="cross"===t.style||"x"===t.style;let a;switch(t.placement){case"begin-end":a="Both";break;case"begin":a="JustBegin";break;case"end":a="JustEnd";break;default:a="None"}const c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:a,offsetAlongLine:0},h=new f(t.materialKey,0,0,0,s,i,n,n/6,s,o?Math.round(Object(r.d)(t.lineWidth)):0,!1,!1,o,1,e,0,0,126/64,1,c,null);return h.boundsType="circle"===t.style?"circle":"square",h}}e.a=f},469:function(t,e,s){"use strict";var i=s(6),r=s(22),n=s(425),o=s(30),a=s(72),c=s(301),h=s(275),l=s(423),u=s(420),d=s(467);e.a=t=>class extends t{constructor(...t){super(...t),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this.geometryType=u.d.MARKER}writeMeshWithGeometry(t,e,s,r,o,a){const c=e.indexVector,h=e.get("geometry"),l=e.getVector("geometry"),u=l.vertexCount,d=u,f=c.length;if(Object(i.h)(this._markerPlacement)){const t=null!=a?a:s.readLegacyGeometry();this._writePlacedMarkers(h,c,u,o,t)}else{const t=a?Object(n.p)(Object(n.d)(a),2):"esriGeometryPolygon"===r?s.readCentroid():s.readUnquantizedGeometry();if(!t)return;if(t.isPoint){const[e,s]=t.coords;this._writeVertices(h,o,this._getPos(e,s)),this._writeIndices(c,u)}else t.forEachVertex((t,e)=>{const s=l.vertexCount;this._writeVertices(h,o,this._getPos(t,e)),this._writeIndices(c,s)})}const p=e.getVector("geometry").vertexCount-d,m=c.length-f;t.writeDisplayRecord(this.geometryType,this._materialKey,d,p,f,m)}_applyTransformation(t,e,s=0){Object(a.d)(t),Object(a.h)(t,t,Object(h.b)(this.xOffset,-this.yOffset)),this.angle+s!==0&&Object(a.f)(t,t,.017453292519944444*(this.angle+s));const i=this._computedWidth,r=this._computedHeight,n=(this._anchorX-.5)*i,c=(this._anchorY-.5)*r;Object(o.m)(e,n,c),Object(o.n)(e,e,t),this._offsetUpperLeft=Object(l.a)(16*e[0],16*e[1]),Object(o.m)(e,n+i,c),Object(o.n)(e,e,t),this._offsetUpperRight=Object(l.a)(16*e[0],16*e[1]),Object(o.m)(e,n,c+r),Object(o.n)(e,e,t),this._offsetBottomLeft=Object(l.a)(16*e[0],16*e[1]),Object(o.m)(e,n+i,c+r),Object(o.n)(e,e,t),this._offsetBottomRight=Object(l.a)(16*e[0],16*e[1])}_writePlacedMarkers(t,e,s,n,o){const a=d.a.getPlacement(o,Object(i.n)(this._markerPlacement),Object(r.d)(1));if(!a)return;const l=Object(h.a)(),u=Object(c.a)();let f=0,p=a.next();for(;null!=p;)p.tx>=-128&&p.tx<=640&&p.ty>=-128&&p.ty<=640&&(this._applyTransformation(u,l,p.getAngle()/.017453292519944444),this._writeVertices(t,n,this._getPos(p.tx,p.ty)),this._writeIndices(e,s+f),f+=4),p=a.next()}_getPos(t,e){return Object(l.a)(Math.round(8*t),Math.round(8*e))}_writeVertices(t,e,s){t.push(s),t.push(this._offsetUpperLeft),t.push(this._texUpperLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(s),t.push(this._offsetUpperRight),t.push(this._texUpperRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(s),t.push(this._offsetBottomLeft),t.push(this._texBottomLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(s),t.push(this._offsetBottomRight),t.push(this._texBottomRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth)}_writeIndices(t,e){const s=e;t.push(s+0),t.push(s+1),t.push(s+2),t.push(s+1),t.push(s+3),t.push(s+2)}}},470:function(t,e,s){"use strict";s.d(e,"a",(function(){return Bt})),s.d(e,"b",(function(){return At}));var i=s(4),r=s(14),n=s(8),o=s(312),a=s(436),c=s(445),h=s(464),l=s(468),u=s(53),d=s(22),f=s(419),p=s(423),m=s(422),_=s(424),y=s(448),x=s(427),b=s(425),g=s(420),O=s(435),v=(s(511),s(457));function M(t,e,s,i,r,n,o){N=0;const a=(i-s)*n,c=r&&r.length,h=c?(r[0]-s)*n:a;let l,u,d,f,p,m=j(e,s,i,0,h,n,!0);if(m&&m.next!==m.prev){if(c&&(m=function(t,e,s,i,r,n){const o=new Array;for(let a=0,c=i.length;a<c;a++){const r=j(t,e,s,i[a]*n,a<c-1?i[a+1]*n:s*n,n,!1);r===r.next&&(r.steiner=!0),o.push(I(r))}o.sort(B);for(const a of o)V(a,r),r=w(r,r.next);return r}(e,s,i,r,m,n)),a>80*n){l=d=e[0+s*n],u=f=e[1+s*n];for(let t=n;t<h;t+=n){const i=e[t+s*n],r=e[t+1+s*n];l=Math.min(l,i),u=Math.min(u,r),d=Math.max(d,i),f=Math.max(f,r)}p=Math.max(d-l,f-u),p=0!==p?1/p:0}S(m,t,n,l,u,p,o,0)}}function j(t,e,s,i,r,n,o){let a;if(o===function(t,e,s,i,r,n){let o=0;for(let a=i,c=r-n;a<r;a+=n)o+=(t[c+e*n]-t[a+e*n])*(t[a+1+e*n]+t[c+1+e*n]),c=a;return o}(t,e,0,i,r,n)>0)for(let c=i;c<r;c+=n)a=L(c+e*n,t[c+e*n],t[c+1+e*n],a);else for(let c=r-n;c>=i;c-=n)a=L(c+e*n,t[c+e*n],t[c+1+e*n],a);return a&&A(a,a.next)&&(C(a),a=a.next),a}function w(t,e=t){if(!t)return t;let s,i=t;do{if(s=!1,i.steiner||!A(i,i.next)&&0!==D(i.prev,i,i.next))i=i.next;else{if(C(i),i=e=i.prev,i===i.next)break;s=!0}}while(s||i!==e);return e}function S(t,e,s,i,r,n,o,a){if(!t)return;!a&&n&&(t=function t(e,s,i,r){for(let n;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=k(n.x,n.y,s,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,t(e,s,i,r);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(t){let e,s=1;for(;;){let i,r=t;t=null,e=null;let n=0;for(;r;){n++,i=r;let o=0;for(;o<s&&i;o++)i=i.nextZ;let a=s;for(;o>0||a>0&&i;){let s;0===o?(s=i,i=i.nextZ,a--):0!==a&&i?r.z<=i.z?(s=r,r=r.nextZ,o--):(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,o--),e?e.nextZ=s:t=s,s.prevZ=e,e=s}r=i}if(e.nextZ=null,s*=2,n<2)return t}}(e)}(t,i,r,n));let c=t;for(;t.prev!==t.next;){const h=t.prev,l=t.next;if(n?z(t,i,r,n):T(t))e.push(h.index/s+o),e.push(t.index/s+o),e.push(l.index/s+o),C(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?S(t=E(t,e,s,o),e,s,i,r,n,o,2):2===a&&Z(t,e,s,i,r,n,o):S(w(t),e,s,i,r,n,o,1);break}}}function T(t){const e=t.prev,s=t,i=t.next;if(D(e,s,i)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,R(e.x,e.y,s.x,s.y,i.x,i.y,r.x,r.y)&&D(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function z(t,e,s,i){const r=t.prev,n=t,o=t.next;if(D(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,c=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,h=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,l=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,u=k(a,c,e,s,i),d=k(h,l,e,s,i);let f=t.prevZ,p=t.nextZ;for(;f&&f.z>=u&&p&&p.z<=d;){if(f!==t.prev&&f!==t.next&&R(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&D(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,p!==t.prev&&p!==t.next&&R(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&D(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&R(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&D(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=d;){if(p!==t.prev&&p!==t.next&&R(r.x,r.y,n.x,n.y,o.x,o.y,p.x,p.y)&&D(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function L(t,e,s,i){const r=K.create(t,e,s);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function C(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t){let e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function V(t,e){if(e=function(t,e){let s=e;const i=t.x,r=t.y;let n,o=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){const t=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(t<=i&&t>o){if(o=t,t===i){if(r===s.y)return s;if(r===s.next.y)return s.next}n=s.x<s.next.x?s:s.next}}s=s.next}while(s!==e);if(!n)return null;if(i===o)return n.prev;const a=n,c=n.x,h=n.y;let l,u=1/0;for(s=n.next;s!==a;)i>=s.x&&s.x>=c&&i!==s.x&&R(r<h?i:o,r,c,h,r<h?o:i,r,s.x,s.y)&&(l=Math.abs(r-s.y)/(i-s.x),(l<u||l===u&&s.x>n.x)&&F(s,t)&&(n=s,u=l)),s=s.next;return n}(t,e)){const s=U(e,t);w(s,s.next)}}function D(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function P(t,e,s,i){return!!(A(t,e)&&A(s,i)||A(t,i)&&A(s,e))||D(t,e,s)>0!=D(t,e,i)>0&&D(s,i,t)>0!=D(s,i,e)>0}function R(t,e,s,i,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(i-a)-(s-o)*(e-a)>=0&&(s-o)*(n-a)-(r-o)*(i-a)>=0}function F(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function k(t,e,s,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function A(t,e){return t.x===e.x&&t.y===e.y}function B(t,e){return t.x-e.x}function E(t,e,s,i){let r=t;do{const n=r.prev,o=r.next.next;!A(n,o)&&P(n,r,r.next,o)&&F(n,o)&&F(o,n)&&(e.push(n.index/s+i),e.push(r.index/s+i),e.push(o.index/s+i),C(r),C(r.next),r=t=o),r=r.next}while(r!==t);return r}function Z(t,e,s,i,r,n,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&G(a,t)){let c=U(a,t);return a=w(a,a.next),c=w(c,c.next),S(a,e,s,i,r,n,o,0),void S(c,e,s,i,r,n,o,0)}t=t.next}a=a.next}while(a!==t)}function G(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let s=t;do{if(s.index!==t.index&&s.next.index!==t.index&&s.index!==e.index&&s.next.index!==e.index&&P(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&F(t,e)&&F(e,t)&&function(t,e){let s=t,i=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{s.y>n!=s.next.y>n&&s.next.y!==s.y&&r<(s.next.x-s.x)*(n-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)}function U(t,e){const s=K.create(t.index,t.x,t.y),i=K.create(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,s.next=r,r.prev=s,i.next=s,s.prev=i,n.next=i,i.prev=n,i}class K{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,s){const i=X[N++];return i.index=t,i.x=e,i.y=s,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}const X=new Array;let N=0;for(let Et=0;Et<8096;Et++)X.push(new K);const W=new(s(491).a),Y=new v.b(0,0,0,1,128);function H(t,e,s){let i=0;for(let r=1;r<s;r++){const s=t[2*(e+r-1)],n=t[2*(e+r-1)+1];i+=(t[2*(e+r)]-s)*(t[2*(e+r)+1]+n)}return i}function q(t,e,s,i,r){let n=0;for(let o=s;o<i;o+=3){const s=2*(t.getValue(o)-r),i=2*(t.getValue(o+1)-r),a=2*(t.getValue(o+2)-r);n+=Math.abs((e[s]-e[a])*(e[i+1]-e[s+1])-(e[s]-e[i])*(e[a+1]-e[s+1]))}return n}Y.setExtent(f.F);var Q=t=>class extends t{constructor(...t){super(...t),this.forceLibtess=!1,this.geometryType=g.d.FILL}writeMeshWithGeometry(t,e,s,i,r,n){const o=m.a.load(this._materialKey),a=e.indexVector,c=e.getVector("geometry"),h=c.vertexCount,l=a.length;let u=n?Object(b.p)(Object(b.d)(n),2):s.readUnquantizedGeometry();if(!u)return;if(u=function(t){if(!function(t,e,s){let i=0;for(let r=0;r<t.lengths.length;r++){const e=t.lengths[r];for(let r=0;r<e;r++){const e=t.coords[2*(r+i)],n=t.coords[2*(r+i)+1];if(e<-128||e>s||n<-128||n>s)return!0}i+=e}return!1}(t,0,f.F+128))return t;Y.reset(3);let e=0;for(let n=0;n<t.lengths.length;n++){const s=t.lengths[n];let i=t.coords[2*(0+e)],r=t.coords[2*(0+e)+1];Y.moveTo(i,r);for(let n=1;n<s;n++)i=t.coords[2*(n+e)],r=t.coords[2*(n+e)+1],Y.lineTo(i,r);Y.close(),e+=s}const s=Y.result(!1);if(!s)return null;const i=[],r=[];for(const n of s){let t=0;for(const e of n)r.push(e.x),r.push(e.y),t++;i.push(t)}return new O.a(i,r)}(u),!u)return;let d=u.coords;!this.forceLibtess&&function(t,e,s){const{coords:i,lengths:r,hasIndeterminateRingOrder:n}=e;if(n)return!1;const o=t.length;let a=0;for(let c=0;c<r.length;){let e=c,n=r[c],h=H(i,a,n);const l=[];for(;++e<r.length;){const t=r[e],s=H(i,a+n,t);if(!(s>0))break;h+=s,l.push(a+n),n+=t}const u=t.length;M(t,i,a,a+n,l,2,s);const d=q(t,i,u,t.length,s),f=Math.abs(h);if(Math.abs((d-f)/Math.max(1e-7,f))>1e-5)return t.seek(o),!1;c=e,a+=n}return!0}(a,u,h)||(d=[],function(t,e,s,i){const r=[],{coords:n,lengths:o}=s;W.beginPolygon(t,r);let a=0;for(let c=0;c<o.length;c++){const t=s.lengths[c];W.beginContour();for(let e=0;e<t;e++){const t=[n[2*(a+e)],n[2*(a+e)+1],0];W.addVertex(t,t)}W.endContour(),a+=t}W.endPolygon();for(let c=0;c<r.length;c++)e.push(r[c]+i)}(d,a,u,h)),this._write(c,s,r,d,o);const p=c.vertexCount-h,_=a.length-l;t.writeDisplayRecord(this.geometryType,this._materialKey,h,p,l,_)}_write(t,e,s,i,r){for(let n=0;n<i.length;n+=2){const o=Object(p.a)(1*i[n],1*i[n+1]);t.data.push(o),t.data.push(s),r.dotDensity?t.data.writeF32(1/Math.abs(e.readGeometryArea())):(t.data.push(this.fillColor),t.data.push(this.tl),t.data.push(this.br),t.data.push(this.aux1),t.data.push(this.aux2),t.data.push(this.aux3))}}},J=s(276),$=s(432);const tt=i.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate");var et=class extends $.a{constructor(t){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=t}analyze(t,e,s,i){const r=e.readLegacyFeature(),o=this._materialCache,a=this._cimLayer.materialHash;if(!a)return tt.error("A Dynamic mesh template must have a material hash value or function!"),Object(n.t)(null);const c="function"==typeof a?a(r,s,i):a;if(o.has(c)){const t=o.get(c);return Object(n.u)(t)}if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);const h=Object(J.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);h.mosaicHash=c;const l=t.getMosaicItem(h).then(t=>(this._ongoingMaterialRequestMap.delete(c),o.set(c,t),t)).catch(t=>(this._ongoingMaterialRequestMap.delete(c),tt.error(".analyze()",t.message),null));return this._ongoingMaterialRequestMap.set(c,l),l}};class st extends(Q(et)){constructor(t){if(super(t),Object(x.c)(t.color)){const e=(e,s,i)=>{const r=t.color(e,s,i);return r&&Object(_.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this.fillColor=e&&Object(_.c)(e)||0}let e=0;Object(x.c)(t.height)||(e=t.height||0),this._dynamicPropertyMap.set("_height",(s,i,r)=>Object(x.c)(t.height)?t.height(s,i,r):e);let s=0;Object(x.c)(t.offsetX)||(s=Object(d.d)(t.offsetX||0)+128,s>255&&(s=255)),this._dynamicPropertyMap.set("_offsetX",(e,i,r)=>{if(Object(x.c)(t.offsetX)){let s=Object(d.d)(t.offsetX(e,i,r))+128;return s>255&&(s=255),s}return s});let i=1;Object(x.c)(t.scaleX)||(i=t.scaleX||1),this._dynamicPropertyMap.set("_scaleX",(e,s,r)=>Object(x.c)(t.scaleX)?t.scaleX(e,s,r):i);let r=0;Object(x.c)(t.offsetY)||(r=Object(d.d)(-t.offsetY||0)+128,r>255&&(r=255)),this._dynamicPropertyMap.set("_offsetY",(e,s,i)=>{if(Object(x.c)(t.offsetY)){let r=Object(d.d)(-t.offsetY(e,s,i))+128;return r>255&&(r=255),r}return r});let n=0;Object(x.c)(t.angle)||(n=Object(y.d)(t.angle)||0),this._dynamicPropertyMap.set("_angle",(e,s,i)=>Object(x.c)(t.angle)?Object(y.d)(t.angle(e,s,i)):n),this.effects=t.effects,this._cimFillLayer=t,this._fillMaterialKey=m.a.load(t.materialKey)}static fromCIMFill(t){return new st(t)}bindFeature(t,e,s){const i=t.readLegacyFeature();this._dynamicPropertyMap.forEach((t,r)=>{this[r]=t(i,e,s)});const r=this._fillMaterialKey,n=this._materialCache,o=this._cimFillLayer;this.aux3=Object(p.b)(0,0,this._angle,o.colorLocked?1:0);const c=(0,o.materialHash)(i,e,s),h=n.get(c);let l=null;if(h&&Object(a.a)(h.spriteMosaicItem)&&(l=h.spriteMosaicItem),l){const{rect:t,width:e,height:s}=l,i=t.x+f.r,n=t.y+f.r,o=i+e,a=n+s;let c=Object(u.i)(Object(d.d)(this._height));c>255?c=255:c<=0&&(c=Object(u.i)(a-n));let h=Object(u.i)(Object(d.d)(this._height/s*e||0));h>255?h=255:h<=0&&(h=Object(u.i)(o-i));const m=this._scaleX,_=1;this.tl=Object(p.a)(i,n),this.br=Object(p.a)(o,a),this.aux1=Object(p.b)(h,c,this._offsetX,this._offsetY),this.aux2=Object(p.a)(128*m,128*_),r.sdf=l.sdf,r.pattern=!0,r.textureBinding=l.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,r.sdf=!1,r.pattern=!1,r.textureBinding=0;this._materialKey=r.data}}var it=st,rt=(s(5),s(492));const nt=f.F+16,ot=new v.b(0,0,0,1,16);ot.setExtent(f.F);const at=new Uint32Array(9),ct=new Uint32Array(36),ht=new Uint32Array(3),lt=new Uint32Array(6),ut=t=>e=>{lt[0]=e.leftExit0,lt[1]=e.rightEntry0,lt[2]=e.leftExit2,lt[3]=e.rightEntry0,lt[4]=e.rightEntry2,lt[5]=e.leftExit2,t.indexCount+=6,t.indexBuf.writeRegion(lt)};var dt=t=>class extends t{constructor(...t){super(...t),this.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null},this._tessellationOptions={},this.geometryType=g.d.LINE}writeMeshWithGeometry(t,e,s,i,r,n){const o=e.indexVector,a=e.get("geometry"),c=e.getVector("geometry").vertexCount,h=o.length,l=null!=n?n:s.readLegacyGeometry();if(!l)return;switch(i){case"esriGeometryPolyline":{const t=this._clipLines(l.paths);if(0===t.length)return;this._write(o,a,c,r,t);break}case"esriGeometryPolygon":{const t=this._clipLines(l.rings);if(0===t.length)return;this._write(o,a,c,r,t);break}}const u=this.tessellationProperties.vertexCount,d=this.tessellationProperties.indexCount;t.writeDisplayRecord(this.geometryType,this._materialKey,c,u,h,d)}_clipLines(t){const e=[];let s=!1,i=0;for(;i<t.length;){const r=[],n=t[i];ot.reset(2);let[o,a]=n[0];if(s)ot.moveTo(o,a);else{if(o<-16||o>nt||a<-16||a>nt){s=!0;continue}r.push({x:o,y:a})}let c=!1;const h=n.length;for(let t=1;t<h;++t)if(o+=n[t][0],a+=n[t][1],s)ot.lineTo(o,a);else{if(o<-16||o>nt||a<-16||a>nt){c=!0;break}r.push({x:o,y:a})}if(c)s=!0;else{if(s){const t=ot.resultWithStarts();if(t)for(const s of t)e.push(s)}else e.push({line:r,start:0});i++,s=!1}}return e}_write(t,e,s,i,r){this.tessellationProperties.id=i,this.tessellationProperties.indexBuf=t,this.tessellationProperties.indexCount=0,this.tessellationProperties.geometryBuf=e,this.tessellationProperties.vertexCount=0,this.tessellationProperties.offset=s;for(const n of r){const t=n.line;t.length<2||(this._tessellationOptions.initialDistance=n.start%65535,this._tessellationCallbacks instanceof rt.a&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),Object(rt.d)(t,this._tessellationOptions,this._tessellationCallbacks),Object(rt.b)())}}_initializeTessellator(t){const e=m.c.load(this._materialKey);if(this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern,this._tessellationOptions.thin=!t&&this.tessellationProperties._halfWidth<f.E/2&&!(e.vvSizeFieldStops||e.vvSizeMinMaxValue||e.vvSizeScaleStops||e.vvSizeUnitValue),this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.thin)this._tessellationCallbacks={vertex:(s=this.tessellationProperties,t=>{const e=Math.ceil(1024*s._halfWidth),i=Math.ceil(1024*s._halfReferenceWidth);t.entry0=s.offset+s.vertexCount++;{const r=Object(p.a)(t.distance,e),n=Object(p.b)(Math.round(31*t.prevNormal.x),Math.round(31*t.prevNormal.y),Math.round(0),Math.round(-31)),o=Object(p.b)(0,0,0,s._bitset);ct[0]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),ct[1]=s.id,ct[2]=s._fillColor,ct[3]=n,ct[4]=r,ct[5]=s._tl,ct[6]=s._br,ct[7]=o,ct[8]=Object(p.a)(i,0)}t.entry2=s.offset+s.vertexCount++;{const r=Object(p.a)(t.distance,e),n=Object(p.b)(Math.round(31*-t.prevNormal.x),Math.round(31*-t.prevNormal.y),Math.round(0),Math.round(31)),o=Object(p.b)(0,0,0,s._bitset);ct[9]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),ct[10]=s.id,ct[11]=s._fillColor,ct[12]=n,ct[13]=r,ct[14]=s._tl,ct[15]=s._br,ct[16]=o,ct[17]=Object(p.a)(i,0)}t.exit0=s.offset+s.vertexCount++;{const r=Object(p.a)(t.distance,e),n=Object(p.b)(Math.round(31*t.nextNormal.x),Math.round(31*t.nextNormal.y),Math.round(0),Math.round(-31)),o=Object(p.b)(0,0,0,s._bitset);ct[18]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),ct[19]=s.id,ct[20]=s._fillColor,ct[21]=n,ct[22]=r,ct[23]=s._tl,ct[24]=s._br,ct[25]=o,ct[26]=Object(p.a)(i,0)}t.exit2=s.offset+s.vertexCount++;{const r=Object(p.a)(t.distance,e),n=Object(p.b)(Math.round(31*-t.nextNormal.x),Math.round(31*-t.nextNormal.y),Math.round(0),Math.round(31)),o=Object(p.b)(0,0,0,s._bitset);ct[27]=Object(p.a)(8*t.currentVertex.x,8*t.currentVertex.y),ct[28]=s.id,ct[29]=s._fillColor,ct[30]=n,ct[31]=r,ct[32]=s._tl,ct[33]=s._br,ct[34]=o,ct[35]=Object(p.a)(i,0)}s.geometryBuf.writeRegion(ct)}),bridge:ut(this.tessellationProperties)};else{const t=new rt.a((t=>(e,s,i,r,n,o,a,c,h)=>{const l=Object(p.a)(h,Math.ceil(1024*t._halfWidth)),u=Object(p.b)(Math.round(31*n),Math.round(31*o),Math.round(31*a),Math.round(31*c)),d=Object(p.b)(31*i,31*r,0,t._bitset);return at[0]=Object(p.a)(8*e,8*s),at[1]=t.id,at[2]=t._fillColor,at[3]=u,at[4]=l,at[5]=t._tl,at[6]=t._br,at[7]=d,at[8]=Object(p.a)(Math.ceil(1024*t._halfReferenceWidth),0),t.geometryBuf.writeRegion(at),t.offset+t.vertexCount++})(this.tessellationProperties),(t=>(e,s,i)=>{ht[0]=e,ht[1]=s,ht[2]=i,t.indexCount+=3,t.indexBuf.writeRegion(ht)})(this.tessellationProperties));t.miterLimitCosine=this._miterLimitCosine,t.textured=this._isDashed||this._hasPattern,t.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=t}var s}};class ft extends(dt(et)){constructor(t){super(t),this._cimLineLayer=t;let e=0;if(Object(x.c)(t.width)||(e=.5*Object(d.d)(t.width)),this._dynamicPropertyMap.set("_halfWidth",(s,i,r)=>Object(x.c)(t.width)?.5*Object(d.d)(t.width(s,i,r)):e),Object(x.c)(t.cap)?this._dynamicPropertyMap.set("_capType",t.cap):this._capType=t.cap,Object(x.c)(t.join)?this._dynamicPropertyMap.set("_joinType",t.join):this._joinType=t.join,Object(x.c)(t.color)){const e=(e,s,i)=>{const r=t.color(e,s,i);return r&&Object(_.c)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this._fillColor=e&&Object(_.c)(e)||0}if(Object(x.c)(t.miterLimit)){const e=(e,s,i)=>Object(x.b)(t.miterLimit(e,s,i));this._dynamicPropertyMap.set("_miterLimitCosine",e)}else this._miterLimitCosine=Object(x.b)(t.miterLimit);this._scaleFactor=t.scaleFactor||1,this._isDashed=t.isDashed,this.effects=t.effects,this.tessellationProperties._bitset=t.colorLocked?1:0,this._materialKey=t.materialKey,this._initializeTessellator(!0)}static fromCIMLine(t){return new ft(t)}bindFeature(t,e,s){const i=t.readLegacyFeature();this._dynamicPropertyMap.forEach((t,r)=>{this[r]=t(i,e,s)}),this._halfWidth*=this._scaleFactor;const r=this._materialCache,n=(0,this._cimLineLayer.materialHash)(i,e,s),o=r.get(n);let c=null;if(o&&Object(a.a)(o.spriteMosaicItem)&&(c=o.spriteMosaicItem),c){this._hasPattern=!0;const{rect:t,width:e,height:s}=c,i=t.x+f.r,r=t.y+f.r,n=i+e,o=r+s;this.tessellationProperties._tl=Object(p.a)(i,r),this.tessellationProperties._br=Object(p.a)(n,o)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const h=m.c.load(this._materialKey);c&&(h.sdf=c.sdf,h.pattern=!0,h.textureBinding=c.textureBinding),this._materialKey=h.data}}var pt=ft,mt=s(6),_t=s(301),yt=s(275),xt=s(469);const bt=Object(yt.a)(),gt=Object(_t.a)(),Ot=i.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class vt extends(Object(xt.a)(et)){constructor(t){if(super(t),this._cimMarkerLayer=t,Object(x.c)(t.color)){const e=(e,s,i)=>Object(_.c)(t.color(e,s,i));this._dynamicPropertyMap.set("_fillColor",e)}else this._fillColor=Object(_.c)(t.color);if(Object(x.c)(t.outlineColor)){const e=(e,s,i)=>Object(_.c)(t.outlineColor(e,s,i));this._dynamicPropertyMap.set("_outlineColor",e)}else this._outlineColor=Object(_.c)(t.outlineColor);if(Object(x.c)(t.size)){const e=(e,s,i)=>Object(d.d)(t.size(e,s,i));this._dynamicPropertyMap.set("_size",e)}else this._size=Object(d.d)(t.size);if(Object(x.c)(t.scaleX)?this._dynamicPropertyMap.set("_scaleX",t.scaleX):this._scaleX=t.scaleX,Object(x.c)(t.offsetX)){const e=(e,s,i)=>Object(d.d)(t.offsetX(e,s,i));this._dynamicPropertyMap.set("xOffset",e)}else this.xOffset=Object(d.d)(t.offsetX);if(Object(x.c)(t.offsetY)){const e=(e,s,i)=>Object(d.d)(t.offsetY(e,s,i));this._dynamicPropertyMap.set("yOffset",e)}else this.yOffset=Object(d.d)(t.offsetY);if(Object(x.c)(t.outlineWidth)){const e=(e,s,i)=>Object(d.d)(t.outlineWidth(e,s,i));this._dynamicPropertyMap.set("_outlineWidth",e)}else this._outlineWidth=Object(d.d)(t.outlineWidth);Object(x.c)(t.rotation)?this._dynamicPropertyMap.set("_angle",t.rotation):this._angle=t.rotation,this._scaleFactor=Object(mt.o)(t.scaleFactor,1),this._markerPlacement=t.markerPlacement,this.effects=t.effects,this._bitSet=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1|(t.scaleSymbolsProportionally?1:0)<<3,this._materialKey=t.materialKey}static fromCIMMarker(t){return new vt(t)}bindFeature(t,e,s){const i=t.readLegacyFeature();this._dynamicPropertyMap.forEach((t,r)=>{this[r]=t(i,e,s)});const n=this._cimMarkerLayer.materialHash,o="function"==typeof n?n(i,e,s):n,c=this._materialCache.get(o);if(!c||!Object(a.a)(c.spriteMosaicItem)||!c.spriteMosaicItem)return void Ot.error(new r.a("mapview-cim","Encountered an error when binding feature"));const h=c.spriteMosaicItem,l=this._cimMarkerLayer.sizeRatio,u=h.width/h.height*this._scaleX,_=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let y=this._size,x=y*u;const b=this.xOffset,g=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const O=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(d.d)(this._cimMarkerLayer.frameHeight):1,v=this._outlineWidth*O,M=Object(d.d)(this._cimMarkerLayer.referenceSize);let j=0,w=0;const S=this._cimMarkerLayer.anchorPoint;S&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(j=-S.x/(this._size*u),w=S.y/this._size):(j=S.x,w=S.y)),this._sizeOutlineWidth=Object(p.b)(Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*M),255))),this.angle=_;const T=Math.round(Math.min(64*l,255));this._bitestAndDistRatio=Object(p.b)(0,0,this._bitSet,T);const z=h.rect.x+f.r,L=h.rect.y+f.r,C=z+h.width,I=L+h.height;this._texUpperLeft=Object(p.a)(z,L),this._texUpperRight=Object(p.a)(C,L),this._texBottomLeft=Object(p.a)(z,I),this._texBottomRight=Object(p.a)(C,I);const V=m.d.load(this._materialKey);V.sdf=h.sdf,V.pattern=!0,V.textureBinding=h.textureBinding,this._materialKey=V.data,this._anchorX=.5-(.5+j)*h.width/h.width,this._anchorY=.5-(.5+w)*h.height/h.height,x*=l,y*=l,x*=this._scaleFactor,y*=this._scaleFactor,x*=h.rect.width/h.width,y*=h.rect.height/h.height,this._computedWidth=x,this._computedHeight=y,this._applyTransformation(gt,bt),this.xOffset=b,this.yOffset=g}}var Mt=vt,jt=s(460),wt=s(431),St=s(465);class Tt extends(Object(St.a)(et)){constructor(t){super(t),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map;const e=t.scaleFactor||1;if(this._cimTextLayer=t,Object(x.c)(t.color)){const e=(e,s,i)=>Object(_.c)(t.color(e,s,i));this._dynamicPropertyMap.set("_color",e)}else this._color=Object(_.c)(t.color);if(Object(x.c)(t.color)){const e=(e,s,i)=>Object(_.c)(t.outlineColor(e,s,i));this._dynamicPropertyMap.set("_haloColor",e)}else this._haloColor=Object(_.c)(t.outlineColor);let s,i,r;if(Object(x.c)(t.size)||(s=Math.min(Math.round(Object(d.d)(t.size*t.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",(e,i,r)=>Object(x.c)(t.size)?Math.min(Math.round(Object(d.d)(t.size(e,i,r)*t.sizeRatio)),127):s),Object(x.c)(t.outlineSize)){const e=(e,s,i)=>Math.min(Math.floor(5*Object(d.d)(t.outlineSize(e,s,i)*t.sizeRatio)),127);this._dynamicPropertyMap.set("_haloSize",e)}else this._haloSize=Math.min(Math.floor(5*Object(d.d)(t.outlineSize*t.sizeRatio)),127);Object(x.c)(t.offsetX)||(i=Math.round(Object(d.d)(t.offsetX*t.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",(e,s,r)=>Object(x.c)(t.offsetX)?Math.round(Object(d.d)(t.offsetX(e,s,r)*t.sizeRatio)):i),Object(x.c)(t.offsetY)||(r=Math.round(Object(d.d)(t.offsetY*t.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",(e,s,i)=>Object(x.c)(t.offsetY)?Math.round(Object(d.d)(t.offsetY(e,s,i)*t.sizeRatio)):r),Object(x.c)(t.angle)?this._dynamicPropertyMap.set("_angle",t.angle):this._angle=t.angle,Object(x.c)(t.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",t.horizontalAlignment):this._horizontalAlignment=t.horizontalAlignment,Object(x.c)(t.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",t.verticalAlignment):this._verticalAlignment=t.verticalAlignment,this._scaleFactor=e,Object(x.c)(t.text)?this._dynamicPropertyMap.set("_text",t.text):this._text=t.text;const n=Math.min(Math.round(Object(d.d)(t.referenceSize*t.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*n)),this._materialKey=t.materialKey;const o=m.f.load(this._materialKey);o.sdf=!0,this._bitset=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1,this._materialKey=o.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=t.markerPlacement,this.effects=t.effects,this._isCIM=!0}static fromCIMText(t){return new Tt(t)}async analyze(t,e,s,i){const r=e.readLegacyFeature(),n=function(t,e,s,i){return"string"==typeof t.text?t.text:"function"==typeof t.text?t.text(e,s,i):""}(this._cimTextLayer,r,s,i),o=await t.getMosaicItem(this._cimTextLayer.cim,Object(jt.a)(n));return this._textToGlyphs.set(n,o.glyphMosaicItems),o}bindFeature(t,e,s){const i=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach((t,r)=>{this[r]=t(i,e,s)}),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=Object(wt.d)(this._horizontalAlignment||"center"),this._yAlignD=Object(wt.f)(this._verticalAlignment||"baseline");const r=this._textToGlyphs.get(this._text);this.bindTextInfo(r,!1)}}var zt=Tt;class Lt extends(Q($.a)){constructor(t,e,s,i,r,n,o,a,c){super(),this.effects=c;const h=m.a.load(t);e&&(h.sdf=e.sdf,h.pattern=!0,h.textureBinding=e.textureBinding),this.fillColor=s,this.tl=i,this.br=r,this.aux1=n,this.aux2=o,this.aux3=a,this._materialKey=h.data}static fromCIMFill(t,e){const s=t.color,i=s&&Object(_.c)(s)||0,r=t.materialKey;if(!e){const e=Object(p.b)(0,0,0,t.colorLocked?1:0);return new Lt(r,null,i,0,0,0,0,e,t.effects)}const{rect:n,width:o,height:a}=e,c=n.x+f.r,h=n.y+f.r,l=c+o,m=h+a;let x=Object(u.i)(Object(d.d)(t.height||0));x>255?x=255:x<=0&&(x=Object(u.i)(m-h));let b=Object(u.i)(Object(d.d)(t.height/a*o||0));b>255?b=255:b<=0&&(b=Object(u.i)(l-c));let g=Object(d.d)(t.offsetX||0)+128;g>255&&(g=255);let O=Object(d.d)(-t.offsetY||0)+128;O>255&&(O=255);const v=t.scaleX||1,M=Object(p.a)(c,h),j=Object(p.a)(l,m),w=Object(p.b)(b,x,g,O),S=Object(p.a)(128*v,128),T=Object(p.b)(0,0,Object(y.b)(t.angle),t.colorLocked?1:0);return new Lt(r,e,i,M,j,w,S,T,t.effects)}static fromSimpleFill(t,e,s=!1){const{color:i}=t,r=i&&"esriSFSNull"!==t.style&&Object(_.d)(i)||0,n=Object(p.b)(0,0,0,s?255:0),o=t.materialKey;if(!e)return new Lt(o,null,r,0,0,0,0,n,null);const{rect:a,width:c,height:h}=e,l=a.x+f.r,d=a.y+f.r,m=l+c,y=d+h,x=Object(p.a)(l,d),b=Object(p.a)(m,y),g=Object(p.b)(Object(u.i)(m-l),Object(u.i)(y-d),0,0),O=Object(p.a)(128,128);return new Lt(o,e,r,x,b,g,O,n,null)}static fromPictureFill(t,e,s=!1){const i=f.q,{rect:r,width:n,height:o}=e,a=r.x+f.r,c=r.y+f.r,h=a+n,l=c+o,m=Object(p.a)(a,c),_=Object(p.a)(h,l);let y=Object(u.i)(Object(d.d)(t.width));y>255&&(y=255);let x=Object(u.i)(Object(d.d)(t.height));x>255&&(x=255);let b=Object(d.d)(t.xoffset)+128;b>255&&(b=255);let g=Object(d.d)(-t.yoffset)+128;g>255&&(g=255);const O=Object(p.b)(y,x,b,g),v=Object(p.a)(128*t.xscale,128*t.yscale),M=Object(p.b)(0,0,0,s?255:0),j=t.materialKey;return new Lt(j,e,i,m,_,O,v,M,null)}}var Ct=Lt,It=s(421);const Vt=i.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class Dt extends(dt($.a)){constructor(t,e,s,i,r,n,o,a,c,h,l,u,d,f,p,_){super();const y=m.c.load(t);e&&(y.sdf=e.sdf,y.pattern=!0,y.textureBinding=e.textureBinding),this._capType=i,this._joinType=r,this._miterLimitCosine=Object(x.b)(n),this.tessellationProperties._fillColor=o,this.tessellationProperties._tl=a,this.tessellationProperties._br=c,this._hasPattern=h,this._isDashed=l,this._joinOnUTurn=p,this._isColorLocked=u,this._zOrder=f,this.effects=_,this._materialKey=y.data,this.tessellationProperties._bitset=u?1:0,this.tessellationProperties._halfWidth=.5*s,this.tessellationProperties._halfReferenceWidth=.5*d,this._initializeTessellator(!1)}static fromCIMLine(t,e,s){const i=t.color,r=t.scaleFactor||1,n=t.isDashed;let o=t.cap;n&&1===o&&(o=2);const a=t.join,c=Object(d.d)(t.width)*r,h=Object(d.d)(t.referenceWidth),l=Object(d.d)(t.miterLimit),u=i&&Object(_.c)(i)||0;if(!e)return new Dt(t.materialKey,e,c,o,a,l,u,0,0,!1,n,t.colorLocked,h,t.zOrder,s,t.effects);const{rect:m,width:y,height:x}=e,b=m.x+f.r,g=m.y+f.r,O=b+y,v=g+x,M=Object(p.a)(b,g),j=Object(p.a)(O,v);return new Dt(t.materialKey,e,c,o,a,l,u,M,j,!0,n,t.colorLocked,h,t.zOrder,s,t.effects)}static fromSimpleLine(t,e,s){const{color:i}=t,r="esriSLSSolid"!==t.style&&"esriSLSNull"!==t.style,n=Object(It.g)(t.cap||"round",r),o=Object(It.h)(t.join||"round");let a=i&&"esriSLSNull"!==t.style&&Object(_.d)(i)||0;"esriSLSNull"===t.style&&(a=0);const c=Object(d.d)(t.width),h=t.miterLimit;if(!e)return new Dt(t.materialKey,e,c,n,o,h,a,0,0,!1,r,!1,c,0,s,null);const{rect:l,width:u,height:m}=e,y=l.x+f.r,x=l.y+f.r,b=y+u,g=x+m,O=Object(p.a)(y,x),v=Object(p.a)(b,g);return new Dt(t.materialKey,e,c,n,o,h,a,O,v,!0,r,!1,c,0,s,null)}static fromPictureLineSymbol(t,e,s,i){return Vt.error("PictureLineSymbol support does not exist!"),null}}var Pt=Dt;const Rt=i.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),Ft=new Array;function kt(t,e){const s=t.length;return t.push(null),e.then(e=>t[s]=e),t}function At(t){return!!(1&t)}class Bt{constructor(t,e){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new class{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){return this._resolver?this._resolver.promise.then(()=>this.acquire()):(this._resolver=Object(n.g)(),Object(n.u)())}release(){const t=this._resolver;this._resolver=null,t.resolve()}},this._fetchResource=t,this._joinOnUTurn=e}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(t,e){this._initErrorTemplates();const s=t.hash;if(this._symbolToTemplate.has(s))return this._symbolToTemplate.get(s);const i=new Array;e&&this._createMeshTemplates(i,e,!0),this._createMeshTemplates(i,t,!1);const r=this._createGroupId("expanded-cim"===t.type);return this._idToTemplateGroup.set(r,i),this._symbolToTemplate.set(s,r),r}getTemplateGroup(t){return this._idToTemplateGroup.has(t)?this._idToTemplateGroup.get(t):Ft}getDynamicTemplateGroup(t){return this._idToTemplateGroup.has(t)?(At(t)||Rt.error("mapview-template-store",`Id ${t} does not refer to a dynamic template`),this._idToTemplateGroup.get(t)):Ft}getMosaicItem(t,e){const s=this._createTemplateId(),i=Object(n.c)(t=>this._idToResolver.set(s,t));return this._fetchQueue.push({symbol:t,id:s,glyphIds:e}),i}finalize(t){return this._fetchQueue.length||this._lock.isHeld()?function(t,e,s){return t.acquire().then(()=>e(s)).then(()=>t.release()).catch(e=>{throw t.release(),e})}(this._lock,this._fetchAllQueuedResources.bind(this),t):Object(n.u)()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],Object(c.c)(o.c),!1),marker:this._createMeshTemplates([],Object(c.c)(o.b),!1),line:this._createMeshTemplates([],Object(c.c)(o.d),!1)})}_fetchAllQueuedResources(t){if(!this._fetchQueue.length)return Object(n.u)();const e=this._fetchQueue,s=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Object(n.b)(s).then(()=>this._fetchResource(e,t).then(t=>{for(const{id:e,mosaicItem:s}of t)this._idToResolver.get(e)(s),this._idToResolver.delete(e)})).catch(t=>{Object(n.n)(t)?this._fetchQueue=this._fetchQueue.concat(e):function(t){return"worker:port-closed"===t.name}(t)||Rt.error(new r.a("mapview-template-store","Unable to fetch requested texture resources",t))})}_createGroupId(t){return this._idCounter++<<1|(t?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Rt)?l.a.fromSimpleMarker(t,e):this._markerError}async _createPMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Rt)?l.a.fromPictureMarker(t,e):this._markerError}async _createSFS(t,e){const{spriteMosaicItem:s}=await this.getMosaicItem(t);return Object(a.a)(s,Rt)?Ct.fromSimpleFill(t,s,e):this._fillError}async _createPFS(t,e){const{spriteMosaicItem:s}=await this.getMosaicItem(t);return Object(a.a)(s,Rt)?Ct.fromPictureFill(t,s,e):this._fillError}async _createSLS(t,e){const{spriteMosaicItem:s}=await this.getMosaicItem(t);return Object(a.a)(s,Rt)?Pt.fromSimpleLine(t,s,this._joinOnUTurn):this._lineError}async _createLMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return Object(a.a)(e,Rt)?l.a.fromLineSymbolMarker(t,e):this._markerError}async _createTS(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t);return h.a.fromText(t,e)}async _createCIMText(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t.cim,Object(jt.a)(t.text));return t.cim.mosaicHash=t.materialHash,Object(a.a)(e,Rt)?h.a.fromCIMText(t,e):this._textError}async _createCIMFill(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Rt)?Ct.fromCIMFill(t,e):this._fillError}async _createCIMLine(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Rt)?Pt.fromCIMLine(t,e,this._joinOnUTurn):this._lineError}async _createCIMMarker(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return Object(a.a)(e,Rt)?l.a.fromCIMMarker(t,e):this._markerError}async _createCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let s;switch(t.type){case"marker":s=this._createCIMMarker(t);break;case"line":s=this._createCIMLine(t);break;case"fill":s=this._createCIMFill(t);break;case"text":s=this._createCIMText(t)}return s.then(t=>this._cimTemplateCache.set(e,t)),s}_createDynamicCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let s;switch(t.type){case"marker":s=Mt.fromCIMMarker(t);break;case"line":s=pt.fromCIMLine(t);break;case"fill":s=it.fromCIMFill(t);break;case"text":s=zt.fromCIMText(t)}return this._cimTemplateCache.set(e,s),s}_createPrimitiveMeshTemplates(t,e,s){switch(e.type){case"esriSMS":return kt(t,this._createSMS(e));case"esriPMS":return kt(t,this._createPMS(e));case"esriSFS":return kt(t,this._createSFS(e,s));case"line-marker":return kt(t,this._createLMS(e));case"esriPFS":return kt(t,this._createPFS(e,s));case"esriSLS":return kt(t,this._createSLS(e,!1));case"esriTS":return kt(t,this._createTS(e));default:return Rt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),t}}_createMeshTemplates(t,e,s){if(-1!==e.type.indexOf("3d"))return Rt.error("3D symbols are not supported with MapView"),t;if("expanded-cim"===e.type){for(const s of e.layers)"function"==typeof s.materialHash?t.push(this._createDynamicCIM(s)):kt(t,this._createCIM(s));return t}if("composite-symbol"===e.type){for(const i of e.layers)this._createPrimitiveMeshTemplates(t,i,s);return t}return"cim"===e.type||"label"===e.type||"web-style"===e.type?t:this._createPrimitiveMeshTemplates(t,e,s)}}},476:function(t,e,s){"use strict";s.d(e,"a",(function(){return l}));s(8);var i=s(135),r=(s(43),s(276)),n=s(420),o=s(422);const a={marker:n.d.MARKER,fill:n.d.FILL,line:n.d.LINE,text:n.d.TEXT};class c{constructor(t,e,s){this.layers=t,this.data=e,this.hash=this._createHash(),this.rendererKey=s;for(const i of t){const t=a[i.type];i.materialKey=Object(o.g)(t,this.rendererKey,!1,!1)}}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}const h=async(t,e)=>new c(await Object(r.b)(t.data,e),t.data,t.rendererKey),l=async(t,e,s)=>{if(!t)return null;if("cim"===t.type)return h(t,e);if("web-style"===t.type){const r=i.a.fromJSON(t),n={type:"cim",data:(await r.fetchCIMSymbol(s)).data,rendererKey:t.rendererKey};return h(n,e)}return t}},499:function(t,e,s){"use strict";s.d(e,"a",(function(){return Z}));s(5);var i=s(6),r=s(8),n=s(419),o=s(420),a=s(461),c=s(421),h=s(441),l=s(459);class u{constructor(t,e){this.data=t,this.stride=e}get vertexCount(){const t=this.stride/4,e=this.data.length/t;return e!==(0|e)&&console.debug("Corrupted stride"),e}transfer(t,e){const s=this.data.buffer();t.vertexCount=this.vertexCount,t.data=s,t.stride=this.stride,e.push(s)}}class d{constructor(t,e,s=!1){this.geometryType=t,this.indexVector=new h.a(Uint32Array,6*e),this.namedVectors={};const i=Object(c.k)(t,s);for(const r in i){const t=i[r];let s;switch(t%4){case 0:case 2:s=new h.a(Uint32Array,t*e);break;case 1:case 3:s=new h.a(Uint8Array,t*e)}this.namedVectors[r]=new u(s,t)}}get(t){return this.namedVectors[t].data}getVector(t){return this.namedVectors[t]}transfer(t,e){const s=this.indexVector.buffer(),i={};e.push(s);for(const r in this.namedVectors){const t=this.namedVectors[r];i[r]={},t.transfer(i[r],e)}t.geometryType=this.geometryType,t.indexBuffer=s,t.namedBuffers=i,this.destroy()}intoBuffers(){const t=l.a.fromVertexVectors(this);return this.destroy(),t}destroy(){this.indexVector=null,this.namedVectors=null}}var f=s(4),p=s(14),m=s(53),_=s(22),y=s(431),x=s(423),b=s(516),g=s(422),O=s(424),v=s(439),M=s(427);function j(t){return t.length-1}function w(t){let e=0;for(let s=0;s<j(t);s++)e+=S(t,s);return e}function S(t,e,s=1){const[i,r]=function(t,e){return t[e+1]}(t,e);return Math.sqrt(i*i+r*r)*s}class T{constructor(t,e,s,i,r){this._segments=t,this._index=e,this._distance=s,this._xStart=i,this._yStart=r,this._done=!1}static create(t){return new T(t,0,0,t[0][0],t[0][1])}clone(){return new T(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let s=Math.acos(e);return t>0&&(s=2*Math.PI-s),s}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<j(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const s=this.backwardLength;if(t<=s)return this._distance=(s-t)/this.length,this;let i=this.backwardLength;for(;this.prev();){if(i+this.length>t)return this._seekBackwards(t-i);i+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let s=this.remainingLength;for(;this.next();){if(s+this.length>t)return this.seek(t-s,e);s+=this.length}return this._distance=1,e?this:null}}function z(t,e,s){const i=w(t),r=T.create(t),n=i/2,o=(i-e)/2,a=Math.floor(o/e),c=n-a*e;r.seek(c);for(let h=-a;h<=a;h++)r.x<512&&r.x>=0&&r.y<512&&r.y>=0&&s(r.clone(),h,n+h*e,i),r.seek(e)}function L(t,e){const s=1e-6;if(e<=0)return;const i=t.length;if(i<3)return;const r=[];let n=0;r.push(0);for(let u=1;u<i;u++)n+=Object(M.a)(t[u],t[u-1]),r.push(n);e=Math.min(e,.2*n);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[i-1][0],c=t[i-1][1],h=Object(M.e)([0,0],t[0],t[1]);Object(M.d)(h),t[0][0]+=e*h[0],t[0][1]+=e*h[1],Object(M.e)(h,t[i-1],t[i-2]),Object(M.d)(h),t[i-1][0]+=e*h[0],t[i-1][1]+=e*h[1];for(let u=1;u<i;u++)r[u]+=e;r[i-1]+=e;const l=.5*e;for(let u=1;u<i-1;u++){let n=0,a=0,c=0;for(let i=u-1;i>=0&&!(r[i+1]<r[u]-l);i--){const o=l+r[i+1]-r[u],h=r[i+1]-r[i],d=r[u]-r[i]<l?1:o/h;if(Math.abs(d)<s)break;const f=d*d,p=d*o-.5*f*h,m=d*h/e,_=t[i+1],y=t[i][0]-_[0],x=t[i][1]-_[1];n+=m/p*(_[0]*d*o+.5*f*(o*y-h*_[0])-f*d*h*y/3),a+=m/p*(_[1]*d*o+.5*f*(o*x-h*_[1])-f*d*h*x/3),c+=m}for(let o=u+1;o<i&&!(r[o-1]>r[u]+l);o++){const i=l-r[o-1]+r[u],h=r[o]-r[o-1],d=r[o]-r[u]<l?1:i/h;if(Math.abs(d)<s)break;const f=d*d,p=d*i-.5*f*h,m=d*h/e,_=t[o-1],y=t[o][0]-_[0],x=t[o][1]-_[1];n+=m/p*(_[0]*d*i+.5*f*(i*y-h*_[0])-f*d*h*y/3),a+=m/p*(_[1]*d*i+.5*f*(i*x-h*_[1])-f*d*h*x/3),c+=m}o.push(n/c),o.push(a/c)}o.push(a),o.push(c);for(let u=0,d=0;u<i;u++)t[u][0]=o[d++],t[u][1]=o[d++]}var C=s(464);const I=f.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),V=function(t){const e=new Map;return t=>(e.has(t)||e.set(t,(t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e})(t)),e.get(t))}(),D=t=>Math.floor(127*t+127),P=t=>Math.floor(10*t),R=t=>Math.round(t*(254/360)),F=(t,e)=>Object(x.a)(Math.round(8*t),Math.round(8*e));class k extends C.a{constructor(t,e,s,i){super(t,s.font.size,s.haloSize||0,s.color&&Object(O.d)(s.color)||0,s.haloColor&&Object(O.d)(s.haloColor)||0,s.horizontalAlignment,s.verticalAlignment,Object(b.a)(e.labelPlacement)?1:0,s.font.decoration,!1,s.angle||0,s.xoffset,s.yoffset,s.lineWidth,s.lineHeight,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this.geometryType=o.d.LABEL;const r=function(t,e){const s=!!t.minScale&&e.scaleToZoom(t.minScale)||0;return Object(m.c)(s,0,25.5)}(e,i),a=function(t,e){const s=!!t.maxScale&&e.scaleToZoom(t.maxScale)||255;return Object(m.c)(s,0,25.5)}(e,i),c=e.labelPlacement,[h,l]=Object(y.b)(c);this._xAlignD=h,this._yAlignD=l,this._minZoom=r,this._maxZoom=a,this._refPlacementPadding=Object(_.d)(s.haloSize)+n.D;const u=g.b.load(t);u.sdf=!0,this._materialKey=u.data}static fromLabelClass(t,e){if("center-along"===t.labelPlacement){const e=t.symbol;e.xoffset=0,e.yoffset=0,e.angle=0,e.font.decoration="none"}return new k(t.materialKey,t,t.symbol,e)}get _shapedBox(){return Object(i.n)(this._shapingInfo).bounds}bindReferenceTemplate(t){let e=Object(y.e)(this._xAlignD),s=Object(y.g)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(i.g)(t))return void(this._refSymbolAndPlacementOffset=Object(x.b)(0,0,D(e),D(s)));if("circle"===t.boundsType&&(e||s)){const t=Math.sqrt(e*e+s*s);e/=t,s/=t}const r=Math.max(t.height,t.width),n=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(x.b)(n,r,D(e),D(s)),this._referenceSize=r,this._refPlacementDirX=e,this._refPlacementDirY=s,this._refOffsetX=t.xOffset,this._refOffsetY=t.yOffset}writeMesh(t,e,s,r,n,o){if(Object(i.g)(this._shapingInfo))return;const a=new Array,c=this._shapingInfo,h="esriGeometryPolygon"===s.geometryType?s.readLegacyCentroid():s.readLegacyGeometry();if(h){switch(this.current={out:t,outVecs:e,outMetrics:a,inId:n,inShaping:c,zoomLevel:o},r){case"esriGeometryPolyline":this._placeLineLabels(h);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(h);break;default:((t,e="mapview-labeling")=>{I.error(new p.a(e,t))})("mapview-labeling",`Geometry of type ${r} is not supported`)}t.writeMetrics(this.current.outMetrics)}}_isVisible(t,e){const s=P(this.current.zoomLevel);return P(t)<=s&&s<=P(e)}_placePointLabels(t){const{out:e,outVecs:s,outMetrics:i,inId:r}=this.current;this._writeGlyphs(e,s,r,t,i)}_placeLineLabels(t){const e=function(t,e){const s=e;for(let i=0;i<t.length;i++){let e=t[i];const r=[];r.push(e[0]);for(let t=1;t<e.length;t++){let[s,i]=r[t-1];s+=e[t][0],i+=e[t][1],r.push([s,i])}L(r,s);const n=[];n.push(r[0]);for(let t=1;t<r.length;t++){const[e,s]=r[t-1],[i,o]=r[t],a=Math.round(i-e),c=Math.round(o-s);n.push([a,c])}t[i]=n,e=n}return t}(t.paths,this.current.inShaping.bounds.width),s=this._placeSubdivGlyphs.bind(this),i=(this._shapedBox.width+128)/4;for(const r of e)z(r,i,s)}_placeSubdivGlyphs(t,e,s,i){const r=V(e),n=this._shapedBox.width/4,o=Math.min(s,i-s),a=Object(m.h)(o/(4+n/2)),c=0===e?a:Math.min(r,a),h=Math.max(this._minZoom,this.current.zoomLevel+2-c),l=this.current.zoomLevel-h,u=this._shapedBox.width/2*Math.pow(2,l);this.current.inShaping.isMultiline?0===e&&this._placeStraight(t,h):this._placeCurved(t,h,u)}_placeStraight(t,e){const{out:s,outVecs:i,outMetrics:r,inId:n}=this.current;this._writeGlyphs(s,i,n,t,r,e)}_placeCurved(t,e,s){const i={from:this.current.out.currentDisplayRecordCount(),count:-1},r=new v.a(this.current.inId,i,t.x,t.y,e),n=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=R(o),this._placeFirst(n,r,e,1),this._placeBack(t,n,r,e,s,1),this._placeForward(t,n,r,e,s,1),this._outLineLabelAngle=R(a),this._placeFirst(n,r,e,0),this._placeBack(t,n,r,e,s,0),this._placeForward(t,n,r,e,s,0),r.range.count=this.current.out.currentDisplayRecordCount()-r.range.from,r.bounds&&this.current.outMetrics.push(r)}_placeBack(t,e,s,i,r,n){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=r);)this._placeOnSegment(o,e,s,a,i,-1,n),a+=o.length+0}_placeForward(t,e,s,i,r,n){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=r);)this._placeOnSegment(o,e,s,a,i,1,n),a+=o.length+0}_placeFirst(t,e,s,i){const r=t,n=this.current.inShaping,o=n.glyphs,a=this.current.zoomLevel,{out:c,outVecs:h,inId:l}=this.current,u=F(r.x,r.y);for(const d of o){const r=d.x>n.bounds.x?i:1-i,o=r*t.remainingLength+(1-r)*t.backwardLength,f=Math.abs(d.x+d.width/2-n.bounds.x),p=Math.max(0,a+Object(m.h)(f/(o+0))),_=Math.max(s,p);d.maxZoom=25,d.angle=t.angle+(1-i)*Math.PI,d.minZoom=_,this._writeGlyph(c,h,d,l,u),i&&this._isVisible(d.minZoom,d.maxZoom)&&e.add(d.bounds,0,0)}}_placeOnSegment(t,e,s,i,r,n,o){const a=this.current.inShaping.glyphs,{out:c,outVecs:h,inId:l}=this.current,u=this.current.inShaping,d=this.current.zoomLevel,f=t.dx/t.length,p=t.dy/t.length,_={x:t.x+i*-n*f,y:t.y+i*-n*p},y=F(_.x,_.y);for(const x of a){const a=x.x>u.bounds.x?o:1-o;if(!(a&&1===n||!a&&-1===n))continue;const f=Math.abs(x.x+x.width/2-u.bounds.x),p=Math.max(0,d+Object(m.h)(f/i)-.1),_=Math.max(r,d+Object(m.h)(f/(i+t.length+0)));0!==p&&(x.angle=t.angle+(1-o)*Math.PI,x.minZoom=_,x.maxZoom=p,this._writeGlyph(c,h,x,l,y),o&&this._isVisible(x.minZoom,x.maxZoom)&&s.add(x.bounds,t.x-e.x,t.y-e.y))}}_writeGlyphs(t,e,s,r,n,o=this._minZoom){const a=this._shapingInfo;if(Object(i.g)(a))return;if(r.x<0||r.x>=512||r.y<0||r.y>=512)return;const c=t.currentDisplayRecordCount(),h=F(r.x+this._refOffsetX,r.y-this._refOffsetY),l=new v.a(s,{from:c,count:-1},r.x+this._refOffsetX,r.y-this._refOffsetY,o);for(const i of a.glyphs)i.minZoom=o,i.maxZoom=this._maxZoom,this._writeGlyph(t,e,i,s,h);l.range.count=t.currentDisplayRecordCount()-l.range.from,l.bounds=a.boundsT;const u=g.b.load(this._materialKey),d=this._refPlacementDirX,f=this._refPlacementDirY,p=u.vvSizeFieldStops||u.vvSizeMinMaxValue||u.vvSizeScaleStops||u.vvSizeUnitValue;l.setPlacementOffset(p,this._referenceSize,this._refPlacementPadding,d,f),n.push(l)}_writeGlyph(t,e,s,i,r){const n=g.e.load(this._materialKey);n.textureBinding=s.textureBinding;const o=e.indexVector.length,a=e.getVector("geometry").vertexCount,c=this._writeIndices(e),h=this._writeVertex(e,i,r,s);t.writeDisplayRecord(this.geometryType,n.data,a,h,o,c)}_writeVertexCommon(t,e,s,i){const r=this._color,n=this._haloColor,o=Object(x.b)(0,0,this._size,this._haloSize),a=Math.max(i.minZoom,this._minZoom),c=Math.min(i.maxZoom,this._maxZoom),h=Object(x.b)(P(a),P(c),this._outLineLabelAngle,0);t.push(s),t.push(e),t.push(r),t.push(n),t.push(o),t.push(this._refSymbolAndPlacementOffset),t.push(h)}}var A=k,B=s(468),E=s(470);class Z{constructor(t,e,s){this._isDD=!1,this._geometryType=t,this._idField=e,this._templateStore=s}update(t,e){this._isDD="simple"===t.mesh.matcher.type&&t.mesh.matcher.isDotDensity,Object(i.h)(t.mesh.labels)&&this._setLabelTemplates(t.mesh.labels,e)}_setLabelTemplates(t,e){this._labelTemplates=t.map(t=>A.fromLabelClass(t,e))}get templates(){return this._templateStore}createMeshData(t){const e=new Array(5),s=this._labelTemplates&&this._labelTemplates.length>0,i="esriGeometryPolyline"===this._geometryType?n.k:n.j;return e[o.d.MARKER]=new d(o.d.MARKER,4*t),e[o.d.FILL]=new d(o.d.FILL,t,this._isDD),e[o.d.LINE]=new d(o.d.LINE,t),e[o.d.TEXT]=new d(o.d.TEXT,4*t),e[o.d.LABEL]=new d(o.d.LABEL,s?4*i:0),new a.a(e,{features:t,records:t,metrics:0})}async analyze(t,e,s,i,n){if(Object(r.o)(n))return;let o;"dictionary"===e.type&&(o=await e.analyze(this._idField,t.copy(),s,i,n));let a=0;for(;t.next();){let r;if(r=o?o[a++]:e.match(this._idField,t,this._geometryType,s,i),t.setGroupId(r),Object(E.b)(r)){const e=this._templateStore.getDynamicTemplateGroup(r);for(const r of e)r&&r.analyze&&r.analyze(this._templateStore,t,s,i)}}return this._templateStore.finalize(n)}async analyzeGraphics(t,e,s,i,n){if(Object(r.o)(n))return;const o=t.getCursor();for(e&&await e.analyze(this._idField,o.copy(),s,i,n);o.next();){let t=o.getGroupId();if(null!=t&&-1!==t||(t=e.match(this._idField,o,o.geometryType,s,i),o.setGroupId(t)),Object(E.b)(t)){const e=this._templateStore.getDynamicTemplateGroup(t);for(const t of e)t&&t.analyze&&t.analyze(this._templateStore,o,s,i)}o.setGroupId(t)}return this._templateStore.finalize(n)}writeGraphic(t,e){const s=e.getGroupId(),i=e.getDisplayId(),r=this._templateStore.getTemplateGroup(s),n=e.geometryType;if(null!=i){if(Object(E.b)(s))for(const t of r)t.bindFeature(e,null,null);if(r){t.writeDisplayObject(i,e.readGraphic().insertAfter);for(const s of r){if(!s)continue;const r=t.get(s.geometryType);s.writeMesh(t,r,e,n,i)}}}}writeCursor(t,e,s,r,n,o){const a=e.getGroupId(),c=e.getDisplayId(),h=this._templateStore.getTemplateGroup(a);if(null==c)return;if(!h)return;if(t.writeDisplayObject(c,0),Object(E.b)(a))for(const i of h)i.bindFeature(e,s,r);for(const i of h){const s=t.get(i.geometryType);!i.needsPixelBuffer&&e.hasFilter()||i.writeMesh(t,s,e,this._geometryType,c)}const l=t.hasDisplayRecords();if(Object(i.h)(o)&&l){const s=o&&this._findLabelRef(h);this._writeLabels(t,e,c,o,s,n)}t.endDisplayObject()}_findLabelRef(t){for(const e of t)if(e instanceof B.a)return e;return null}_writeLabels(t,e,s,r,n,o){for(const a of r)if(Object(i.h)(a)&&a){const{glyphs:i,rtl:r,index:c}=a,h=this._labelTemplates[c],l=t.get(h.geometryType);h.bindReferenceTemplate(n),h.bindTextInfo(i,r),h.writeMesh(t,l,e,this._geometryType,s,o)}}}},503:function(t,e,s){"use strict";s.d(e,"a",(function(){return x}));var i=s(4),r=s(14),n=s(8),o=s(91),a=s(34),c=s(314),h=s(279),l=s(476),u=s(445);const d=i.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");class f{constructor(){this.type="feature",this._defaultResult=null}static async fromBasicRenderer(t,e,s){const i=new f;if(t.symbol){const r=await Object(l.a)(t.symbol,s),n=e.createTemplateGroup(r,null);i.setDefault(n)}return i}size(){return 1}getDefault(){return this._defaultResult}setDefault(t){this._defaultResult=t}match(t,e,s,i,r){return this.getDefault()}async analyze(t,e,s,i,r){return null}}class p extends f{constructor(t,e,s,i){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=e,this._fieldIndex=i,this._field=t,this._normalizationInfo=s}static async fromCBRenderer(t,e,s){const{isMaxInclusive:i,normalizationField:r,normalizationTotal:o,normalizationType:a}=t,c=t.field,h=new p(c,i,{normalizationField:r,normalizationTotal:o,normalizationType:a},t.fieldIndex),u=await Object(l.a)(t.backgroundFillSymbol,s);await Object(n.b)(t.intervals.map(async t=>{const i=await Object(l.a)(t.symbol,s),r=await e.createTemplateGroup(i,u),n={min:t.min,max:t.max};h.add(n,r)}));const d=await Object(l.a)(t.defaultSymbol,s);if(d){const t=await e.createTemplateGroup(d,u);h.setDefault(t)}return h}add(t,e){this._intervals.push({interval:t,result:e}),this._intervals.sort((t,e)=>t.interval.min-e.interval.min)}size(){return super.size()+this._intervals.length}match(t,e,s,i,r){if(null==this._fieldIndex&&!this._field)return this.getDefault();const n=null!=this._fieldIndex?e.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(e);if(!n&&(null==n||isNaN(n)))return this.getDefault();for(let o=0;o<this._intervals.length;o++){const{interval:t,result:e}=this._intervals[o],s=n>=t.min,i=this._isMaxInclusive?n<=t.max:n<t.max;if(s&&i)return e}return this.getDefault()}_needsNormalization(){const t=this._normalizationInfo;return t&&(t.normalizationField||t.normalizationTotal||t.normalizationType)}_getValueFromField(t){const e=t.readAttribute(this._field);if(!this._needsNormalization())return e;const{normalizationField:s,normalizationTotal:i,normalizationType:r}=this._normalizationInfo,n=!!s&&t.readAttribute(s);if(r)switch(r){case"esriNormalizeByField":return n?e/n:void 0;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return e/i*100;default:return void d.error("Found unknown normalization type: "+r)}else d.error("Normalization is required, but no type was set!")}}class m extends f{constructor(t,e,s){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=s,this._fields=t,this._seperator=e||""}static async fromUVRenderer(t,e,s){const i=t.fieldDelimiter,r=[t.field];t.field2&&r.push(t.field2),t.field3&&r.push(t.field3);const o=await Object(l.a)(t.backgroundFillSymbol,s),a=new m(r,i,t.fieldIndex);await Object(n.b)(t.map.map(async t=>{const i=await Object(l.a)(t.symbol,s),r=await e.createTemplateGroup(i,o);"<Null>"===t.value?a.setNullResult(r):a.add(t.value,r)}));const c=await Object(l.a)(t.defaultSymbol,s);if(c){const t=await e.createTemplateGroup(c,o);a.setDefault(t)}return a}setNullResult(t){this._nullResult=t}add(t,e){this._resultsMap.set(t.toString(),e)}size(){return super.size()+this._resultsMap.size}match(t,e,s,i,r){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const n=null!=this._fieldsIndex?e.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(e);if(null!==this._nullResult&&(null==n||""===n||"<Null>"===n))return this._nullResult;if(!n&&null==n)return this.getDefault();const o=n.toString();return this._resultsMap.has(o)?this._resultsMap.get(o):this.getDefault()}_getValueFromFields(t){const e=[];for(const s of this._fields){const i=t.readAttribute(s);e.push(i)}return e.join(this._seperator)}}class _ extends f{constructor(t,e,s,i){super(),this.type="dictionary",this._groupIdCache=new c.a(100),this._renderer=t,this._fieldMap=t.fieldMap,this._symbolFields=t.getSymbolFields(),this._templates=e,this._info=s,this._scaleFn=i}static async fromDictionaryRenderer(t,e,i){const r=(await Promise.resolve().then(s.bind(null,280))).default.fromJSON(t.renderer);await r.fetchResources({spatialReference:i.spatialReference,fields:i.fields});const n=await async function(t,e){const s=t||1;if("number"==typeof s)return(t,e,i)=>s;const i=await Object(o.d)(s,e.spatialReference,e.fields);return(t,s,r)=>Object(h.a)(i,t,{$view:r},e.geometryType,s)||1}(r.scaleExpression,i);return new _(r,e,i,n)}async _analyzeFeature(t,e,s,i){const n=t.readLegacyFeature(),o=this._scaleFn(n,e,s),c=this._attributeHash(n)+"-"+o,h=this._groupIdCache.get(c);if(h)return h;const f={...s,spatialReference:this._info.spatialReference,abortOptions:i,fields:this._info.fields},p=await this._renderer.getSymbolAsync(n,f),m=Object(u.c)(p,this._renderer),_=Object(l.a)(m,this._info,i).then(t=>{if("expanded-cim"!==t.type)return d.error(new r.a("mapview-bad-type",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+="-"+o;for(const e of t.layers)e.scaleFactor=o,e.templateHash+="-"+o,"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=Object(a.c)(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(t,null)});return this._groupIdCache.put(c,_,1),_}async analyze(t,e,s,i,r){const o=e.getCursor(),a=[];for(;o.next();)a.push(this._analyzeFeature(o,s,i,r));return Object(n.b)(a)}match(t,e,s,i,r){return null}_attributeHash(t){let e="";for(const s of this._symbolFields){const i=this._fieldMap[s];i&&(e+=t.attributes[i]+"-")}return e}}const y=i.a.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");async function x(t,e,s){switch(t.type){case"simple":return f.fromBasicRenderer(t,e,s);case"map":return m.fromUVRenderer(t,e,s);case"interval":return p.fromCBRenderer(t,e,s);case"dictionary":return _.fromDictionaryRenderer(t,e,s);default:return y.error(new r.a("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}},511:function(t,e,s){"use strict";function i(t,e,s){const i=e&&e.length,a=i?e[0]*s:t.length;let c=r(t,0,a,s,!0);const h=new Array;if(!c||c.next===c.prev)return h;let l,f,p,m,_;if(i&&(c=function(t,e,s,i){const o=new Array;for(let n=0,a=e.length;n<a;n++){const s=r(t,e[n]*i,n<a-1?e[n+1]*i:t.length,i,!1);s===s.next&&(s.steiner=!0),o.push(u(s))}o.sort(O);for(const r of o)d(r,s),s=n(s,s.next);return s}(t,e,c,s)),t.length>80*s){l=p=t[0],f=m=t[1];for(let e=s;e<a;e+=s){const s=t[e],i=t[e+1];l=Math.min(l,s),f=Math.min(f,i),p=Math.max(p,s),m=Math.max(m,i)}_=Math.max(p-l,m-f),_=0!==_?1/_:0}return o(c,h,s,l,f,_),h}function r(t,e,s,i,r){let n;if(r===_(t,e,s,i)>0)for(let o=e;o<s;o+=i)n=h(o,t[o],t[o+1],n);else for(let o=s-i;o>=e;o-=i)n=h(o,t[o],t[o+1],n);return n&&g(n,n.next)&&(l(n),n=n.next),n}function n(t,e=t){if(!t)return t;let s,i=t;do{if(s=!1,i.steiner||!g(i,i.next)&&0!==p(i.prev,i,i.next))i=i.next;else{if(l(i),i=e=i.prev,i===i.next)break;s=!0}}while(s||i!==e);return e}function o(t,e,s,i,r,h,u=0){if(!t)return;!u&&h&&(t=function t(e,s,i,r){for(let n;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=b(n.x,n.y,s,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,t(e,s,i,r);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(t){let e,s=1;for(;;){let i,r=t;t=null,e=null;let n=0;for(;r;){n++,i=r;let o=0;for(;o<s&&i;o++)i=i.nextZ;let a=s;for(;o>0||a>0&&i;){let s;0===o?(s=i,i=i.nextZ,a--):0!==a&&i?r.z<=i.z?(s=r,r=r.nextZ,o--):(s=i,i=i.nextZ,a--):(s=r,r=r.nextZ,o--),e?e.nextZ=s:t=s,s.prevZ=e,e=s}r=i}if(e.nextZ=null,s*=2,n<2)return t}}(e)}(t,i,r,h));let d=t;for(;t.prev!==t.next;){const f=t.prev,p=t.next;if(h?c(t,i,r,h):a(t))e.push(f.index/s),e.push(t.index/s),e.push(p.index/s),l(t),t=p.next,d=p.next;else if((t=p)===d){u?1===u?o(t=v(t,e,s),e,s,i,r,h,2):2===u&&M(t,e,s,i,r,h):o(n(t),e,s,i,r,h,1);break}}}function a(t){const e=t.prev,s=t,i=t.next;if(p(e,s,i)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,y(e.x,e.y,s.x,s.y,i.x,i.y,r.x,r.y)&&p(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function c(t,e,s,i){const r=t.prev,n=t,o=t.next;if(p(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,c=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,h=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,l=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,u=b(a,c,e,s,i),d=b(h,l,e,s,i);let f=t.prevZ,m=t.nextZ;for(;f&&f.z>=u&&m&&m.z<=d;){if(f!==t.prev&&f!==t.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&p(f.prev,f,f.next)>=0)return!1;if(f=f.prevZ,m!==t.prev&&m!==t.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&p(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,f.x,f.y)&&p(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&y(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&p(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function h(t,e,s,i){const r=new S(t,e,s);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function l(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function u(t){let e=t,s=t;do{(e.x<s.x||e.x===s.x&&e.y<s.y)&&(s=e),e=e.next}while(e!==t);return s}function d(t,e){if(e=function(t,e){let s=e;const i=t.x,r=t.y;let n,o=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){const t=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(t<=i&&t>o){if(o=t,t===i){if(r===s.y)return s;if(r===s.next.y)return s.next}n=s.x<s.next.x?s:s.next}}s=s.next}while(s!==e);if(!n)return null;if(i===o)return n.prev;const a=n,c=n.x,h=n.y;let l,u=1/0;for(s=n.next;s!==a;)i>=s.x&&s.x>=c&&i!==s.x&&y(r<h?i:o,r,c,h,r<h?o:i,r,s.x,s.y)&&(l=Math.abs(r-s.y)/(i-s.x),(l<u||l===u&&s.x>n.x)&&x(s,t)&&(n=s,u=l)),s=s.next;return n}(t,e)){const s=w(e,t);n(s,s.next)}}function f(t,e,s,i){const r=e&&e.length,n=r?e[0]*s:t.length;let o=Math.abs(_(t,0,n,s));if(r)for(let c=0,h=e.length;c<h;c++){const i=e[c]*s,r=c<h-1?e[c+1]*s:t.length;o-=Math.abs(_(t,i,r,s))}let a=0;for(let c=0;c<i.length;c+=3){const e=i[c]*s,r=i[c+1]*s,n=i[c+2]*s;a+=Math.abs((t[e]-t[n])*(t[r+1]-t[e+1])-(t[e]-t[r])*(t[n+1]-t[e+1]))}return 0===o&&0===a?0:Math.abs((a-o)/o)}function p(t,e,s){return(e.y-t.y)*(s.x-e.x)-(e.x-t.x)*(s.y-e.y)}function m(t,e,s,i){return!!(g(t,e)&&g(s,i)||g(t,i)&&g(s,e))||p(t,e,s)>0!=p(t,e,i)>0&&p(s,i,t)>0!=p(s,i,e)>0}function _(t,e,s,i){let r=0;for(let n=e,o=s-i;n<s;n+=i)r+=(t[o]-t[n])*(t[n+1]+t[o+1]),o=n;return r}function y(t,e,s,i,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(i-a)-(s-o)*(e-a)>=0&&(s-o)*(n-a)-(r-o)*(i-a)>=0}function x(t,e){return p(t.prev,t,t.next)<0?p(t,e,t.next)>=0&&p(t,t.prev,e)>=0:p(t,e,t.prev)<0||p(t,t.next,e)<0}function b(t,e,s,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function g(t,e){return t.x===e.x&&t.y===e.y}function O(t,e){return t.x-e.x}function v(t,e,s){let i=t;do{const r=i.prev,n=i.next.next;!g(r,n)&&m(r,i,i.next,n)&&x(r,n)&&x(n,r)&&(e.push(r.index/s),e.push(i.index/s),e.push(n.index/s),l(i),l(i.next),i=t=n),i=i.next}while(i!==t);return i}function M(t,e,s,i,r,a){let c=t;do{let t=c.next.next;for(;t!==c.prev;){if(c.index!==t.index&&j(c,t)){let h=w(c,t);return c=n(c,c.next),h=n(h,h.next),o(c,e,s,i,r,a),void o(h,e,s,i,r,a)}t=t.next}c=c.next}while(c!==t)}function j(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let s=t;do{if(s.index!==t.index&&s.next.index!==t.index&&s.index!==e.index&&s.next.index!==e.index&&m(s,s.next,t,e))return!0;s=s.next}while(s!==t);return!1}(t,e)&&x(t,e)&&x(e,t)&&function(t,e){let s=t,i=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{s.y>n!=s.next.y>n&&s.next.y!==s.y&&r<(s.next.x-s.x)*(n-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==t);return i}(t,e)}function w(t,e){const s=new S(t.index,t.x,t.y),i=new S(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,s.next=r,r.prev=s,i.next=s,s.prev=i,n.next=i,i.prev=n,i}s.d(e,"a",(function(){return f})),s.d(e,"b",(function(){return i}));class S{constructor(t,e,s){this.index=t,this.x=e,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}}},516:function(t,e,s){"use strict";function i(t){switch(t){case"above-along":case"below-along":case"center-along":return 1;default:return 0}}s.d(e,"a",(function(){return i}))},676:function(t,e,s){"use strict";var i=s(0),r=(s(5),s(4),s(7),s(1)),n=s(2),o=(s(3),s(9),s(10),s(122));let a=class extends o.a{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const t=this.get("tileStore.tileScheme.spatialReference");return t&&t.toJSON()||null}};Object(i.a)([Object(r.b)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),Object(i.a)([Object(r.b)({constructOnly:!0})],a.prototype,"remoteClient",void 0),Object(i.a)([Object(r.b)({constructOnly:!0})],a.prototype,"service",void 0),Object(i.a)([Object(r.b)({dependsOn:["tileStore.tileScheme.spatialReference"]})],a.prototype,"spatialReference",null),Object(i.a)([Object(r.b)({constructOnly:!0})],a.prototype,"tileInfo",void 0),Object(i.a)([Object(r.b)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=Object(i.a)([Object(n.a)("esri.views.2d.layers.features.processors.BaseProcessor")],a);var c=a;e.a=c},893:function(t,e,s){"use strict";s.r(e);var i=s(0),r=s(5),n=s(6),o=s(4),a=(s(7),s(1),s(2)),c=(s(14),s(3),s(9),s(10),s(8)),h=s(29),l=s(311),u=s(419),d=s(442),f=s(503),p=s(460),m=s(470),_=s(499),y=s(490);class x{constructor(t,e=2){this._bucketSize=t,this._rowsLength=u.F/t,this._colsLength=u.F/t,this._elementsPerBucket=e,this._grid=this._initGrid()}checkOverlap(t,e){const s=Math.floor(t/this._bucketSize),i=Math.floor(e/this._bucketSize);return s<0||s>=this._rowsLength||i<0||i>=this._colsLength||this._grid[i*this._colsLength+s]>=this._elementsPerBucket}markUsed(t,e){const s=Math.floor(t/this._bucketSize),i=Math.floor(e/this._bucketSize);this._grid[i*this._colsLength+s]+=1}reset(){this._grid=this._initGrid()}_initGrid(){return new Uint8Array(this._rowsLength*this._colsLength)}}var b=s(676);o.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let g=class extends b.a{constructor(){super(...arguments),this.type="symbol"}destroy(){}get supportsTileUpdates(){return!0}async update(t,e){const s=e.schema.processors[0];if("symbol"!==s.type)return;const i=Object(l.a)(this._schema,s);Object(l.b)(i,"mesh")&&(Object(r.a)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=s,this._factory=this._createFactory(s),this._factory.update(s,this.tileStore.tileScheme.tileInfo))}onTileData(t,e,s){return Object(c.w)(s),this._onTileData(t,e,s)}onTileError(t,e,s){const i=s.signal,r={tileKey:t.id,error:e};return this.remoteClient.invoke("tileRenderer.onTileError",r,{signal:i})}_createFactory(t){const{geometryType:e,objectIdField:s,fields:i}=this.service,r={geometryType:e,fields:i,spatialReference:h.a.fromJSON(this.spatialReference)},n=new m.a((t,e)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",t,e),!1);return this._store=n,this._matcher=Object(f.a)(t.mesh.matcher,n,r),new _.a(e,s,n)}async _onTileData(t,e,s){const{type:i,addOrUpdate:r,remove:o,end:a}=e;if(!r){const e={type:i,addOrUpdate:null,remove:o,clear:!1,end:a};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:e},s)}const h=this._processFeatures(t,r,s),l=s.signal;try{const e=await h,s=Object(n.a)(e,t=>t.message),r=Object(n.a)(e,t=>t.transferList)||[],u={type:i,addOrUpdate:s,remove:o,clear:!1,end:a},d={transferList:Object(n.n)(r)||[],signal:l};return Object(c.w)(d),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:u},d)}catch(e){this._handleError(t,e,s)}}async _processFeatures(t,e,s){if(Object(n.g)(e)||!e.hasFeatures)return null;const i={transform:t.transform,hasZ:!1,hasM:!1},r=this._factory,o={viewingMode:"",scale:t.scale},a=await this._matcher;Object(c.w)(s);const h=this._getLabelInfos(t,e);return await r.analyze(e.getCursor(),a,i,o),Object(c.w)(s),this._writeFeatureSet(t,e,i,h,r)}_writeFeatureSet(t,e,s,i,r){const o=r.createMeshData(e.getApproximateSize()),a={viewingMode:"",scale:t.scale},c=e.getCursor();for(;c.next();)try{const e=c.getDisplayId(),h=Object(n.h)(i)?i.get(e):null;r.writeCursor(o,c,s,a,t.level,h)}catch(t){}return this._encodeDisplayData(o)}_encodeDisplayData(t){const e={},s=new Array;return t.encode(e,s),{message:e,transferList:s}}_handleError(t,e,s){if(!Object(c.n)(e)){const i={tileKey:t.id,error:e.message};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:s.signal})}}_shouldDiscard(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const s=e.readLegacyPointGeometry();return!s||t.checkOverlap(s.x,s.y)}case"esriGeometryPolygon":{const s=e.readLegacyCentroid();return!s||t.checkOverlap(s.x,s.y)}default:return!1}}_markUsed(t,e){switch(this.service.geometryType){case"esriGeometryPoint":{const{x:s,y:i}=e.readLegacyPointGeometry();return t.markUsed(s,i)}case"esriGeometryPolygon":{const{x:s,y:i}=e.readLegacyCentroid();return t.markUsed(s,i)}}}_getLabelInfos(t,e){const s=this._schema.mesh.labels,i=Object(n.a)(s,e=>e.filter(e=>function(t,e){return(!t.minScale||t.minScale>=e)&&(!t.maxScale||t.maxScale<=e)}(e,t.scale)));if(Object(n.g)(i)||0===i.length)return null;const r=new Map,o=new x(u.e),a=e.getCursor();for(;a.next();){const t=a.getDisplayId();if(this._shouldDiscard(o,a)){r.has(t)||r.set(t,null);continue}let e=!1;const s=[],n=Object(y.b)(t),c=n&&1!==a.readAttribute("cluster_count")?"aggregate":"feature";for(const r of i){if(r.target!==c)continue;const i=a.getStorage(),o=n&&"feature"===c?i.getComputedStringAtIndex(a.readAttribute("referenceId"),r.fieldIndex):i.getComputedStringAtIndex(t,r.fieldIndex);if(!o)continue;const h=Object(d.a)(o.toString()),l=h[0],u=h[1];this._store.getMosaicItem(r.symbol,Object(p.a)(l)).then(t=>{s[r.index]={glyphs:t.glyphMosaicItems,rtl:u,index:r.index}}),e=!0}r.set(t,s),e&&this._markUsed(o,a)}return r}};g=Object(i.a)([Object(a.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],g);var O=g;e.default=O}}]);
//# sourceMappingURL=43.7f776a61.chunk.js.map