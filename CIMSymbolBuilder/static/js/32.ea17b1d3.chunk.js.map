{"version":3,"sources":["../node_modules/@arcgis/core/layers/support/ElevationSampler.js","../node_modules/@arcgis/core/layers/support/ElevationTile.js","../node_modules/@arcgis/core/layers/support/ElevationQuery.js"],"names":["l","e","getLogger","c","queryElevation","t","n","h","spatialReference","type","z","elevationAt","f","s","hasM","hasZ","i","paths","length","o","r","x","y","a","points","u","clone","this","on","projectIfRequired","m","constructor","super","tile","noDataValue","extent","lodAt","level","resolution","demResolution","min","max","contains","xmin","ymin","xmax","ymax","warn","sample","p","samplers","map","union","Math","equals","error","wkid","remove","samplerData","pixelData","values","width","height","safeWidth","dx","dy","x0","y1","d","floor","D","w","g","ignoreInvisibleLayers","filter","visible","slice","fromGeometry","returnSampleInfo","maximumAutoTileRequests","query","_queryAllContinue","geometry","export","sampleInfo","minDemResolution","R","load","_createGeometryDescriptor","_selectTiles","_populateElevationTiles","_sampleGeometryWithElevation","_createQueryResult","_createSampler","_createSamplerAllContinue","tileInfo","E","v","elevationTiles","layer","options","pop","concat","coordinates","forEach","source","push","outSpatialReference","project","_extractSampleInfo","elevationTile","_preselectOutsideLayerExtent","_selectTilesClosestResolution","_selectTilesFinestContiguous","_selectTilesAuto","outsideExtentTile","fullExtent","_findNearestDemResolutionLODIndex","selectTilesAtLOD","lods","abs","q","_selectTilesFinestContiguousAt","tilemapCache","getTilesToFetch","fetchAvailability","row","col","signal","allElevationTilesFetched","clearElevationTiles","fetchTile","then","id","populateElevationTiles","_selectTilesAutoFinest","_reduceTilesForMaximumRequests","_selectTilesAutoPrefetchUpsample","async","fetchAvailabilityUpsample","ok","remapTiles","forEachTileToFetch","upsampleTile","_exporter","_cloneCoordinate","isWGS84","spatiaReference","_","tileAt","some","candidateTiles","fetchedCandidates","Set","intersection","maskExtents","_maximumLodForRequests","_selectCandidateTilesCoveringExtentAt","size","ceil","clear","add","_uniqueNonOverlappingTiles","has","sort","T","updateTileInfo","_tileIsMasked","findIndex"],"mappings":"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","file":"static/js/32.ea17b1d3.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport\"../../core/has.js\";import e from\"../../core/Logger.js\";import{canProject as t,project as n}from\"../../geometry/support/webMercatorUtils.js\";import s from\"../../geometry/Point.js\";import{extentContainsPoint as i}from\"../../geometry/support/contains.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as o}from\"../../core/unitUtils.js\";import{toExtent as r,create as a}from\"../../geometry/support/aaBoundingRect.js\";const l=e.getLogger(\"esri.layers.support.ElevationSampler\");class c{queryElevation(e){return u(e.clone(),this)}on(){return x}projectIfRequired(e,t){return h(e,t)}}class m extends c{constructor(e,t,n){super(),this.tile=e,this.noDataValue=n,this.extent=r(e.tile.extent,t.spatialReference);const s=o(t.spatialReference),i=t.lodAt(e.tile.level).resolution*s;this.demResolution={min:i,max:i}}get spatialReference(){return this.extent.spatialReference}contains(e){const t=this.projectIfRequired(e,this.spatialReference);return i(this.extent,t)}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;if(!this.contains(e)){const t=this.extent,n=`${t.xmin}, ${t.ymin}, ${t.xmax}, ${t.ymax}`;l.warn(\"#elevationAt()\",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler extent (${n})`)}return this.tile.sample(t.x,t.y)}}class p extends c{constructor(e,t,n){let s;super(),\"number\"==typeof t?(this.noDataValue=t,s=null):(s=t,this.noDataValue=n),this.samplers=s?e.map((e=>new m(e,s,this.noDataValue))):e;const i=this.samplers[0];if(i){this.extent=i.extent.clone();const{min:e,max:t}=i.demResolution;this.demResolution={min:e,max:t};for(let e=1;e<this.samplers.length;e++){const t=this.samplers[e];this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}}else this.extent=r(a(),s.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt(e){const t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;for(const e of this.samplers)if(e.contains(t))return e.elevationAt(t);return l.warn(\"#elevationAt()\",`Point used to sample elevation (${e.x}, ${e.y}) is outside of the sampler`),null}}function u(e,t){const n=h(e,t.spatialReference);if(!n)return null;switch(e.type){case\"point\":!function(e,t,n){e.z=n.elevationAt(t)||0}(e,n,t);break;case\"polyline\":!function(e,t,n){f.spatialReference=t.spatialReference;const s=e.hasM&&!e.hasZ;for(let i=0;i<e.paths.length;i++){const o=e.paths[i],r=t.paths[i];for(let e=0;e<o.length;e++){const t=o[e],i=r[e];f.x=i[0],f.y=i[1];const a=n.elevationAt(f)||0;s&&(t[3]=t[2]),t[2]=a}}e.hasZ=!0}(e,n,t);break;case\"multipoint\":!function(e,t,n){f.spatialReference=t.spatialReference;const s=e.hasM&&!e.hasZ;for(let i=0;i<e.points.length;i++){const o=e.points[i],r=t.points[i];f.x=r[0],f.y=r[1];const a=n.elevationAt(f)||0;s&&(o[3]=o[2]),o[2]=a}e.hasZ=!0}(e,n,t)}return e}function h(e,s){const i=e.spatialReference;return i.equals(s)?e:t(i,s)?n(e,s):(l.error(`Cannot project geometry spatial reference (wkid:${i.wkid}) to elevation sampler spatial reference (wkid:${s.wkid})`),null)}const f=new s,x={remove(){}};export{c as ElevationSamplerBase,p as MultiTileElevationSampler,m as TileElevationSampler,u as updateGeometryElevation};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nclass t{constructor(t,a){if(this.tile=t,!a)return void(this.samplerData=null);const e=this.tile.extent;this.samplerData={pixelData:a.values,width:a.width,height:a.height,safeWidth:.99999999*(a.width-1),noDataValue:a.noDataValue,dx:(a.width-1)/(e[2]-e[0]),dy:(a.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]}}sample(t,e){if(this.samplerData)return function(t,e,i){const{safeWidth:h,width:r,pixelData:s,noDataValue:l}=t,n=a(t.dy*(t.y1-i),0,h),o=a(t.dx*(e-t.x0),0,h),d=Math.floor(n),u=Math.floor(o),f=d*r+u,p=f+r,x=s[f],D=s[p],c=s[f+1],w=s[p+1];if(x!==l&&D!==l&&c!==l&&w!==l){const t=o-u,a=x+(c-x)*t;return a+(D+(w-D)*t-a)*(n-d)}return}(this.samplerData,t,e)}}function a(t,a,e){return t<a?a:t>e?e:t}export default t;export{t as ElevationTile};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{reject as t,all as i,isAbortError as o,eachAlways as l,throwIfAborted as s}from\"../../core/promiseUtils.js\";import{canProject as n,project as a,xyToLngLat as r,lngLatToXY as c}from\"../../geometry/support/webMercatorUtils.js\";import u from\"../../geometry/Point.js\";import m from\"../../geometry/Multipoint.js\";import p from\"../../geometry/Polyline.js\";import{result as h}from\"../../core/asyncUtils.js\";import{getMetersPerUnitForSR as f}from\"../../core/unitUtils.js\";import{fromExtent as d,create as y,contains as T}from\"../../geometry/support/aaBoundingRect.js\";import{MultiTileElevationSampler as v}from\"./ElevationSampler.js\";import{ElevationTile as x}from\"./ElevationTile.js\";class g{async queryAll(i,o,l){if(!(i=l&&l.ignoreInvisibleLayers?i.filter((e=>e.visible)):i.slice()).length)return t(new e(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\"));const s=w.fromGeometry(o);let n=!1;l&&l.returnSampleInfo||(n=!0);const a={noDataValue:0,maximumAutoTileRequests:20,...l,returnSampleInfo:!0,demResolution:\"auto\"},r=await this.query(i[i.length-1],s,a),c=await this._queryAllContinue(i,r,a);return c.geometry=c.geometry.export(),n&&delete c.sampleInfo,c}async query(i,o,l){if(!i)return t(new e(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\"));if(!o||!(o instanceof w)&&\"point\"!==o.type&&\"multipoint\"!==o.type&&\"polyline\"!==o.type)return t(new e(\"elevation-query:invalid-geometry\",\"Only point, polyline and multipoint geometries can be used to query elevation\"));l={noDataValue:0,demResolution:\"auto\",minDemResolution:0,maximumAutoTileRequests:20,returnSampleInfo:!1,...l};const s=new R(i,o.spatialReference,l);return await i.load(l),this._createGeometryDescriptor(s,o),await this._selectTiles(s),await this._populateElevationTiles(s),this._sampleGeometryWithElevation(s),this._createQueryResult(s)}async createSampler(i,o,l){return i?o&&\"extent\"===o.type?(l={noDataValue:0,demResolution:\"auto\",maximumAutoTileRequests:20,returnSampleInfo:!1,...l},this._createSampler(i,o,l)):t(new e(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\")):t(new e(\"elevation-query:invalid-layer\",\"Elevation queries require an elevation layer to fetch tiles from\"))}async createSamplerAll(i,o,l){if(!(i=l&&l.ignoreInvisibleLayers?i.filter((e=>e.visible)):i.slice()).length)return t(new e(\"elevation-query:invalid-layer\",\"Elevation queries require at least one elevation layer to fetch tiles from\"));if(!o||\"extent\"!==o.type)return t(new e(\"elevation-query:invalid-extent\",\"Invalid or undefined extent\"));const s={noDataValue:0,maximumAutoTileRequests:20,...l,returnSampleInfo:!0,demResolution:\"auto\"},n=await this._createSampler(i[i.length-1],o,s);return this._createSamplerAllContinue(i,o,n,s)}async _createSampler(i,o,l,s){await i.load();const r=o.spatialReference,c=i.tileInfo.spatialReference;if(!r.equals(c)){if(!n(r,c))return t(new e(\"elevation-query:invalid-extent\",`Extent spatial reference (${r.wkid}) must be compatible with tile spatial reference (${c.wkid})`));o=a(o,c)}const u=new E(i,o,l,s);return await this._selectTiles(u),await this._populateElevationTiles(u),new v(u.elevationTiles,u.layer.tileInfo,u.options.noDataValue)}async _createSamplerAllContinue(e,t,i,o){if(e.pop(),!e.length)return i;const l=i.samplers.map((e=>d(e.extent))),s=await this._createSampler(e[e.length-1],t,o,l);if(0===s.samplers.length)return i;const n=i.samplers.concat(s.samplers),a=new v(n,o.noDataValue);return this._createSamplerAllContinue(e,t,a,o)}async _queryAllContinue(e,t,i){const o=e.pop();if(t.geometry.coordinates.forEach(((e,i)=>{t.sampleInfo[i].demResolution>=0&&!t.sampleInfo[i].source&&(t.sampleInfo[i].source=o)})),!e.length)return t;const l=t.geometry.coordinates,s=[],n=[];for(let e=0;e<l.length;e++)t.sampleInfo[e].demResolution<0&&(s.push(l[e]),n.push(e));if(0===s.length)return t;const a=t.geometry.clone(s),r=await this.query(e[e.length-1],a,i);return n.forEach(((e,i)=>{l[e].z=r.geometry.coordinates[i].z,t.sampleInfo[e].demResolution=r.sampleInfo[i].demResolution})),this._queryAllContinue(e,t,i)}_createQueryResult(e){let t;t=e.outSpatialReference.equals(e.geometry.spatialReference)?e.geometry:e.geometry.project(e.outSpatialReference);const i={geometry:t.export(),noDataValue:e.options.noDataValue};return e.options.returnSampleInfo&&(i.sampleInfo=this._extractSampleInfo(e)),e.geometry.coordinates.forEach((e=>{e.tile=null,e.elevationTile=null})),i}_createGeometryDescriptor(t,i){let o;const l=t.layer.tileInfo.spatialReference;if(o=i instanceof w?i.project(l):a(i,l),!o)throw new e(\"elevation-query:spatial-reference-mismatch\",`Cannot query elevation in '${i.spatialReference.wkid}' on an elevation service in '${l.wkid}'`);t.geometry=w.fromGeometry(o)}async _selectTiles(t){const i=t.options.demResolution;if(\"geometry\"===t.type&&this._preselectOutsideLayerExtent(t),\"number\"==typeof i)this._selectTilesClosestResolution(t);else if(\"finest-contiguous\"===i)await this._selectTilesFinestContiguous(t);else{if(\"auto\"!==i)throw new e(\"elevation-query:invalid-dem-resolution\",`Invalid dem resolution value '${i}', expected a number, \"finest-contiguous\" or \"auto\"`);await this._selectTilesAuto(t)}}_preselectOutsideLayerExtent(e){const t=new x(null);t.sample=()=>e.options.noDataValue,e.outsideExtentTile=t;const i=e.layer.fullExtent;e.geometry.coordinates.forEach((e=>{const o=e.x,l=e.y;(o<i.xmin||o>i.xmax||l<i.ymin||l>i.ymax)&&(e.elevationTile=t)}))}_selectTilesClosestResolution(e){const t=e.layer.tileInfo,i=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(i)}_findNearestDemResolutionLODIndex(e,t){const i=t/f(e.spatialReference);let o=e.lods[0],l=0;for(let t=1;t<e.lods.length;t++){const s=e.lods[t];Math.abs(s.resolution-i)<Math.abs(o.resolution-i)&&(o=s,l=t)}return l}async _selectTilesFinestContiguous(e){const t=q(e.layer.tileInfo,e.options.minDemResolution);await this._selectTilesFinestContiguousAt(e,t)}async _selectTilesFinestContiguousAt(t,l){const s=t.layer;if(t.selectTilesAtLOD(l),l<0)return;const n=s.tilemapCache,a=t.getTilesToFetch();try{if(n)await i(a.map((e=>n.fetchAvailability(e.level,e.row,e.col,{signal:t.options.signal}))));else if(await this._populateElevationTiles(t),!t.allElevationTilesFetched())throw t.clearElevationTiles(),new e(\"elevation-query:has-unavailable-tiles\")}catch(e){if(o(e))throw e;await this._selectTilesFinestContiguousAt(t,l-1)}}async _populateElevationTiles(e){const t=e.getTilesToFetch(),i={},o=t.map((t=>e.layer.fetchTile(t.level,t.row,t.col,{noDataValue:e.options.noDataValue,signal:e.options.signal}).then((e=>i[t.id]=new x(t,e)))));await l(o),s(e.options.signal),e.populateElevationTiles(i)}async _selectTilesAuto(e){this._selectTilesAutoFinest(e),this._reduceTilesForMaximumRequests(e);const t=e.layer.tilemapCache;if(!t)return this._selectTilesAutoPrefetchUpsample(e);const l=e.getTilesToFetch(),s={},n=l.map((async i=>{const l={id:null,level:0,row:0,col:0,extent:y()},n=await h(t.fetchAvailabilityUpsample(i.level,i.row,i.col,l,{signal:e.options.signal}));if(!1===n.ok&&o(n.error))throw n.error;!0===n.ok&&(s[i.id]=l)}));await i(n),e.remapTiles(s)}_reduceTilesForMaximumRequests(e){const t=e.layer.tileInfo;let i=0;const o={},l=e=>{e.id in o?o[e.id]++:(o[e.id]=1,i++)},s=e=>{const t=o[e.id];1===t?(delete o[e.id],i--):o[e.id]=t-1};e.forEachTileToFetch(l,s);let n=!0;for(;n&&(n=!1,e.forEachTileToFetch((o=>{i<=e.options.maximumAutoTileRequests||(s(o),t.upsampleTile(o)&&(n=!0),l(o))}),s),n););}_selectTilesAutoFinest(e){const t=q(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}async _selectTilesAutoPrefetchUpsample(e){const t=e.layer.tileInfo;await this._populateElevationTiles(e);let i=!1;e.forEachTileToFetch(((e,o)=>{t.upsampleTile(e)?i=!0:o()})),i&&await this._selectTilesAutoPrefetchUpsample(e)}_sampleGeometryWithElevation(e){e.geometry.coordinates.forEach((t=>{const i=t.elevationTile;let o=e.options.noDataValue;if(i){const e=i.sample(t.x,t.y);void 0!==e?o=e:t.elevationTile=null}t.z=o}))}_extractSampleInfo(e){const t=e.layer.tileInfo,i=f(t.spatialReference);return e.geometry.coordinates.map((o=>{let l=-1;if(o.elevationTile&&o.elevationTile!==e.outsideExtentTile){l=t.lodAt(o.elevationTile.tile.level).resolution*i}return{demResolution:l}}))}}class w{export(){return this._exporter(this.coordinates,this.spatialReference)}clone(e){const t=new w;return t.geometry=this.geometry,t.spatialReference=this.spatialReference,t.coordinates=e||this.coordinates.map((e=>this._cloneCoordinate(e))),t._exporter=this._exporter,t}project(e){if(this.spatialReference.equals(e))return this.clone();if(n(this.spatialReference,e)){const t=e.isWGS84?r:c,i=[0,0],o=this.coordinates.map((e=>{const o=this._cloneCoordinate(e);return t(o.x,o.y,i),o.x=i[0],o.y=i[1],o})),l=this.clone(o);return l.spatialReference=e,l}return null}_cloneCoordinate(e){return{x:e.x,y:e.y,z:e.z,m:e.m,tile:null,elevationTile:null}}static fromGeometry(e){const t=new w;if(t.geometry=e,t.spatialReference=e.spatialReference,e instanceof w)t.coordinates=e.coordinates.map((e=>t._cloneCoordinate(e))),t._exporter=(t,i)=>{const o=e.clone(t);return o.spatialReference=i,o};else switch(e.type){case\"point\":{const i=e;e.hasM?t.coordinates=[{x:i.x,y:i.y,m:i.m}]:t.coordinates=[{x:i.x,y:i.y}],t._exporter=(t,i)=>e.hasM?new u(t[0].x,t[0].y,t[0].z,t[0].m,i):new u(t[0].x,t[0].y,t[0].z,i);break}case\"multipoint\":{const i=e;t.coordinates=i.points.map((t=>{if(e.hasM){const i=e.hasZ?3:2;return{x:t[0],y:t[1],m:t[i]}}return{x:t[0],y:t[1]}})),t._exporter=(t,i)=>e.hasM?new m({points:t.map((e=>[e.x,e.y,e.z,e.m])),hasZ:!0,hasM:!0,spatiaReference:i}):new m(t.map((e=>[e.x,e.y,e.z])),i);break}case\"polyline\":{const i=[],o=[];let l=0;e.paths.forEach((t=>{o.push([l,l+t.length]),l+=t.length,i.push(...t.map((t=>{if(e.hasM){const i=e.hasZ?3:2;return{x:t[0],y:t[1],m:t[i]}}return{x:t[0],y:t[1]}})))})),t.coordinates=i,t._exporter=(t,i)=>{const l=e.hasM?t.map((e=>[e.x,e.y,e.z,e.m])):t.map((e=>[e.x,e.y,e.z])),s=o.map((e=>l.slice(e[0],e[1])));return new p({paths:s,hasM:e.hasM,hasZ:!0,spatialReference:i})};break}}return t}}class _{constructor(e,t){this.layer=e,this.options=t}}class R extends _{constructor(e,t,i){super(e,i),this.type=\"geometry\",this.outSpatialReference=t}selectTilesAtLOD(e){if(e<0)this.geometry.coordinates.forEach((e=>e.tile=null));else{const t=this.layer.tileInfo,i=t.lods[e].level;this.geometry.coordinates.forEach((e=>{e.tile=t.tileAt(i,e.x,e.y)}))}}allElevationTilesFetched(){return!this.geometry.coordinates.some((e=>!e.elevationTile))}clearElevationTiles(){for(const e of this.geometry.coordinates)e.elevationTile!==this.outsideExtentTile&&(e.elevationTile=null)}populateElevationTiles(e){for(const t of this.geometry.coordinates)!t.elevationTile&&t.tile&&(t.elevationTile=e[t.tile.id])}remapTiles(e){for(const t of this.geometry.coordinates)t.tile=e[t.tile.id]}getTilesToFetch(){const e={},t=[];for(const i of this.geometry.coordinates){const o=i.tile;i.elevationTile||!i.tile||e[o.id]||(e[o.id]=o,t.push(o))}return t}forEachTileToFetch(e){for(const t of this.geometry.coordinates)t.tile&&!t.elevationTile&&e(t.tile,(()=>t.tile=null))}}class E extends _{constructor(e,t,i,o){super(e,i),this.type=\"extent\",this.elevationTiles=[],this.candidateTiles=[],this.fetchedCandidates=new Set,this.extent=t.intersection(e.fullExtent),this.maskExtents=o}selectTilesAtLOD(e,t){const i=this._maximumLodForRequests(t),o=Math.min(i,e);o<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(o)}_maximumLodForRequests(e){const t=this.layer.tileInfo;if(!e)return t.lods.length-1;const i=this.extent;for(let o=t.lods.length-1;o>=0;o--){const l=t.lods[o],s=l.resolution*t.size[0],n=l.resolution*t.size[1];if(Math.ceil(i.width/s)*Math.ceil(i.height/n)<=e)return o}return-1}allElevationTilesFetched(){return this.candidateTiles.length===this.elevationTiles.length}clearElevationTiles(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}populateElevationTiles(e){for(const t of this.candidateTiles){const i=e[t.id];i&&(this.fetchedCandidates.add(t),this.elevationTiles.push(i))}}remapTiles(e){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map((t=>e[t.id])))}getTilesToFetch(){return this.candidateTiles}forEachTileToFetch(e,t){const i=this.candidateTiles;this.candidateTiles=[],i.forEach((i=>{if(this.fetchedCandidates.has(i))return void(t&&t(i));let o=!1;e(i,(()=>o=!0)),o?t&&t(i):this.candidateTiles.push(i)})),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,t)}_uniqueNonOverlappingTiles(e,t){const i={},o=[];for(const l of e)i[l.id]?t&&t(l):(i[l.id]=l,o.push(l));const l=o.sort(((e,t)=>e.level-t.level));return l.filter(((e,i)=>{for(let o=0;o<i;o++)if(T(l[o].extent,e.extent))return t&&t(e),!1;return!0}))}_selectCandidateTilesCoveringExtentAt(e){this.candidateTiles.length=0;const t=this.layer.tileInfo,i=t.lods[e],o=this.extent,l=t.tileAt(i.level,o.xmin,o.ymin),s=i.resolution*t.size[0],n=i.resolution*t.size[1],a=Math.ceil((o.xmax-l.extent[0])/s),r=Math.ceil((o.ymax-l.extent[1])/n);for(let e=0;e<r;e++)for(let i=0;i<a;i++){const o={id:null,level:l.level,row:l.row-e,col:l.col+i};t.updateTileInfo(o),this._tileIsMasked(o)||this.candidateTiles.push(o)}}_tileIsMasked(e){return!!this.maskExtents&&this.maskExtents.some((t=>T(t,e.extent)))}}function q(e,t){let i=e.lods.length-1;if(t>0){const o=e.lods.findIndex((e=>e.resolution<t));0===o?i=0:o>0&&(i=o-1)}return i}export default g;export{g as ElevationQuery,w as GeometryDescriptor,q as getFinestLodIndex};\n"],"sourceRoot":""}