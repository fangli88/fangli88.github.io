import{b as t,U as n,Z as e,bc as r,aJ as u,a2 as o}from"./p-ab028778.js";import{P as c}from"./p-c6c7c9c2.js";import{t as s}from"./p-15538a25.js";import{t as a}from"./p-8bb40e65.js";function l(t){const n={};for(const e in t){if("declaredClass"===e)continue;const r=t[e];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){n[e]=[];for(let t=0;t<r.length;t++)n[e][t]=l(r[t])}else"object"==typeof r?r.toJSON&&(n[e]=JSON.stringify(r)):n[e]=r}return n}function f(n,e){const r=n.geometry,o=n.toJSON(),c=o;if(t(r)&&(c.geometry=JSON.stringify(r),c.geometryType=u(r),c.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),o.groupByFieldsForStatistics&&(c.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(",")),o.objectIds&&(c.objectIds=o.objectIds.join(",")),o.orderByFields&&(c.orderByFields=o.orderByFields.join(",")),!o.outFields||!o.returnDistinctValues&&(null!=e&&e.returnCountOnly||null!=e&&e.returnExtentOnly||null!=e&&e.returnIdsOnly)?delete c.outFields:c.outFields=-1!==o.outFields.indexOf("*")?"*":o.outFields.join(","),o.outSR?c.outSR=o.outSR.wkid||JSON.stringify(o.outSR):r&&(o.returnGeometry||o.returnCentroid)&&(c.outSR=c.inSR),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(c.outStatistics=JSON.stringify(o.outStatistics)),o.pixelSize&&(c.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(c.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(c.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(c.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(c.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const t=o.timeExtent,{start:n,end:e}=t;null==n&&null==e||(c.time=n===e?n:`${null==n?"null":n},${null==e?"null":e}`),delete o.timeExtent}return c}async function i(n,e,r,u){const o=t(e.timeExtent)&&e.timeExtent.isEmpty?{data:{features:[]}}:await j(n,e,"json",u);return s(e,r,o.data),o}async function y(e,r,u,o){if(t(r.timeExtent)&&r.timeExtent.isEmpty)return n({data:u.createFeatureResult()});const c=await p(e,r,o),s=c;return s.data=a(c.data,u),s}function p(t,n,e){return j(t,n,"pbf",e)}function d(e,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?n({data:{objectIds:[]}}):j(e,r,"json",u,{returnIdsOnly:!0})}function O(e,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?n({data:{count:0}}):j(e,r,"json",u,{returnIdsOnly:!0,returnCountOnly:!0})}function x(e,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?n({data:{count:0,extent:null}}):j(e,r,"json",u,{returnExtentOnly:!0,returnCountOnly:!0}).then((t=>{const n=t.data;if(n.hasOwnProperty("extent"))return t;if(n.features)throw new Error("Layer does not support extent calculation.");if(n.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return t}))}function j(n,u,s,a={},i){const y="string"==typeof n?o(n):n,p=u.geometry?[u.geometry]:[];return a.responseType="pbf"===s?"array-buffer":"json",c(p,null,a).then((n=>{const o=n&&n[0];t(o)&&((u=u.clone()).geometry=o);const c=l({...y.query,f:s,...i,...f(u,i)});return e(r(y.path,"query"),{...a,query:{...c,...a.query}})}))}const b=Object.freeze({__proto__:null,executeQuery:i,executeQueryForCount:O,executeQueryForExtent:x,executeQueryForIds:d,executeQueryPBF:y,executeQueryPBFBuffer:p,queryToQueryStringParameters:f,runQuery:j});export{x as S,y as c,p as d,O as f,d as p,b as q,l as t,i as y}