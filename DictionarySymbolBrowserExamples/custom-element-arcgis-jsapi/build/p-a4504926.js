import"./p-476cf7c4.js";import{P as e,l as t,Q as a,O as s,m as n,b as l,U as o,R as c,S as r,T as i,V as p,W as h,t as u,N as f,X as m}from"./p-dc4230e0.js";import"./p-a8d014d4.js";import"./p-0a74e573.js";import{resolveWebStyleSymbol as d}from"./p-46a6b4f6.js";import{p as b,g as y}from"./p-8493f348.js";import{u as k,l as v,g as M,s as w,a as g,L,p as j,t as x,o as S,n as D,c as P,m as Z,e as q}from"./p-e8a12b65.js";import"./p-eb53cb9f.js";import"./p-dfd483d8.js";const I=e("esri/symbols/patterns/"),N=e("esri/images/Legend/legend3dsymboldefault.png"),R=t.getLogger("esri.symbols.support.previewSymbol3D");function T(e){const t=e.outline,a=l(e.material)?e.material.color:null,s=l(a)?a.toRgba().toString():null;if(u(t))return"fill"===e.type&&"255,255,255,1"===s?{color:"#bdc3c7",width:.75}:null;const n=f(t.size)||0;return{color:"rgba("+(l(t.color)?t.color.toRgba():"255,255,255,1")+")",width:Math.min(n,80)}}function W(e,t=1){const a=e.a,s=b(e),n=s.h,l=s.s/t,o=100-(100-s.v)/t,{r:c,g:r,b:i}=y({h:n,s:l,v:o});return[c,r,i,a]}function $(e){return"water"===e.type?u(e.color)?null:e.color:u(e.material)||u(e.material.color)?null:e.material.color}function F(e,t=0){const a=$(e);if(!a){const e=k(m.r,t);return[e,e,e,100]}const s=a.toRgba();for(let e=0;e<3;e++)s[e]=k(s[e],t);return s}async function H(e,t){const s=e.style;return"none"===s?null:{type:"pattern",x:0,y:0,src:await a(`${I}${s}.png`,t.toCss(!0)),width:5,height:5}}function Q(e){return e.outline?T(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function V(e,t){const a=$(e);if(!a)return null;let s="rgba(";return s+=k(a.r,t)+",",s+=k(a.g,t)+",",s+=k(a.b,t)+",",s+a.a+");"}function X(e,t){const a=V(e,t);return a?{color:a,width:Math.min(e.size?f(e.size):.75,80)}:{}}function z(e,t,a){const s=.75*a;return{type:"linear",x1:s?.25*s:0,y1:s?.5*s:0,x2:s||4,y2:s?.5*s:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function A(e,t){const a=t&&t.size?f(t.size):null,s=t&&t.maxSize?f(t.maxSize):null,n=t&&t.disableUpsampling,l=e.symbolLayers,c=[];let u=0,m=0;const b=l.getItemAt(l.length-1);let y;return b&&"icon"===b.type&&(y=b.size&&f(b.size)),l.forEach((l=>{if("icon"!==l.type&&"object"!==l.type)return;const h="icon"===l.type?l.size&&f(l.size):0,b=a||h?Math.ceil(Math.min(a||h,s||120)):22;if(l&&l.resource&&l.resource.href){const t=function(e,t){const a=t&&t.resource,s=a&&a.href;return e.thumbnail&&e.thumbnail.url?o(e.thumbnail.url):s&&"object"!==t.type?o(r(e,t)):e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?d(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch((e=>e)).then((e=>e&&e.thumbnail&&e.thumbnail.url||N)):o(N)}(e,l).then((function(e){const t=l.get("material.color"),a=function(e){return"icon"===e.type?"multiply":"tint"}(l);return M(e,b,t,a,n)})).then((function(e){const t=e.width,a=e.height;return u=Math.max(u,t),m=Math.max(m,a),[{shape:{type:"image",x:0,y:0,width:t,height:a,src:e.url},fill:null,stroke:null}]}));c.push(t)}else{var k;let e=b;"icon"===l.type&&y&&a&&(e=b*(h/y));const s="tall"===(null==t?void 0:t.symbolConfig)||(null==t||null==(k=t.symbolConfig)?void 0:k.isTall)||"object"===l.type&&function(e){const t=e.depth,a=e.height,s=e.width;return s&&t&&a&&s===t&&s<a}(l);u=Math.max(u,s?20:e),m=Math.max(m,e),c.push(o(function(e,t,a){const s=[];if(!e)return s;switch(e.type){case"icon":{const a=0,n=0,l=t,o=t;switch(e.resource&&e.resource.primitive||p){case"circle":s.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:F(e,0),stroke:T(e)});break;case"square":s.push({shape:{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[a,n]},{command:"L",values:[l,n]},{command:"L",values:[l,o]},{command:"Z",values:[]}]},fill:F(e,0),stroke:T(e)});break;case"triangle":s.push({shape:{type:"path",path:[{command:"M",values:[a,o]},{command:"L",values:[.5*l,n]},{command:"L",values:[l,o]},{command:"Z",values:[]}]},fill:F(e,0),stroke:T(e)});break;case"cross":s.push({shape:{type:"path",path:[{command:"M",values:[.5*l,n]},{command:"L",values:[.5*l,o]},{command:"M",values:[a,.5*o]},{command:"L",values:[l,.5*o]}]},stroke:Q(e)});break;case"x":s.push({shape:{type:"path",path:[{command:"M",values:[a,n]},{command:"L",values:[l,o]},{command:"M",values:[l,n]},{command:"L",values:[a,o]}]},stroke:Q(e)});break;case"kite":s.push({shape:{type:"path",path:[{command:"M",values:[a,.5*o]},{command:"L",values:[.5*l,n]},{command:"L",values:[l,.5*o]},{command:"L",values:[.5*l,o]},{command:"Z",values:[]}]},fill:F(e,0),stroke:T(e)})}break}case"object":switch(e.resource&&e.resource.primitive||i){case"cone":{const n=z(F(e,0),F(e,-.6),a?20:t),l=D(t,a);s.push({shape:l[0],fill:n}),s.push({shape:l[1],fill:n});break}case"inverted-cone":{const a=F(e,0),n=z(a,F(e,-.6),t),l=S(t);s.push({shape:l[0],fill:n}),s.push({shape:l[1],fill:a});break}case"cube":{const n=j(t,a);s.push({shape:n[0],fill:F(e,0)}),s.push({shape:n[1],fill:F(e,-.3)}),s.push({shape:n[2],fill:F(e,-.5)});break}case"cylinder":{const n=z(F(e,0),F(e,-.6),a?20:t),l=L(t,a);s.push({shape:l[0],fill:n}),s.push({shape:l[1],fill:n}),s.push({shape:l[2],fill:F(e,0)});break}case"diamond":{const a=g(t);s.push({shape:a[0],fill:F(e,-.3)}),s.push({shape:a[1],fill:F(e,0)}),s.push({shape:a[2],fill:F(e,-.3)}),s.push({shape:a[3],fill:F(e,-.7)});break}case"sphere":{const a=z(F(e,0),F(e,-.6));a.x1=0,a.y1=0,a.x2=.25*t,a.y2=.25*t,s.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:a});break}case"tetrahedron":{const a=w(t);s.push({shape:a[0],fill:F(e,-.3)}),s.push({shape:a[1],fill:F(e,0)}),s.push({shape:a[2],fill:F(e,-.6)});break}}}return s}(l,e,s)))}})),h(c).then((function(e){const a=[];return e.forEach((function(e){e.value?a.push(e.value):e.error&&R.warn("error while building swatchInfo!",e.error)})),v(a,[u,m],{node:t&&t.node,scale:!1,opacity:t&&t.opacity})}))}function B(e,t){if(0===e.symbolLayers.length)return s(new n("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));let a=null;switch(e.type){case"point-3d":a=A(e,t);break;case"line-3d":a=function(e,t){const a=e.symbolLayers,s=[],n=c(e),l=t&&t.size?f(t.size):null,r=(t&&t.maxSize?f(t.maxSize):null)||80;let i,p=0,h=0;return a.forEach(((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const a=[];switch(e.type){case"line":{const s=X(e,0),n=s&&s.width||0;0===t&&(i=n);const o=Math.min(l||n,r),c=0===t?o:l?o*(n/i):o,u=c>20?2*c:40;h=Math.max(h,c),p=Math.max(p,u),s.width=c,a.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[p,.5*h]}]},stroke:s});break}case"path":{const t=Math.min(l||22,r),s=F(e,0),n=F(e,-.2),o=V(e,-.4),c=o?{color:o,width:1}:{};if("quad"===e.profile){const t=e.width||e.size,l=e.height||e.size,o=q(t&&l?t/l:1),r={...c,join:"bevel"};a.push({shape:o[0],fill:n,stroke:r}),a.push({shape:o[1],fill:n,stroke:r}),a.push({shape:o[2],fill:s,stroke:r})}else a.push({shape:x.pathSymbol3DLayer[0],fill:n,stroke:c}),a.push({shape:x.pathSymbol3DLayer[1],fill:s,stroke:c});h=Math.max(h,t),p=h}}s.push(a)})),o(v(s,[p,h],{node:t&&t.node,scale:n,opacity:t&&t.opacity}))}(e,t);break;case"polygon-3d":case"mesh-3d":a=async function(e,t){const a="mesh-3d"===e.type,s=e.symbolLayers,n=t&&t.size?f(t.size):null,c=t&&t.maxSize?f(t.maxSize):null,r=n||22,i=[];let p=0,h=0,u=!1;for(let e=0;e<s.length;e++){const t=s.getItemAt(e),n=[];if(a&&"fill"!==t.type)continue;const o=x.fill[0];switch(t.type){case"fill":{const e=T(t),s=Math.min(r,c||120);p=Math.max(p,s),h=Math.max(h,s),u=!0;let i=F(t,0);const f="pattern"in t&&t.pattern,m=$(t);!a&&l(f)&&"style"===f.type&&"solid"!==f.style&&m&&(i=await H(f,m)),n.push({shape:o,fill:i,stroke:e});break}case"line":{const e={stroke:X(t,0),shape:o};p=Math.max(p,22),h=Math.max(h,22),n.push(e);break}case"extrude":{const e={join:"round",...X(t,-.4)},a=F(t,0),s=F(t,-.2),l=Math.min(r,c||120),o=Z(l);e.width=1,n.push({shape:o[0],fill:s,stroke:e}),n.push({shape:o[1],fill:s,stroke:e}),n.push({shape:o[2],fill:a,stroke:e});const i=22*.7+.5*l;p=Math.max(p,22),h=Math.max(h,i);break}case"water":{const e=$(t),a=W(e),s=W(e,2),l=W(e,3),o=P();u=!0,n.push({shape:o[0],fill:a}),n.push({shape:o[1],fill:s}),n.push({shape:o[2],fill:l});const i=Math.min(r,c||120);p=Math.max(p,i),h=Math.max(h,i);break}}i.push(n)}return o(v(i,[p,h],{node:t&&t.node,scale:u,opacity:t&&t.opacity}))}(e,t)}return a||s(new n("symbolPreview: swatchInfo3D","symbol not supported."))}export{H as getPatternDescriptor,F as getSymbolLayerFill,B as previewSymbol3D}