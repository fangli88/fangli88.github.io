import{m as n}from"./p-ab028778.js";import{t as e,a as t}from"./p-ebb65ba7.js";function o(n){const e=[];return n.forEach((n=>e.push(n))),e}const r={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function*i(n){switch(n.type){case"Feature":yield n;break;case"FeatureCollection":for(const e of n.features)e&&(yield e)}}function*u(n){if(!n)return null;switch(n.type){case"Point":yield n.coordinates;break;case"LineString":case"MultiPoint":yield*n.coordinates;break;case"MultiLineString":case"Polygon":for(const e of n.coordinates)yield*e;break;case"MultiPolygon":for(const e of n.coordinates)for(const n of e)yield*n}}function c(n){for(;;){const{value:e,done:t}=n.next();if(t)return!1;if(e.length>2)return!0}}function s(n){let e=0;for(let t=0;t<n.length;t++){const o=n[t],r=n[(t+1)%n.length];e+=o[0]*r[1]-r[0]*o[1]}return e<=0}function l(n){const e=n[0],t=n[n.length-1];return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]||n.push(e),n}function f(n,e,t){switch(e.type){case"LineString":return function(n,e,t){return p(n,e.coordinates,t),n}(n,e,t);case"MultiLineString":return function(n,e,t){for(const o of e.coordinates)p(n,o,t);return n}(n,e,t);case"MultiPoint":return function(n,e,t){return p(n,e.coordinates,t),n}(n,e,t);case"MultiPolygon":return function(n,e,t){for(const o of e.coordinates){a(n,o[0],t);for(let e=1;e<o.length;e++)y(n,o[e],t)}return n}(n,e,t);case"Point":return function(n,e,t){return m(n,e.coordinates,t),n}(n,e,t);case"Polygon":return function(n,e,t){const o=e.coordinates;a(n,o[0],t);for(let e=1;e<o.length;e++)y(n,o[e],t);return n}(n,e,t)}}function a(n,e,t){const o=l(e);s(o)?p(n,o,t):d(n,o,t)}function y(n,e,t){const o=l(e);s(o)?d(n,o,t):p(n,o,t)}function p(n,e,t){for(const o of e)m(n,o,t);n.lengths.push(e.length)}function d(n,e,t){for(let o=e.length-1;o>=0;o--)m(n,e[o],t);n.lengths.push(e.length)}function m(n,e,t){const[o,r,i]=e;n.coords.push(o,r),t.hasZ&&n.coords.push(i||0)}function g(n){switch(typeof n){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function b(e){if(!e)throw new n("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new n("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const o="string"==typeof t?t:"name"===t.type?t.properties.name:null,r=new RegExp(".*(CRS84H?|4326)$","i");if(!o||!r.test(o))throw new n("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function w(n,e={}){const t=i(n),s=[],l=new Set,f=new Set;let a,y=!1,p=Number.NEGATIVE_INFINITY,d=null,m=!1,{geometryType:b=null}=e,w=!1;for(;;){const{value:n,done:e}=t.next();if(e){const n=d&&1===d.length&&d[0]||null;if(n)for(const e of s)e.name===n&&(e.type="esriFieldTypeOID");return{fields:s,geometryType:b,hasZ:y,maxObjectId:Math.max(0,p),objectIdFieldName:n,objectIdFieldType:a,unknownFields:o(f)}}const{geometry:i,properties:P,id:j}=n;if((!i||(b||(b=r[i.type]),r[i.type]===b))&&(y||(y=c(u(i))),m||(m=null!=j,m&&(a=typeof j,"number"===a&&(d=Object.keys(P).filter((n=>P[n]===j))))),m&&"number"===a&&null!=j&&(p=Math.max(p,j),d.length>1?d=d.filter((n=>P[n]===j)):1===d.length&&(d=P[d[0]]===j?d:[])),!w&&P)){let n=!0;for(const e in P){if(l.has(e))continue;const t=P[e];if(null==t){n=!1,f.add(e);continue}const o=g(t);"unknown"!==o?(f.delete(e),l.add(e),s.push({name:e,alias:e,type:o})):f.add(e)}w=n}}}function P(n,o){return function(n){const e=[];for(;;){const{value:t,done:o}=n.next();if(o)return e;e.push(t)}}(function*(n,o={}){const{geometryType:i,objectIdFieldName:u}=o;for(;;){const{value:c,done:s}=n.next();if(s)return;const{geometry:l,properties:a,id:y}=c;if(l&&r[l.type]!==i)continue;const p=a||{};u&&null!=y&&!p[u]&&(p[u]=y);const d=new e(l?f(new t,l,o):null,p);yield d}}(i(n),o))}export{P as b,b as h,w}