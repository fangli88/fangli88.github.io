import{D as t,E as s,K as e,aj as i,dp as n,dq as a,df as h}from"./p-ab028778.js";import{u as r}from"./p-73b795c3.js";import{d,C as o}from"./p-e07a8dfe.js";let l=class extends i{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new r,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(t,s,e,i=0){const n=0!=(1&i),a=++this.handleId;n||this.installSyncUpdatingWatch(t,s,a);const h=0!=(2&i)?d(t,s,e,n):t.watch(s,e,n);return this.handles.add(h,a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionPropertyChange(t,s,e,i=0){const n=0!=(2&i),a=++this.handleId;return this.handles.add([o(t,s,"after-changes",this.createSyncUpdatingCallback()),o(t,s,"change",e,n?t=>{e({added:t.items,removed:[],moved:[],target:t})}:void 0)],a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionChange(t,s,e=0){const i=0!=(2&e),n=++this.handleId;return this.handles.add([t.on("after-changes",this.createSyncUpdatingCallback()),t.on("change",s)],n),i&&s({added:t.items,removed:[],moved:[],target:t}),{remove:()=>{this.handles.remove(n)}}}addPromise(t){if(!t)return t;const s=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(t)&&(0!==this.pendingPromises.size||this.handles.has(c)||this._set("updating",!1))}},s),this.pendingPromises.add(t),this._set("updating",!0);const e=()=>this.handles.remove(s);return t.then(e,e),t}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(t,s,e){const i=this.createSyncUpdatingCallback(),h=n((()=>a(t,s)),i);return this.handles.add(h,e),h}createSyncUpdatingCallback(){return()=>{this.handles.remove(c),++this.scheduleHandleId;const t=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(h((()=>{t===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(c))})),c)}}};t([s({readOnly:!0})],l.prototype,"updating",void 0),l=t([e("esri.views.support.WatchUpdatingTracking")],l);const c=-42,p=i=>{let n=class extends i{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new r}get updatingHandles(){return this._get("updatingHandles")||new l}};return t([s({readOnly:!0})],n.prototype,"handles",null),t([s({readOnly:!0})],n.prototype,"updatingHandles",null),n=t([e("esri.core.HandleOwner")],n),n};let u=class extends(p(i)){};u=t([e("esri.core.HandleOwner")],u);export{p as a,l as c,u as d}