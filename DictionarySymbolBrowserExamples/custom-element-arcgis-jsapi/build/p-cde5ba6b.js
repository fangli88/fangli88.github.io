import{D as e,E as t,z as s,F as r,K as n,y as a,bd as o,d as i,w as l,f as u}from"./p-dc4230e0.js";import p from"./p-b415e09b.js";let d=class extends p{constructor(e){super(e),this.extent=null,this.features=null,this.geometryType="polyline",this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(e,t){(e||[]).forEach((e=>{this._decompressFeatureGeometry(e,t.summary.envelope.spatialReference)}));const s=a.fromJSON(t.spatialReference);return e.map((e=>{const t=o.fromJSON(e);return t.geometry&&!(e.geometry&&e.geometry.spatialReference)&&(i(t.geometry).spatialReference=s),t.strings=e.strings,t.events=(e.events||[]).map((t=>{const s=new o({geometry:new l({x:t.point.x,y:t.point.y,z:t.point.z,hasZ:void 0!==t.point.z,spatialReference:e.geometry&&e.geometry.spatialReference}),attributes:{ETA:t.ETA,arriveTimeUTC:t.arriveTimeUTC}});return s.strings=t.strings,s})),t}))}get mergedGeometry(){if(!this.features)return null;const e=this.features.map((({geometry:e})=>i(e))),t=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(e,t)}get strings(){return this.features.map((({strings:e})=>e))}_decompressFeatureGeometry(e,t){e.geometry=this._decompressGeometry(e.compressedGeometry,t)}_decompressGeometry(e,t){let s=0,r=0,n=0,a=0;const o=[];let i,l,u,p,d,m,c,h,y=0,g=0,v=0;if(d=e.match(/((\+|\-)[^\+\-\|]+|\|)/g),d||(d=[]),0===parseInt(d[y],32)){y=2;const e=parseInt(d[y],32);y++,m=parseInt(d[y],32),y++,1&e&&(g=d.indexOf("|")+1,c=parseInt(d[g],32),g++),2&e&&(v=d.indexOf("|",g)+1,h=parseInt(d[v],32),v++)}else m=parseInt(d[y],32),y++;for(;y<d.length&&"|"!==d[y];){i=parseInt(d[y],32)+s,y++,s=i,l=parseInt(d[y],32)+r,y++,r=l;const e=[i/m,l/m];g&&(p=parseInt(d[g],32)+n,g++,n=p,e.push(p/c)),v&&(u=parseInt(d[v],32)+a,v++,a=u,e.push(u/h)),o.push(e)}return{paths:[o],hasZ:g>0,hasM:v>0,spatialReference:t}}_mergePolylinesToSinglePath(e,t){let s=[];(e||[]).forEach((e=>{e.paths.forEach((e=>{s=s.concat(e)}))}));const r=[];let n=[0,0];return s.forEach((e=>{e[0]===n[0]&&e[1]===n[1]||(r.push(e),n=e)})),new u({paths:[r]},t)}};e([t({type:s,json:{read:{source:"summary.envelope"}}})],d.prototype,"extent",void 0),e([t()],d.prototype,"features",void 0),e([r("features")],d.prototype,"readFeatures",null),e([t()],d.prototype,"geometryType",void 0),e([t({readOnly:!0,dependsOn:["features","extent.spatialReference"]})],d.prototype,"mergedGeometry",null),e([t()],d.prototype,"routeId",void 0),e([t()],d.prototype,"routeName",void 0),e([t({value:null,readOnly:!0,dependsOn:["features"]})],d.prototype,"strings",null),e([t({json:{read:{source:"summary.totalDriveTime"}}})],d.prototype,"totalDriveTime",void 0),e([t({json:{read:{source:"summary.totalLength"}}})],d.prototype,"totalLength",void 0),e([t({json:{read:{source:"summary.totalTime"}}})],d.prototype,"totalTime",void 0),d=e([n("esri.tasks.support.DirectionsFeatureSet")],d);var m=d;export{m as c}