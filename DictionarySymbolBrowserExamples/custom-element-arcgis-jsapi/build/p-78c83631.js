import{l as t,m as e,o as n,q as r,r as o,v as s}from"./p-dc4230e0.js";import{t as u,a as c,e as i}from"./p-ebb65ba7.js";function l(t,e){return t?e?4:3:e?3:2}const f=t.getLogger("esri.tasks.support.optimizedFeatureSet"),a={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},m=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s},y=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+2]},h=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+3]},d=(t,e,n,r,o,s)=>{t[n]=o,t[n+1]=s,t[n+2]=e[r+2],t[n+3]=e[r+3]};function g(t,e,n,r){if(t){if(n)return e&&r?d:y;if(e&&r)return h}else if(e&&r)return y;return m}function p({scale:t,translate:e},n){return Math.round((n-e[0])/t[0])}function w({scale:t,translate:e},n){return Math.round((e[1]-n)/t[1])}function b({scale:t,translate:e},n){return n*t[0]+e[0]}function G({scale:t,translate:e},n){return e[1]-n*t[1]}function M(t,e,n){return t?e?n?v(t):T(t):n?k(t):P(t):null}function P(t){const e=t.coords;return{x:e[0],y:e[1]}}function F(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function T(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function Z(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function k(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function N(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function v(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function j(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function x(t,e){return t&&e?j:t?Z:e?N:F}function I(t,e,n){if(!t)return null;const r=l(e,n),o=[];for(let e=0;e<t.coords.length;e+=r){const n=[];for(let o=0;o<r;o++)n.push(t.coords[e+o]);o.push(n)}return e?n?{points:o,hasZ:e,hasM:n}:{points:o,hasZ:e}:n?{points:o,hasM:n}:{points:o}}function q(t,e,n=l(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const r=t.coords;let o=0;for(const t of e.points)for(let e=0;e<n;e++)r[o++]=t[e];return t}function z(t,e,n){if(!t)return null;const r=l(e,n),{coords:o,lengths:s}=t,u=[];let c=0;for(const t of s){const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push(o[c++]);e.push(t)}u.push(e)}return e?n?{paths:u,hasZ:e,hasM:n}:{paths:u,hasZ:e}:n?{paths:u,hasM:n}:{paths:u}}function U(t,e,n=l(e.hasZ,e.hasM)){const{lengths:r,coords:o}=t;let s=0;for(const t of e.paths){for(const e of t)for(let t=0;t<n;t++)o[s++]=e[t];r.push(t.length)}return t}function $(t,e,n){if(!t)return null;const r=l(e,n),{coords:o,lengths:s}=t,u=[];let c=0;for(const t of s){const e=[];for(let n=0;n<t;n++){const t=[];for(let e=0;e<r;e++)t.push(o[c++]);e.push(t)}u.push(e)}return e?n?{rings:u,hasZ:e,hasM:n}:{rings:u,hasZ:e}:n?{rings:u,hasM:n}:{rings:u}}function R(t,e,n=e.hasZ,r=e.hasM){return function(t,e,n,r){const o=l(n,r),{lengths:s,coords:u}=t;let c=0;s.length=u.length=0;for(const t of e){for(const e of t)for(let t=0;t<o;t++)u[c++]=e[t];s.push(t.length)}}(t,e.rings,n,r),t}const S=[],L=[];function A(t,e,n,r,o){S[0]=t;const[s]=B(L,S,e,n,r,o);return S.length=L.length=0,s}function B(t,n,r,o,s,i){if(t.length=0,!r){for(const e of n)t.push(new u(null,e.attributes,null,e.attributes[i]));return t}switch(r){case"esriGeometryPoint":return function(t,e,n,r,o){const s=x(n,r);for(const n of e){const{geometry:e,attributes:r}=n;let i;e&&(i=s(new c,e)),t.push(new u(i,r,null,r[o]))}return t}(t,n,o,s,i);case"esriGeometryMultipoint":return function(t,e,n,r,o){const s=l(n,r);for(const n of e){const e=n.geometry,r=n.attributes;let i;e&&(i=q(new c,e,s)),t.push(new u(i,r,null,r[o]))}return t}(t,n,o,s,i);case"esriGeometryPolyline":return function(t,e,n,r,o){const s=l(n,r);for(const n of e){const e=n.geometry,r=n.attributes;let i;e&&(i=U(new c,e,s)),t.push(new u(i,r,null,r[o]))}return t}(t,n,o,s,i);case"esriGeometryPolygon":return function(t,e,n,r,o){for(const s of e){const e=s.geometry,i=s.centroid,l=s.attributes;let f;e&&(f=R(new c,e,n,r)),t.push(new u(f,l,i?F(new c,i):null,l[o]))}return t}(t,n,o,s,i);default:f.error("convertToFeatureSet:unknown-geometry",new e(`Unable to parse unknown geometry type '${r}'`)),t.length=0}return t}function C(t,e,n,r){L[0]=t,H(S,L,e,n,r);const o=S[0];return S.length=L.length=0,o}function D(t,u,i){if(!t)return null;const a=new c;return"hasZ"in t&&null==u&&(u=t.hasZ),"hasM"in t&&null==i&&(i=t.hasM),n(t)?x(null!=u?u:null!=t.z,null!=i?i:null!=t.m)(a,t):r(t)?R(a,t,u,i):o(t)?U(a,t,l(u,i)):s(t)?q(a,t,l(u,i)):void f.error("convertFromGeometry:unknown-geometry",new e(`Unable to parse unknown geometry type '${t}'`))}function E(t,n,r,o){const s=t&&("coords"in t?t:t.geometry);if(!s)return null;switch(n){case"esriGeometryPoint":{let t=P;return r&&o?t=v:r?t=T:o&&(t=k),t(s)}case"esriGeometryMultipoint":return I(s,r,o);case"esriGeometryPolyline":return z(s,r,o);case"esriGeometryPolygon":return $(s,r,o);default:return void f.error("convertToGeometry:unknown-geometry",new e(`Unable to parse unknown geometry type '${n}'`))}}function H(t,n,r,o,s){switch(t.length=0,r){case"esriGeometryPoint":return function(t,e,n,r){let o=P;n&&r?o=v:n?o=T:r&&(o=k);for(const n of e){const{geometry:e,attributes:r}=n,s=e?o(e):null;t.push({attributes:r,geometry:s})}return t}(t,n,o,s);case"esriGeometryMultipoint":return function(t,e,n,r){for(const o of e){const{geometry:e,attributes:s}=o;let u;e&&(u=I(e,n,r)),t.push({attributes:s,geometry:u})}return t}(t,n,o,s);case"esriGeometryPolyline":return function(t,e,n,r){for(const o of e){const{geometry:e,attributes:s}=o;let u;e&&(u=z(e,n,r)),t.push({attributes:s,geometry:u})}return t}(t,n,o,s);case"esriGeometryPolygon":return function(t,e,n,r){for(const o of e){const{geometry:e,attributes:s,centroid:u}=o;let c;if(e&&(c=$(e,n,r)),u){const e=P(u);t.push({attributes:s,centroid:e,geometry:c})}else t.push({attributes:s,geometry:c})}return t}(t,n,o,s);default:f.error("convertToFeatureSet:unknown-geometry",new e(`Unable to parse unknown geometry type '${r}'`))}return t}function J(t){const{objectIdFieldName:e,spatialReference:n,transform:r,fields:o,hasM:s,hasZ:u,features:c,geometryType:i,exceededTransferLimit:l,uniqueIdField:f,queryGeometry:a,queryGeometryType:m}=t,y={features:H([],c,i,u,s),fields:o,geometryType:i,objectIdFieldName:e,spatialReference:n,uniqueIdField:f,queryGeometry:E(a,m,!1,!1)};return r&&(y.transform=r),l&&(y.exceededTransferLimit=l),s&&(y.hasM=s),u&&(y.hasZ=u),y}function K(t,n){const r=new i,{hasM:o,hasZ:s,features:u,objectIdFieldName:c,spatialReference:l,geometryType:a,exceededTransferLimit:m,transform:y,fields:h}=t;return h&&(r.fields=h),r.geometryType=a,r.objectIdFieldName=c||n,r.spatialReference=l,r.objectIdFieldName?(u&&B(r.features,u,a,s,o,r.objectIdFieldName),m&&(r.exceededTransferLimit=m),o&&(r.hasM=o),s&&(r.hasZ=s),y&&(r.transform=y),r):(f.error(new e("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function O(t,e){const{geometryType:n,features:r,hasM:o,hasZ:s}=e;if(!t)return e;for(let e=0;e<r.length;e++){const u=r[e],i=u.weakClone();i.geometry=new c,Q(i.geometry,u.geometry,o,s,n,t),u.centroid&&(i.centroid=new c,Q(i.centroid,u.centroid,o,s,"esriGeometryPoint",t)),r[e]=i}return e.transform=t,e}function Q(t,e,n,r,o,s,u=n,c=r){if(t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0),!e||!e.coords.length)return null;const i=a[o],{coords:f,lengths:m}=e,y=l(n,r),h=l(n&&u,r&&c),d=g(n,r,u,c);if(!m.length)return d(t.coords,f,0,0,p(s,f[0]),w(s,f[1])),t.lengths.length&&(t.lengths.length=0),t.coords.length=y,t;let b,G,M,P,F=0,T=0,Z=T;for(const e of m){if(e<i)continue;let n=0;T=Z,M=b=p(s,f[F]),P=G=w(s,f[F+1]),d(t.coords,f,T,F,M,P),n++,F+=y,T+=h;for(let r=1;r<e;r++,F+=y)M=p(s,f[F]),P=w(s,f[F+1]),M===b&&P===G||(d(t.coords,f,T,F,M-b,P-G),T+=h,n++,b=M,G=P);n>=i&&(t.lengths.push(n),Z=T)}return t.coords.length=Z,t.coords.length?t:null}function V(t,e,n,r,o,s,u=n,c=r){if(t.lengths.length&&(t.lengths.length=0),t.coords.length&&(t.coords.length=0),!e||!e.coords.length)return null;const i=a[o],{coords:f,lengths:m}=e,y=l(n,r),h=l(n&&u,r&&c),d=g(n,r,u,c);if(!m.length)return d(t.coords,f,0,0,f[0],f[1]),t.lengths.length&&(t.lengths.length=0),t.coords.length=y,t;let p=0;const w=s*s;for(const e of m){if(e<i){p+=e*y;continue}const n=t.coords.length/h,r=p,o=p+(e-1)*y;d(t.coords,f,t.coords.length,r,f[r],f[r+1]),X(t.coords,f,y,w,d,r,o),d(t.coords,f,t.coords.length,o,f[o],f[o+1]);const s=t.coords.length/h-n;s>=i?t.lengths.push(s):t.coords.length=n*h,p+=e*y}return t.coords.length?t:null}function W(t,e,n,r){const o=t[e],s=t[e+1],u=t[r],c=t[r+1];let i=t[n],l=t[n+1],f=u-i,a=c-l;if(0!==f||0!==a){const t=((o-i)*f+(s-l)*a)/(f*f+a*a);t>1?(i=u,l=c):t>0&&(i+=f*t,l+=a*t)}return f=o-i,a=s-l,f*f+a*a}function X(t,e,n,r,o,s,u){let c,i=r,l=0;for(let t=s+n;t<u;t+=n)c=W(e,t,s,u),c>i&&(l=t,i=c);i>r&&(l-s>n&&X(t,e,n,r,o,s,l),o(t,e,t.length,l,e[l],e[l+1]),u-l>n&&X(t,e,n,r,o,l,u))}function Y(t,e,n,r){if(!e||!e.coords||!e.coords.length)return null;const o=l(n,r);let s=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY;if(e&&e.coords){const t=e.coords;for(let e=0;e<t.length;e+=o){const n=t[e],r=t[e+1];s=Math.min(s,n),c=Math.max(c,n),u=Math.min(u,r),i=Math.max(i,r)}}return t[0]=s,t[1]=u,t[2]=c,t[3]=i,t}function _(t,e,n,r,o){const{coords:s,lengths:u}=e,c=n?r?d:y:r?y:m,i=l(n,r);if(!s.length)return t!==e&&(t.lengths.length=0,t.coords.length=0),t;if(!u.length)return c(t.coords,s,0,0,b(o,s[0]),G(o,s[1])),t!==e&&(t.lengths.length=0,t.coords.length=i),t;const[f,a]=o.scale;let h=0;for(let e=0;e<u.length;e++){const n=u[e];t.lengths[e]=n;let r=b(o,s[h]),l=G(o,s[h+1]);c(t.coords,s,h,h,r,l),h+=i;for(let e=1;e<n;e++,h+=i)r+=s[h]*f,l-=s[h+1]*a,c(t.coords,s,h,h,r,l)}return t!==e&&(t.lengths.length=u.length,t.coords.length=s.length),t}function tt(t,e,n,r,o,s){const u=l(n,r),c=g(n,r,o,s),i=e.coords;t.coords.length=0,t.lengths.length=0,t.lengths.push(...e.lengths);for(let e=0;e<i.length;e+=u)c(t.coords,i,t.coords.length,e,i[e],i[e+1]);return t}function et(t,e,n,r){let o=0,s=t[r*e],u=t[r*(e+1)];for(let c=1;c<n;c++){const n=s+t[r*(e+c)],i=u+t[r*(e+c)+1],l=(n-s)*(i+u);s=n,u=i,o+=l}return.5*o}function nt(t,e){const{coords:n,lengths:r}=t;let o=0,s=0;for(let t=0;t<r.length;t++)s+=et(n,o,r[t],e),o+=t;return Math.abs(s)}function rt(t,e){const n=t.clone(),r=t.coords,o=t.lengths;let s=0;for(let t=0;t<o.length;t++){const u=o[t];let c=r[e*s],i=r[e*s+1];for(let t=1;t<u;t++){const o=c+r[e*(s+t)],u=i+r[e*(s+t)+1];n.coords[e*(s+t)]=o,n.coords[e*(s+t)+1]=u,c=o,i=u}s+=u}return n}export{A as B,B as D,w as I,C as J,D as K,$ as L,E as Q,J as X,z as _,K as e,tt as f,nt as g,_ as i,Y as l,rt as m,O as n,Q as o,p,R as q,V as r,I as v,M as w}