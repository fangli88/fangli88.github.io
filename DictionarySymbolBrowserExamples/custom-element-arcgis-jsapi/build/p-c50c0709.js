import"./p-476cf7c4.js";import{D as e,E as r,aI as t,K as s,L as i,F as o,U as a,Z as n}from"./p-ab028778.js";import"./p-2ef6e039.js";import"./p-7575e94f.js";import{P as l}from"./p-c6c7c9c2.js";import{i as u}from"./p-77b9029e.js";import{c as p,n as c,e as m}from"./p-201a5204.js";import d from"./p-f16fbea1.js";import{c as f}from"./p-2710de6b.js";import"./p-35f05b11.js";let h=class extends i{constructor(e){super(e),this.directions=null,this.route=null,this.routeName=null,this.stops=null}};e([r({type:f,json:{write:!0}})],h.prototype,"directions",void 0),e([r({type:t,json:{write:!0}})],h.prototype,"route",void 0),e([r({type:String,json:{write:!0}})],h.prototype,"routeName",void 0),e([r({type:[t],json:{write:!0}})],h.prototype,"stops",void 0),h=e([s("esri.tasks.support.RouteResult")],h);var y=h;function B(e){return e&&d.fromJSON(e).features.map((e=>e))}let b=class extends i{constructor(e){super(e),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,r){return B(r.barriers||r.pointBarriers)}readPolylineBarriers(e){return B(e)}readPolygonBarriers(e){return B(e)}};e([r({aliasOf:"pointBarriers"})],b.prototype,"barriers",void 0),e([r({type:[p]})],b.prototype,"messages",void 0),e([r({type:[t]})],b.prototype,"pointBarriers",void 0),e([o("pointBarriers",["barriers","pointBarriers"])],b.prototype,"readPointBarriers",null),e([r({type:[t]})],b.prototype,"polylineBarriers",void 0),e([o("polylineBarriers")],b.prototype,"readPolylineBarriers",null),e([r({type:[t]})],b.prototype,"polygonBarriers",void 0),e([o("polygonBarriers")],b.prototype,"readPolygonBarriers",null),e([r({type:[y]})],b.prototype,"routeResults",void 0),b=e([s("esri.tasks.support.RouteResultsContainer")],b);var v=b;const j=m({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});let R=class extends(c(u)){constructor(e){super(e)}solve(e,r){const t=[],s=[],i={},o={};return e.stops&&e.stops.features&&this._collectGeometries(e.stops.features,s,"stops.features",i),e.pointBarriers&&e.pointBarriers.features&&this._collectGeometries(e.pointBarriers.features,s,"pointBarriers.features",i),e.polylineBarriers&&e.polylineBarriers.features&&this._collectGeometries(e.polylineBarriers.features,s,"polylineBarriers.features",i),e.polygonBarriers&&e.polygonBarriers.features&&this._collectGeometries(e.polygonBarriers.features,s,"polygonBarriers.features",i),l(s).then((e=>{for(const r in i){const s=i[r];t.push(r),o[r]=e.slice(s[0],s[1])}return this._isInputGeometryZAware(o,t)?this.getServiceDescription():a({dontCheck:!0})})).then((s=>{("dontCheck"in s?s.dontCheck:s.hasZ)||this._dropZValuesOffInputGeometry(o,t);for(const r in o)o[r].forEach(((t,s)=>{e.get(r)[s].geometry=t}));let i={query:{...this.parsedUrl.query,f:"json",...j.toQueryParams(e)}};(this.requestOptions||r)&&(i={...this.requestOptions,...r,...i});const{path:a}=this.parsedUrl,l="/solve",u=a.endsWith(l)?a:a+l;return n(u,i)})).then((e=>this._handleSolveResponse(e)))}_collectGeometries(e,r,t,s){s[t]=[r.length,r.length+e.length],e.forEach((e=>{r.push(e.geometry)}))}_handleSolveResponse(e){const r=[],t=[],{directions:s=[],routes:{features:i=[],spatialReference:o=null}={},stops:{features:a=[],spatialReference:n=null}={},barriers:l,polygonBarriers:u,polylineBarriers:p,messages:c}=e.data,m="esri.tasks.RouteTask.NULL_ROUTE_NAME";let d,f,h=!0;const y=i&&o||a&&n||l&&l.spatialReference||u&&u.spatialReference||p&&p.spatialReference;s.forEach((e=>{r.push(d=e.routeName),t[d]={directions:e}})),i.forEach((e=>{-1===r.indexOf(d=e.attributes.Name)&&(r.push(d),t[d]={}),e.geometry&&(e.geometry.spatialReference=y),t[d].route=e})),a.forEach((e=>{f=e.attributes,-1===r.indexOf(d=f.RouteName||m)&&(r.push(d),t[d]={}),d!==m&&(h=!1),e.geometry&&(e.geometry.spatialReference=y),null==t[d].stops&&(t[d].stops=[]),t[d].stops.push(e)})),a.length>0&&!0===h&&(t[r[0]].stops=t[m].stops,delete t[m],r.splice(r.indexOf(m),1));const B=r.map((e=>(t[e].routeName=e===m?null:e,t[e])));return v.fromJSON({routeResults:B,pointBarriers:l,polygonBarriers:u,polylineBarriers:p,messages:c})}};R=e([s("esri.tasks.RouteTask")],R);var g=R;export default g;