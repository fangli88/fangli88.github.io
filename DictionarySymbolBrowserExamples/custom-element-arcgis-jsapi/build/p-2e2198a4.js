import"./p-476cf7c4.js";import{aa as a,O as e,m as l,ab as t,Q as n,U as s,N as c,ac as o}from"./p-dc4230e0.js";import"./p-a8d014d4.js";import"./p-8493f348.js";import{t as u,h as m,l as r}from"./p-e8a12b65.js";import"./p-eb53cb9f.js";import"./p-dfd483d8.js";const i=document.createElement("canvas");function p(p,d){const h=null!=(null==d?void 0:d.size)?c(d.size):null,v=null!=(null==d?void 0:d.maxSize)?c(d.maxSize):null,f=null!=(null==d?void 0:d.opacity)?d.opacity:null,y=null!=(null==d?void 0:d.rotation)?d.rotation:null,M=a(p),b={shape:null,fill:null,stroke:M,offset:[0,0]};null!=M&&M.width&&(M.width=Math.min(M.width,80));const k=(null==M?void 0:M.width)||0;let L=null!=h&&(null==(null==d?void 0:d.scale)||(null==d?void 0:d.scale)),w=0,x=0;switch(p.type){case"simple-marker":{const a=p.style,e=Math.min(null!=h?h:c(p.size),v||120);switch(w=e,x=e,a){case"circle":b.shape={type:"circle",cx:0,cy:0,r:.5*e},L||(w+=k,x+=k);break;case"cross":b.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[w,.5*x]},{command:"M",values:[.5*w,0]},{command:"L",values:[.5*w,x]}]};break;case"diamond":b.shape={type:"path",path:[{command:"M",values:[0,.5*x]},{command:"L",values:[.5*w,0]},{command:"L",values:[w,.5*x]},{command:"L",values:[.5*w,x]},{command:"Z",values:[]}]},L||(w+=k,x+=k);break;case"square":b.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[w,0]},{command:"L",values:[w,x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]},L||(w+=k,x+=k);break;case"triangle":b.shape={type:"path",path:[{command:"M",values:[.5*w,0]},{command:"L",values:[w,x]},{command:"L",values:[0,x]},{command:"Z",values:[]}]},L||(w+=k,x+=k);break;case"x":b.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[w,x]},{command:"M",values:[w,0]},{command:"L",values:[0,x]}]};break;case"path":b.shape={type:"path",path:p.path||""},L||(w+=k,x+=k),L=!0}break}case"simple-line":{const a=Math.min(null!=h?h:k,v||80),e=a>22?2*a:40;M.width=a,w=e,x=a,b.shape={type:"path",path:[{command:"M",values:[0,x]},{command:"L",values:[w,x]}]};break}case"picture-fill":case"simple-fill":w=Math.min(null!=h?h:22,v||120)+k,x=w,L=!0,b.shape="object"==typeof(null==d?void 0:d.symbolConfig)&&null!=d&&d.symbolConfig.isSquareFill?u.squareFill[0]:u.fill[0];break;case"picture-marker":{let a=c(p.width),e=c(p.height);const l=Math.max(a,e),t=a/e;a=t<=1?Math.ceil(l*t):l,e=t<=1?l:Math.ceil(l/t),w=Math.min(null!=h?h:a,v||120),x=Math.min(null!=h?h:e,v||120),b.shape={type:"image",x:-Math.round(w/2),y:-Math.round(x/2),width:w,height:x,src:p.url||""};break}case"text":{const a=p,e=a.text||"Aa",l=a.font,t=Math.min(null!=h?h:c(l.size),v||120),n=function(a,e){const l=i.getContext("2d"),t=[];return e&&(e.weight&&t.push(e.weight),e.size&&t.push(e.size+"px"),e.family&&t.push(e.family)),l.font=t.join(" "),l.measureText(a).width}(e,{weight:l.weight,size:t,family:l.family}),s=/[\uE600-\uE6FF]/.test(e);w=s?t:n,x=t;let u=.25*function(a){if(0===a.length)return 0;if(a.length>2){const e=o(1),l=parseFloat(a);switch(a.slice(-2)){case"px":return l;case"pt":return l*e;case"in":return 72*l*e;case"pc":return 12*l*e;case"mm":return 2.8346456692913384*l*e;case"cm":return 28.346456692913385*l*e}}return parseFloat(a)}((l?t:0).toString());s&&(u+=5),b.shape={type:"text",text:e,x:0,y:u,align:"middle",decoration:l&&l.decoration,rotated:a.rotated,kerning:a.kerning},b.font=l&&{size:t,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}if(!b.shape)return e(new l("symbolPreview: renderPreviewHTML2D","symbol not supported."));const j=t(p),g=j,F=p.color;let Z=null;return g&&"pattern"===g.type&&F&&"picture-fill"!==p.type?Z=n(g.src,F.toCss(!0)).then((a=>(g.src=a,b.fill=g,b))):(b.fill=j,Z=s(b)),Z.then((a=>{const e=[[a]];if("object"==typeof(null==d?void 0:d.symbolConfig)&&null!=d&&d.symbolConfig.applyColorModulation){const l=.6*w;e.unshift([{...a,offset:[-l,0],fill:m(j,-.3)}]),e.push([{...a,offset:[l,0],fill:m(j,.3)}]),w+=2*l}return r(e,[w,x],{node:d&&d.node,scale:L,opacity:f,rotation:y})}))}export{p as previewSymbol2D}