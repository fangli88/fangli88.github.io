import{b as t,U as e,M as n,bI as r,al as u,a3 as o}from"./p-dc4230e0.js";import{P as s}from"./p-00eed204.js";import{t as c}from"./p-b3fbb570.js";import{t as l}from"./p-0e87baef.js";function a(t){const e={};for(const n in t){if("declaredClass"===n)continue;const r=t[n];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){e[n]=[];for(let t=0;t<r.length;t++)e[n][t]=a(r[t])}else"object"==typeof r?r.toJSON&&(e[n]=JSON.stringify(r)):e[n]=r}return e}function f(e,n){const r=e.geometry,o=e.toJSON(),s=o;if(t(r)&&(s.geometry=JSON.stringify(r),s.geometryType=u(r),s.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),o.groupByFieldsForStatistics&&(s.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(",")),o.objectIds&&(s.objectIds=o.objectIds.join(",")),o.orderByFields&&(s.orderByFields=o.orderByFields.join(",")),!o.outFields||!o.returnDistinctValues&&(null!=n&&n.returnCountOnly||null!=n&&n.returnExtentOnly||null!=n&&n.returnIdsOnly)?delete s.outFields:s.outFields=-1!==o.outFields.indexOf("*")?"*":o.outFields.join(","),o.outSR?s.outSR=o.outSR.wkid||JSON.stringify(o.outSR):r&&(o.returnGeometry||o.returnCentroid)&&(s.outSR=s.inSR),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(s.outStatistics=JSON.stringify(o.outStatistics)),o.pixelSize&&(s.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(s.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(s.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(s.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(s.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const t=o.timeExtent,{start:e,end:n}=t;null==e&&null==n||(s.time=e===n?e:`${null==e?"null":e},${null==n?"null":n}`),delete o.timeExtent}return s}async function i(e,n,r,u){const o=t(n.timeExtent)&&n.timeExtent.isEmpty?{data:{features:[]}}:await b(e,n,"json",u);return c(n,r,o.data),o}async function y(n,r,u,o){if(t(r.timeExtent)&&r.timeExtent.isEmpty)return e({data:u.createFeatureResult()});const s=await d(n,r,o),c=s;return c.data=l(s.data,u),c}function d(t,e,n){return b(t,e,"pbf",n)}function p(n,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?e({data:{objectIds:[]}}):b(n,r,"json",u,{returnIdsOnly:!0})}function O(n,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?e({data:{count:0}}):b(n,r,"json",u,{returnIdsOnly:!0,returnCountOnly:!0})}function x(n,r,u){return t(r.timeExtent)&&r.timeExtent.isEmpty?e({data:{count:0,extent:null}}):b(n,r,"json",u,{returnExtentOnly:!0,returnCountOnly:!0}).then((t=>{const e=t.data;if(e.hasOwnProperty("extent"))return t;if(e.features)throw new Error("Layer does not support extent calculation.");if(e.hasOwnProperty("count"))throw new Error("Layer does not support extent calculation.");return t}))}function b(e,u,c,l={},i){const y="string"==typeof e?o(e):e,d=u.geometry?[u.geometry]:[];return l.responseType="pbf"===c?"array-buffer":"json",s(d,null,l).then((e=>{const o=e&&e[0];t(o)&&((u=u.clone()).geometry=o);const s=a({...y.query,f:c,...i,...f(u,i)});return n(r(y.path,"query"),{...l,query:{...s,...l.query}})}))}const j=Object.freeze({__proto__:null,executeQuery:i,executeQueryForCount:O,executeQueryForExtent:x,executeQueryForIds:p,executeQueryPBF:y,executeQueryPBFBuffer:d,queryToQueryStringParameters:f,runQuery:b});export{x as S,y as c,d,O as f,p,j as q,a as t,i as y}