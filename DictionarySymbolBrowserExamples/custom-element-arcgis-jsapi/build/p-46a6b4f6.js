import"./p-476cf7c4.js";import{k as e,M as t,_ as n,$ as s,a0 as r,m as o,O as l,a1 as a,a2 as i,a3 as u,a4 as m,a5 as y,a6 as c,a7 as f}from"./p-dc4230e0.js";import{a as b,t as p}from"./p-0a74e573.js";const d=()=>!!e("enable-feature:force-wosr"),S={};function w(e,t,n){return e.styleUrl?function(e,t){return j(e,t).then((t=>({data:t.data,baseUrl:s(e),styleUrl:e})))}(e.styleUrl,n):e.styleName?function(e,t,n){const s=t.portal||a.getDefault();let l;const i=`${s.url} - ${s.user&&s.user.username} - ${e}`;return S[i]||(S[i]=function(e,t,n){return t.load(n).then((()=>{const s=new r({disableExtraQuery:!0,query:`owner:${E} AND type:${U} AND typekeywords:"${e}"`});return t.queryItems(s,n)})).then((({results:t})=>{let s=null;const r=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t)if(e.typeKeywords.some((e=>e.toLowerCase()===r))&&e.type===U&&e.owner===E){s=e;break}if(!s)throw new o("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(n)}))}(e,s,n).then((e=>(l=e,e.fetchData()))).then((t=>({data:t,baseUrl:l.itemUrl,styleName:e})))),S[i]}(e.styleName,t,n):l(new o("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function g(e,t,n,r){return e.name?e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,n){const r=M.replace(/\{SymbolName\}/gi,e.name);return j(r,n).then((e=>{const n=N(e.data);return i(n,{portal:t.portal,url:u(s(r)),origin:"portal-item"})}))}(e,t,r):w(e,t,r).then((s=>$(s,e.name,t,n,r))):l(new o("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))}function $(e,t,n,r,a){const S=e.data,w={portal:n.portal,url:u(e.baseUrl),origin:"portal-item"},g=S.items.find((e=>e.name===t));if(!g)return l(new o("symbolstyleutils:symbol-name-not-found",`The symbol name '${t}' could not be found`,{symbolName:t}));let $=m(function(e,t){if("cimRef"===t)return e.cimRef;if(e.formatInfos&&!d())for(const t of e.formatInfos)if("gltf"===t.type)return t.href;return e.webRef}(g,r),w),h=g.thumbnail&&g.thumbnail.href;const E=g.thumbnail&&g.thumbnail.imageData;b()&&($=p($),h=p(h));const U={portal:n.portal,url:u(s($)),origin:"portal-item"};return j($,a).then((s=>{const o="cimRef"===r?N(s.data):s.data,l=i(o,U);if(l&&y(l)){if(h){const e=m(h,w);l.thumbnail=new c({url:e})}else E&&(l.thumbnail=new c({url:`data:image/png;base64,${E}`}));e.styleUrl?l.styleOrigin=new f({portal:n.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(l.styleOrigin=new f({portal:n.portal,styleName:e.styleName,name:t}))}return l}))}function N(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}}function h(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/.test(t)&&"Esri Style"!==t)return t}function j(e,s){const r={responseType:"json",query:{f:"json"},...s};return t(n(e),r)}const E="esri_en",U="Style",M="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json";export{w as fetchStyle,$ as fetchSymbolFromStyle,g as resolveWebStyleSymbol,h as styleNameFromItem}