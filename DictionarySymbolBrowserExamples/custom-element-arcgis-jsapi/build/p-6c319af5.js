import{D as t,E as s,K as e,aW as i,e0 as n,e1 as a,dU as h}from"./p-dc4230e0.js";import{u as r}from"./p-365c5902.js";import{d,C as o}from"./p-76e49c46.js";let c=class extends i{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new r,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(t,s,e,i=0){const n=0!=(1&i),a=++this.handleId;n||this.installSyncUpdatingWatch(t,s,a);const h=0!=(2&i)?d(t,s,e,n):t.watch(s,e,n);return this.handles.add(h,a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionPropertyChange(t,s,e,i=0){const n=0!=(2&i),a=++this.handleId;return this.handles.add([o(t,s,"after-changes",this.createSyncUpdatingCallback()),o(t,s,"change",e,n?t=>{e({added:t.items,removed:[],moved:[],target:t})}:void 0)],a),{remove:()=>{this.handles.remove(a)}}}addOnCollectionChange(t,s,e=0){const i=0!=(2&e),n=++this.handleId;return this.handles.add([t.on("after-changes",this.createSyncUpdatingCallback()),t.on("change",s)],n),i&&s({added:t.items,removed:[],moved:[],target:t}),{remove:()=>{this.handles.remove(n)}}}addPromise(t){if(!t)return t;const s=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(t)&&(0!==this.pendingPromises.size||this.handles.has(l)||this._set("updating",!1))}},s),this.pendingPromises.add(t),this._set("updating",!0);const e=()=>this.handles.remove(s);return t.then(e,e),t}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}installSyncUpdatingWatch(t,s,e){const i=this.createSyncUpdatingCallback(),h=n((()=>a(t,s)),i);return this.handles.add(h,e),h}createSyncUpdatingCallback(){return()=>{this.handles.remove(l),++this.scheduleHandleId;const t=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add(h((()=>{t===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(l))})),l)}}};t([s({readOnly:!0})],c.prototype,"updating",void 0),c=t([e("esri.views.support.WatchUpdatingTracking")],c);const l=-42,u=i=>{let n=class extends i{destroy(){this.destroyed||(this.handles.destroy(),this.updatingHandles.destroy())}get handles(){return this._get("handles")||new r}get updatingHandles(){return this._get("updatingHandles")||new c}};return t([s({readOnly:!0})],n.prototype,"handles",null),t([s({readOnly:!0})],n.prototype,"updatingHandles",null),n=t([e("esri.core.HandleOwner")],n),n};let g=class extends(u(i)){};g=t([e("esri.core.HandleOwner")],g);export{u as a,c,g as d}