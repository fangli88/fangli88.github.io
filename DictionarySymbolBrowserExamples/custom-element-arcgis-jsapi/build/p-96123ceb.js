import"./p-476cf7c4.js";import{t as e,m as r,M as n,b as a}from"./p-dc4230e0.js";import{p as t}from"./p-6a7ee25c.js";import{a as l}from"./p-d5aab914.js";async function s(n){const s=await async function(n){const a=t(n);if(e(a))throw new r("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:n});const{serverType:s,sublayer:u}=a;let c;const y={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"};switch(s){case"MapServer":c=null!=u?"FeatureLayer":async function(e){return(await o(e)).tileInfo}(n).then((e=>e?"TileLayer":"MapImageLayer"));break;case"ImageServer":c=o(n).then((e=>{const r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?!r||"LERC"!==r.toUpperCase()||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"}));break;case"SceneServer":c=o(a.url.path).then((e=>{const r={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};if(e&&Array.isArray(e.layers)&&e.layers.length>0){const n=e.layers[0].layerType;if(null!=r[n])return r[n]}return"SceneLayer"}));break;default:c=y[s]}const f="FeatureServer"===s,d={parsedUrl:a,Constructor:null,layerOrTableId:f?u:null,sublayerIds:null,tableIds:null},v=await c;if({FeatureLayer:!0,SceneLayer:!0}[v]&&null==u){const e=await async function(e,r){var n,a;let t,l=!1;if("FeatureServer"===r){const r=await async function(e){var r,n;let a=await o(e);a=a||{},a.layers=(null==(r=a.layers)?void 0:r.filter(i))||[];const t={serviceJSON:a};if(a.currentVersion<10.5)return t;const l=await o(e+"/layers");return t.layersJSON={layers:(null==l||null==(n=l.layers)?void 0:n.filter(i))||[],tables:(null==l?void 0:l.tables)||[]},t}(e);l=!!r.layersJSON,t=r.layersJSON||r.serviceJSON}else t=await o(e);const s=null==(n=t)?void 0:n.layers,u=null==(a=t)?void 0:a.tables;return{layerIds:(null==s?void 0:s.map((e=>e.id)).reverse())||[],tableIds:(null==u?void 0:u.map((e=>e.id)).reverse())||[],layerInfos:l?s:[],tableInfos:l?u:[]}}(n,s);if(f&&(d.sublayerInfos=e.layerInfos,d.tableInfos=e.tableInfos),1!==e.layerIds.length+e.tableIds.length)d.sublayerIds=e.layerIds,d.tableIds=e.tableIds;else if(f){var m,L;d.layerOrTableId=null!=(m=e.layerIds[0])?m:e.tableIds[0],d.sourceJSON=null!=(L=e.layerInfos[0])?L:e.tableInfos[0]}}return d.Constructor=await async function(e){return(0,l[e])()}(v),d}(n.url),c={...n.properties,url:n.url};if(!s.sublayerIds)return null!=s.layerOrTableId&&(c.layerId=s.layerOrTableId,c.sourceJSON=s.sourceJSON),new s.Constructor(c);const y=new((await import("./p-ed238668.js")).default)({title:s.parsedUrl.title});return function(e,r,n){function t(e,t){const l={...n,layerId:e,sublayerTitleMode:"service-name"};return a(t)&&(l.sourceJSON=t),new r.Constructor(l)}r.sublayerIds.forEach((n=>{const a=t(n,u(r.sublayerInfos,n));e.add(a)})),r.tableIds.forEach((n=>{const a=t(n,u(r.tableInfos,n));e.tables.add(a)}))}(y,s,c),y}function u(e,r){return e?e.find((e=>e.id===r)):null}function i(e){return!e.type||"Feature Layer"===e.type}async function o(e){return(await n(e,{responseType:"json",query:{f:"json"}})).data}export{s as fromUrl}