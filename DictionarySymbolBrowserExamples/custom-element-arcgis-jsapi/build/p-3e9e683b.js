import"./p-476cf7c4.js";import{D as e,E as r,bd as t,K as s,L as i,F as o,U as a,M as n}from"./p-dc4230e0.js";import"./p-643e1e47.js";import"./p-66f366a9.js";import{P as l}from"./p-00eed204.js";import{i as u}from"./p-505542c8.js";import{c as p,n as c,e as d}from"./p-5d37d30d.js";import m from"./p-b415e09b.js";import{c as h}from"./p-cde5ba6b.js";import"./p-c0562a15.js";let y=class extends i{constructor(e){super(e),this.directions=null,this.route=null,this.routeName=null,this.stops=null}};e([r({type:h,json:{write:!0}})],y.prototype,"directions",void 0),e([r({type:t,json:{write:!0}})],y.prototype,"route",void 0),e([r({type:String,json:{write:!0}})],y.prototype,"routeName",void 0),e([r({type:[t],json:{write:!0}})],y.prototype,"stops",void 0),y=e([s("esri.tasks.support.RouteResult")],y);var B=y;function f(e){return e&&m.fromJSON(e).features.map((e=>e))}let b=class extends i{constructor(e){super(e),this.barriers=null,this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(e,r){return f(r.barriers||r.pointBarriers)}readPolylineBarriers(e){return f(e)}readPolygonBarriers(e){return f(e)}};e([r({aliasOf:"pointBarriers"})],b.prototype,"barriers",void 0),e([r({type:[p]})],b.prototype,"messages",void 0),e([r({type:[t]})],b.prototype,"pointBarriers",void 0),e([o("pointBarriers",["barriers","pointBarriers"])],b.prototype,"readPointBarriers",null),e([r({type:[t]})],b.prototype,"polylineBarriers",void 0),e([o("polylineBarriers")],b.prototype,"readPolylineBarriers",null),e([r({type:[t]})],b.prototype,"polygonBarriers",void 0),e([o("polygonBarriers")],b.prototype,"readPolygonBarriers",null),e([r({type:[B]})],b.prototype,"routeResults",void 0),b=e([s("esri.tasks.support.RouteResultsContainer")],b);var v=b;const j=d({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,directionsTimeAttribute:{name:"directionsTimeAttributeName"},impedanceAttribute:{name:"impedanceAttributeName"},outSpatialReference:{name:"outSR",getter:e=>e.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},stops:!0,travelMode:!0});let R=class extends(c(u)){constructor(e){super(e)}solve(e,r){const t=[],s=[],i={},o={};return e.stops&&e.stops.features&&this._collectGeometries(e.stops.features,s,"stops.features",i),e.pointBarriers&&e.pointBarriers.features&&this._collectGeometries(e.pointBarriers.features,s,"pointBarriers.features",i),e.polylineBarriers&&e.polylineBarriers.features&&this._collectGeometries(e.polylineBarriers.features,s,"polylineBarriers.features",i),e.polygonBarriers&&e.polygonBarriers.features&&this._collectGeometries(e.polygonBarriers.features,s,"polygonBarriers.features",i),l(s).then((e=>{for(const r in i){const s=i[r];t.push(r),o[r]=e.slice(s[0],s[1])}return this._isInputGeometryZAware(o,t)?this.getServiceDescription():a({dontCheck:!0})})).then((s=>{("dontCheck"in s?s.dontCheck:s.hasZ)||this._dropZValuesOffInputGeometry(o,t);for(const r in o)o[r].forEach(((t,s)=>{e.get(r)[s].geometry=t}));let i={query:{...this.parsedUrl.query,f:"json",...j.toQueryParams(e)}};(this.requestOptions||r)&&(i={...this.requestOptions,...r,...i});const{path:a}=this.parsedUrl,l="/solve",u=a.endsWith(l)?a:a+l;return n(u,i)})).then((e=>this._handleSolveResponse(e)))}_collectGeometries(e,r,t,s){s[t]=[r.length,r.length+e.length],e.forEach((e=>{r.push(e.geometry)}))}_handleSolveResponse(e){const r=[],t=[],{directions:s=[],routes:{features:i=[],spatialReference:o=null}={},stops:{features:a=[],spatialReference:n=null}={},barriers:l,polygonBarriers:u,polylineBarriers:p,messages:c}=e.data,d="esri.tasks.RouteTask.NULL_ROUTE_NAME";let m,h,y=!0;const B=i&&o||a&&n||l&&l.spatialReference||u&&u.spatialReference||p&&p.spatialReference;s.forEach((e=>{r.push(m=e.routeName),t[m]={directions:e}})),i.forEach((e=>{-1===r.indexOf(m=e.attributes.Name)&&(r.push(m),t[m]={}),e.geometry&&(e.geometry.spatialReference=B),t[m].route=e})),a.forEach((e=>{h=e.attributes,-1===r.indexOf(m=h.RouteName||d)&&(r.push(m),t[m]={}),m!==d&&(y=!1),e.geometry&&(e.geometry.spatialReference=B),null==t[m].stops&&(t[m].stops=[]),t[m].stops.push(e)})),a.length>0&&!0===y&&(t[r[0]].stops=t[d].stops,delete t[d],r.splice(r.indexOf(d),1));const f=r.map((e=>(t[e].routeName=e===d?null:e,t[e])));return v.fromJSON({routeResults:f,pointBarriers:l,polygonBarriers:u,polylineBarriers:p,messages:c})}};R=e([s("esri.tasks.RouteTask")],R);var g=R;export default g;