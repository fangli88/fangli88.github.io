import{D as e,E as t,bM as s,c1 as i,c2 as n,K as l,L as r,c3 as a,bE as o,c4 as u,l as h,C as d,bq as c,bW as y,bV as f,c5 as p,s as m,t as g,c6 as b,i as v,aP as w,b$ as S,c7 as V,F as j,aG as I,ag as O,c8 as q,c9 as F,J as N,b_ as k,d as x,m as B,ap as $,ar as U,ca as M,cb as z,cc as R}from"./p-ab028778.js";import{g as C}from"./p-dc697c54.js";import{y as E}from"./p-89accc4e.js";var T;let P=T=class extends r{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new T({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}};e([t({type:String,json:{write:!0}})],P.prototype,"description",void 0),e([t({type:String,json:{write:!0}})],P.prototype,"label",void 0),e([t({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],P.prototype,"minValue",void 0),e([t({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],P.prototype,"maxValue",void 0),e([t({types:s,json:{origins:{"web-scene":{types:i,write:n}},write:n}})],P.prototype,"symbol",void 0),P=T=e([l("esri.renderers.support.ClassBreakInfo")],P);var _=P;const J={types:s,json:{write:{writer:n},origins:{"web-scene":{types:i,write:{writer:n}}}}},A={types:{base:a,key:"type",typeMap:{"simple-fill":o.typeMap["simple-fill"],"picture-fill":o.typeMap["picture-fill"],"polygon-3d":o.typeMap["polygon-3d"]}},json:{write:{writer:n},origins:{"web-scene":{type:u,write:{writer:n}}}}};var L;const H=h.getLogger("esri.renderers.ClassBreaksRenderer"),D=new d({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),G=c(_);let K=L=class extends(y(k)){constructor(e){super(e),this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}get _cache(){return{compiledFunc:null}}readClassBreakInfos(e,t,s){if(!Array.isArray(e))return;let i=t.minValue;return e.map((e=>{const t=new _;return t.read(e,s),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t}))}writeClassBreakInfos(e,t,s,i){const n=e.map((e=>e.write({},i)));this._areClassBreaksConsecutive()&&n.forEach((e=>delete e.classMinValue)),t[s]=n}castField(e){return null==e?e:"function"==typeof e?(H.error(".field: field must be a string value"),null):f(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,s=null!=this.normalizationTotal;return t||s?(e=(t?"field":s&&"percent-of-total")||null,t&&s&&H.warn("warning: both normalizationField and normalizationTotal are set!")):"field"!==e&&"percent-of-total"!==e||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,s){let i=null;i="number"==typeof e?new _({minValue:e,maxValue:t,symbol:p(s)}):G(m(e)),this.classBreakInfos.push(i),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const s=this.classBreakInfos.length;for(let i=0;i<s;i++){const s=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(s[0]===e&&s[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&(g(t)||g(t.arcade))&&H.warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let s=t;this.valueExpression&&(g(t)||g(t.arcade))&&(s={...s,arcade:await b()});const i=this.getBreakIndex(e,s);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&(g(t)||g(t.arcade)))return void H.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this.getBreakIndex(e,t);return s>-1?this.classBreakInfos[s].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let s=t;this.valueExpression&&(g(t)||g(t.arcade))&&(s={...s,arcade:await b()});const i=this.getBreakIndex(e,s);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const e=[];return this.classBreakInfos.forEach((t=>{t.symbol&&e.push(t.symbol)})),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),s=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${s}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new L({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:m(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:m(this.visualVariables),legendOptions:m(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(e,t){const s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await v(s)}async collectSymbolFields(e,t){const s=[...this.getSymbols().map((s=>s.collectRequiredFields(e,t))),w(e,t,this.valueExpression)];S(e,t,this.field),S(e,t,this.normalizationField),await v(s)}_getBreakIndexForExpression(e,t){const{viewingMode:s,scale:i,spatialReference:n,arcade:l}=V(t,{});let r=this._cache.compiledFunc;const a=x(l).arcadeUtils;if(!r){const e=a.createSyntaxTree(this.valueExpression);r=a.createFunction(e),this._cache.compiledFunc=r}const o=a.executeFunction(r,a.createExecContext(e,a.getViewInfo({viewingMode:s,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(o)}_getBreakIndexForField(e){const t=e.attributes,s=this.normalizationType;let i=parseFloat(t[this.field]);if(s){const e=this.normalizationTotal,n=parseFloat(t[this.normalizationField]);if("log"===s)i=Math.log(i)*Math.LOG10E;else if("percent-of-total"!==s||isNaN(e)){if("field"===s&&!isNaN(n)){if(isNaN(i)||isNaN(n))return-1;i/=n}}else i=i/e*100}return this._getBreakIndexfromInfos(i)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let s=0;s<this.classBreakInfos.length;s++){const i=[this.classBreakInfos[s].minValue,this.classBreakInfos[s].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return s}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let s=1;s<t;s++)if(e[s-1].maxValue!==e[s].minValue)return!1;return!0}};e([t({readOnly:!0,dependsOn:["valueExpression"]})],K.prototype,"_cache",null),e([t(A)],K.prototype,"backgroundFillSymbol",void 0),e([t({type:[_]})],K.prototype,"classBreakInfos",void 0),e([j("classBreakInfos")],K.prototype,"readClassBreakInfos",null),e([I("classBreakInfos")],K.prototype,"writeClassBreakInfos",null),e([t({type:String,json:{write:!0}})],K.prototype,"defaultLabel",void 0),e([t(J)],K.prototype,"defaultSymbol",void 0),e([t({type:String,json:{write:!0}})],K.prototype,"field",void 0),e([O("field")],K.prototype,"castField",null),e([t({type:Boolean})],K.prototype,"isMaxInclusive",void 0),e([t({type:q,json:{write:!0}})],K.prototype,"legendOptions",void 0),e([t({type:Number,readOnly:!0,value:null,dependsOn:["classBreakInfos"],json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],K.prototype,"minValue",null),e([t({type:String,json:{write:!0}})],K.prototype,"normalizationField",void 0),e([t({type:Number,cast:e=>F(e),json:{write:!0}})],K.prototype,"normalizationTotal",void 0),e([t({type:D.apiValues,value:null,dependsOn:["normalizationField","normalizationTotal"],json:{type:D.jsonValues,read:D.read,write:D.write}})],K.prototype,"normalizationType",null),e([N({classBreaks:"class-breaks"})],K.prototype,"type",void 0),e([t({type:String,json:{write:!0}})],K.prototype,"valueExpression",void 0),e([t({type:String,json:{write:!0}})],K.prototype,"valueExpressionTitle",void 0),K=L=e([l("esri.renderers.ClassBreaksRenderer")],K);var W,Q=K;let X=W=class extends r{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new W({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${e}`}};e([t({type:String,json:{write:!0}})],X.prototype,"description",void 0),e([t({type:String,json:{write:!0}})],X.prototype,"label",void 0),e([t({types:s,json:{origins:{"web-scene":{types:i,write:n}},write:n}})],X.prototype,"symbol",void 0),e([t({type:[String,Number],json:{type:String,write:{writer:(e,t)=>{t.value=null==e?void 0:e.toString()}}}})],X.prototype,"value",void 0),X=W=e([l("esri.renderers.support.UniqueValueInfo")],X);var Y,Z=X;const ee=h.getLogger("esri.renderers.UniqueValueRenderer"),te=c(Z);let se=Y=class extends(y(k)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let s=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let n=0;n<t.length;n++){const l=e.find((e=>e.value===t[n].value));l?E(l,t[n])?(i.changed.push({type:"complete",oldValue:l,newValue:t[n]}),s=!0):i.unchanged.push({oldValue:l,newValue:t[n]}):(i.added.push(t[n]),s=!0)}for(let n=0;n<e.length;n++)t.find((t=>t.value===e[n].value))||(i.removed.push(e[n]),s=!0);return s?i:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(e){return null==e||"function"==typeof e?e:f(e)}writeField(e,t,s,i){"string"==typeof e?t[s]=e:i&&i.messages?i.messages.push(new B("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):ee.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}readPortal(e,t,s){return s.portal||$.getDefault()}readStyleOrigin(e,t,s){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=U(t.styleUrl,s);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,s,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=M(e.styleUrl,i))}set uniqueValueInfos(e){this.styleOrigin?ee.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void ee.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let s;s="object"==typeof e?te(e):new Z({value:e,symbol:p(t)}),this.uniqueValueInfos.push(s),this._valueInfoMap[s.value]=s}removeUniqueValueInfo(e){if(this.styleOrigin)ee.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let t=0;t<this.uniqueValueInfos.length;t++)if(this.uniqueValueInfos[t].value===e+""){delete this._valueInfoMap[e],this.uniqueValueInfos.splice(t,1);break}}async getUniqueValueInfo(e,t){let s=t;return this.valueExpression&&(g(t)||g(t.arcade))&&(s={...s,arcade:await b()}),this._getUniqueValueInfo(e,s)}getSymbol(e,t){if(this.valueExpression&&(g(t)||g(t.arcade)))return void ee.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const s=this._getUniqueValueInfo(e,t);return s&&s.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let s=t;this.valueExpression&&(g(s)||g(s.arcade))&&(s={...s,arcade:await b()});const i=this._getUniqueValueInfo(e,s);return i&&i.symbol||this.defaultSymbol}getSymbols(){const e=[];for(const t of this.uniqueValueInfos)t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce(((e,t)=>e+t.getAttributeHash()),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce(((e,t)=>e+t.getMeshHash()),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new Y({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:m(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:m(this.visualVariables),legendOptions:m(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:m(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=m(this.uniqueValueInfos);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(m(this.styleOrigin))),Object.freeze(t)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const s=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await v(s)}async collectSymbolFields(e,t){const s=[...this.getSymbols().map((s=>s.collectRequiredFields(e,t))),w(e,t,this.valueExpression)];S(e,t,this.field),S(e,t,this.field2),S(e,t,this.field3),await v(s)}populateFromStyle(){return C(this.styleOrigin,{portal:this.portal}).then((e=>{const t=[];return this._valueInfoMap={},e&&e.data&&Array.isArray(e.data.items)&&e.data.items.forEach((s=>{const i=new z({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:s.name});this.defaultSymbol||s.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const n=new Z({value:s.name,symbol:i});t.push(n),this._valueInfoMap[s.name]=n})),this._set("uniqueValueInfos",Object.freeze(t)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this}))}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach((e=>this._valueInfoMap[e.value+""]=e))}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:s,scale:i,spatialReference:n,arcade:l}=V(t,{});let r=this._cache.compiledFunc;const a=x(l).arcadeUtils;if(!r){const e=a.createSyntaxTree(this.valueExpression);r=a.createFunction(e),this._cache.compiledFunc=r}const o=a.executeFunction(r,a.createExecContext(e,a.getViewInfo({viewingMode:s,scale:i,spatialReference:n})));return this._valueInfoMap[o+""]}_getUnqiueValueInfoForFields(e){const t=this.field,s=e.attributes;let i;if("function"!=typeof t&&this.field2){const e=this.field2,n=this.field3,l=[];t&&l.push(s[t]),e&&l.push(s[e]),n&&l.push(s[n]),i=l.join(this.fieldDelimiter||"")}else"function"==typeof t?i=t(e):t&&(i=s[t]);return this._valueInfoMap[i+""]}static fromPortalStyle(e,t){const s=new Y(t&&t.properties);s._set("styleOrigin",Object.freeze({styleName:e})),s._set("portal",t&&t.portal||$.getDefault());const i=s.populateFromStyle();return i.catch((t=>{ee.error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)})),i}static fromStyleUrl(e,t){const s=new Y(t&&t.properties);s._set("styleOrigin",Object.freeze({styleUrl:e}));const i=s.populateFromStyle();return i.catch((t=>{ee.error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)})),i}};e([t({readOnly:!0,dependsOn:["valueExpression"]})],se.prototype,"_cache",null),e([N({uniqueValue:"unique-value"})],se.prototype,"type",void 0),e([t(A)],se.prototype,"backgroundFillSymbol",void 0),e([t({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],se.prototype,"field",void 0),e([O("field")],se.prototype,"castField",null),e([I("field")],se.prototype,"writeField",null),e([t({type:String,json:{write:!0}})],se.prototype,"field2",void 0),e([t({type:String,json:{write:!0}})],se.prototype,"field3",void 0),e([t({type:String,json:{write:!0}})],se.prototype,"valueExpression",void 0),e([t({type:String,json:{write:!0}})],se.prototype,"valueExpressionTitle",void 0),e([t({type:q,json:{write:!0}})],se.prototype,"legendOptions",void 0),e([t({type:String,json:{write:!0}})],se.prototype,"defaultLabel",void 0),e([t(R({...J},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],se.prototype,"defaultSymbol",null),e([t({type:String,json:{write:!0}})],se.prototype,"fieldDelimiter",void 0),e([t({type:$,readOnly:!0})],se.prototype,"portal",void 0),e([j("portal",["styleName"])],se.prototype,"readPortal",null),e([t({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],se.prototype,"styleOrigin",void 0),e([j("styleOrigin",["styleName","styleUrl"])],se.prototype,"readStyleOrigin",null),e([I("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],se.prototype,"writeStyleOrigin",null),e([t({type:[Z],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],se.prototype,"uniqueValueInfos",null),se=Y=e([l("esri.renderers.UniqueValueRenderer")],se);var ie=se;export{ie as $,Q as C,Z as a,J as r,_ as u}